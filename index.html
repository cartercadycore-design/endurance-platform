<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coreformance — v5</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #f7f6f3; --bg-w: #f2f0eb; --sur: #ffffff; --sur2: #faf9f7; --sur3: #f4f2ee;
  --bd: #e8e4dd; --bd2: #d8d3c9;
  --t1: #1a1814; --t2: #6b6557; --t3: #a39d93; --t4: #c8c2b8;
  --g: #1a9e6e; --g1: #edf7f3; --g2: rgba(26,158,110,0.12); --g3: rgba(26,158,110,0.22);
  --a: #d97706; --a1: #fef8ee; --a2: rgba(217,119,6,0.12);
  --r: #dc3545; --r1: #fff0f1; --r2: rgba(220,53,69,0.10);
  --b: #2563eb; --b1: #eff4ff; --b2: rgba(37,99,235,0.10);
  --gold: #b8860b; --gold1: #fdf8ec; --gold2: rgba(184,134,11,0.15);
  --topbar: 52px; --rad: 14px; --rad-s: 8px;
  --sh: 0 1px 3px rgba(26,24,20,0.06),0 4px 16px rgba(26,24,20,0.04);
  --sh-md: 0 2px 8px rgba(26,24,20,0.08),0 8px 32px rgba(26,24,20,0.06);
}
body.coach-mode { --bg:#f4f6fb; --bg-w:#eef1f8; --sur2:#f8f9fd; --sur3:#eef1f8; --bd:#e0e5f0; --bd2:#cdd4e8; }
html { scroll-behavior: smooth; }
body { background:var(--bg); color:var(--t1); font-family:'Plus Jakarta Sans',sans-serif; font-size:14px; line-height:1.55; -webkit-font-smoothing:antialiased; transition:background 0.3s; }

/* ── TOPBAR ── */
.topbar { position:fixed; top:0; left:0; right:0; z-index:500; height:var(--topbar); background:rgba(247,246,243,0.93); backdrop-filter:blur(20px); border-bottom:1px solid var(--bd); display:flex; align-items:center; padding:0 24px; gap:16px; transition:background 0.3s; }
body.coach-mode .topbar { background:rgba(244,246,251,0.93); }
.logo { font-weight:800; font-size:16px; color:var(--t1); letter-spacing:-.03em; flex-shrink:0; }
.logo-dot { color:var(--g); }
body.coach-mode .logo-dot { color:var(--b); }

/* Mode pill */
.mode-pill { display:flex; align-items:center; background:var(--sur); border:1px solid var(--bd); border-radius:32px; padding:4px; gap:2px; box-shadow:var(--sh); flex-shrink:0; }
.mpb { display:flex; align-items:center; gap:5px; padding:5px 14px; border-radius:28px; border:none; background:transparent; font-family:'Plus Jakarta Sans',sans-serif; font-size:12px; font-weight:500; color:var(--t3); cursor:pointer; transition:all 0.22s cubic-bezier(.4,0,.2,1); white-space:nowrap; }
.mpb.active { background:var(--t1); color:#fff; box-shadow:0 1px 4px rgba(26,24,20,.2); }
body.coach-mode .mpb.active.coach { background:var(--b); }

/* Nav tabs */
.nav { display:flex; align-items:center; gap:2px; flex:1; }
.ntab { padding:5px 13px; border-radius:var(--rad-s); font-size:13px; font-weight:500; cursor:pointer; border:none; background:none; color:var(--t3); transition:all .12s; font-family:'Plus Jakarta Sans',sans-serif; white-space:nowrap; }
.ntab:hover { color:var(--t1); background:var(--sur3); }
.ntab.active { color:var(--t1); background:var(--sur3); font-weight:600; }
.ntab.active.hi { color:var(--g); background:var(--g1); }
.ntab.active.hic { color:var(--b); background:var(--b1); }
.ntab .badge-dot { background:var(--r); color:#fff; font-size:9px; padding:1px 5px; border-radius:8px; margin-left:3px; font-family:'DM Mono',monospace; }

.tbar-right { display:flex; align-items:center; gap:10px; margin-left:auto; flex-shrink:0; }
.race-tag { display:flex; align-items:center; gap:5px; background:var(--a1); border:1px solid var(--a2); border-radius:20px; padding:4px 12px; font-size:11px; font-family:'DM Mono',monospace; color:var(--a); }
.rdot { width:5px; height:5px; border-radius:50%; background:var(--a); animation:blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1}50%{opacity:.4} }
.mbadge { font-size:10px; font-family:'DM Mono',monospace; font-weight:500; padding:4px 10px; border-radius:6px; }
.mbadge.athlete { background:var(--g1); color:var(--g); border:1px solid var(--g2); }
.mbadge.coach { background:var(--b1); color:var(--b); border:1px solid var(--b2); }
.uavi { width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; cursor:pointer; border:2px solid transparent; }
.uavi.a { background:var(--g1); color:var(--g); border-color:var(--g2); }
.uavi.c { background:var(--b1); color:var(--b); border-color:var(--b2); }

/* ── LAYOUT ── */
.app { margin-top:var(--topbar); min-height:calc(100vh - var(--topbar)); }
.screen { display:none; padding:40px 44px; max-width:1120px; }
.screen.active { display:block; }
@keyframes fadeUp { from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)} }
.screen.active>*{animation:fadeUp .26s cubic-bezier(.4,0,.2,1) both}
.screen.active>*:nth-child(2){animation-delay:.05s}
.screen.active>*:nth-child(3){animation-delay:.1s}
.screen.active>*:nth-child(4){animation-delay:.15s}
.screen.active>*:nth-child(5){animation-delay:.2s}

/* ── SHARED ── */
.ph { margin-bottom:28px; }
.ph-row { display:flex; align-items:flex-start; justify-content:space-between; gap:16px; }
.ph-t { font-size:24px; font-weight:800; letter-spacing:-.03em; }
.ph-s { font-size:14px; color:var(--t2); margin-top:4px; }
.card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); box-shadow:var(--sh); }
.card-p { padding:22px 24px; }
.chip { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; border-radius:20px; font-size:11px; font-family:'DM Mono',monospace; font-weight:500; }
.cg { background:var(--g1); color:var(--g); border:1px solid var(--g2); }
.ca { background:var(--a1); color:var(--a); border:1px solid var(--a2); }
.cr { background:var(--r1); color:var(--r); border:1px solid var(--r2); }
.cb { background:var(--b1); color:var(--b); border:1px solid var(--b2); }
.cn { background:var(--sur3); color:var(--t2); border:1px solid var(--bd); }
.gold-chip { background:var(--gold1); color:var(--gold); border:1px solid var(--gold2); }
.btn { border:none; border-radius:var(--rad-s); padding:10px 20px; font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; font-weight:600; cursor:pointer; transition:all .15s; display:inline-flex; align-items:center; gap:6px; }
.btn:hover { transform:translateY(-1px); }
.btn-p { background:var(--t1); color:#fff; }
.btn-p:hover { box-shadow:0 4px 12px rgba(26,24,20,.2); }
.btn-g { background:var(--g); color:#fff; }
.btn-g:hover { background:#158a5f; }
.btn-b { background:var(--b); color:#fff; }
.btn-b:hover { background:#1d4ed8; }
.btn-gold { background:var(--gold); color:#fff; }
.btn-ghost { background:var(--sur); color:var(--t2); border:1px solid var(--bd); }
.btn-ghost:hover { background:var(--sur3); color:var(--t1); }
.up{color:var(--g)} .warn{color:var(--a)} .risk{color:var(--r)} .info{color:var(--b)} .muted{color:var(--t3)} .mono{font-family:'DM Mono',monospace}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.g5{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.sdiv { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); display:flex; align-items:center; gap:10px; margin:24px 0 12px; }
.sdiv::after { content:''; flex:1; height:1px; background:var(--bd); }
.irow { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--bd); font-size:13px; }
.irow:last-child { border-bottom:none; }
.ilbl { color:var(--t2); }
.ival { font-family:'DM Mono',monospace; font-weight:500; }
::-webkit-scrollbar{width:4px} ::-webkit-scrollbar-track{background:transparent} ::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:4px}

/* ══ ONBOARDING ══ */
.onboard-overlay { position:fixed; inset:0; background:var(--bg); z-index:1000; display:flex; align-items:center; justify-content:center; }
.onboard-box { background:var(--sur); border:1px solid var(--bd); border-radius:20px; padding:48px 52px; max-width:520px; width:100%; box-shadow:var(--sh-md); animation:fadeUp .3s ease both; }
.ob-logo { font-weight:800; font-size:18px; letter-spacing:-.03em; color:var(--t1); margin-bottom:6px; }
.ob-logo span { color:var(--g); }
.ob-step { font-size:11px; font-family:'DM Mono',monospace; color:var(--t4); margin-bottom:32px; }
.ob-q { font-size:22px; font-weight:800; letter-spacing:-.02em; color:var(--t1); margin-bottom:8px; }
.ob-sub { font-size:14px; color:var(--t2); margin-bottom:28px; line-height:1.6; }
.ob-options { display:flex; flex-direction:column; gap:10px; margin-bottom:28px; }
.ob-opt { display:flex; align-items:center; gap:14px; padding:16px 18px; background:var(--sur3); border:1px solid var(--bd); border-radius:12px; cursor:pointer; transition:all .15s; }
.ob-opt:hover { border-color:var(--bd2); background:var(--sur); box-shadow:var(--sh); }
.ob-opt.selected { border-color:var(--g); background:var(--g1); }
.ob-opt-icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; background:var(--sur); border:1px solid var(--bd); }
.ob-opt.selected .ob-opt-icon { background:var(--g2); border-color:var(--g2); }
.ob-opt-text {}
.ob-opt-title { font-size:14px; font-weight:700; }
.ob-opt-desc { font-size:12px; color:var(--t3); margin-top:2px; }
.ob-footer { display:flex; justify-content:flex-end; }
.ob-progress { display:flex; gap:5px; margin-bottom:24px; }
.ob-prog-dot { height:3px; border-radius:2px; background:var(--bd); flex:1; transition:background .2s; }
.ob-prog-dot.done { background:var(--g); }
.ob-prog-dot.active { background:var(--t3); }

/* ══ ATHLETE: HOME / TODAY ══ */
.readiness-hero { background:var(--sur); border:1px solid var(--bd); border-radius:20px; box-shadow:var(--sh-md); padding:38px 42px; margin-bottom:14px; display:grid; grid-template-columns:1fr 1fr; gap:40px; align-items:center; position:relative; overflow:hidden; }
.readiness-hero::before { content:''; position:absolute; top:-80px; right:-80px; width:300px; height:300px; border-radius:50%; background:radial-gradient(circle,rgba(26,158,110,.06) 0%,transparent 65%); pointer-events:none; }
.rh-greet { font-size:13px; font-weight:500; color:var(--t3); margin-bottom:6px; }
.rh-score { font-size:96px; font-weight:800; line-height:1; color:var(--t1); letter-spacing:-.04em; }
.rh-status { font-size:22px; font-weight:700; color:var(--g); letter-spacing:-.02em; margin-bottom:4px; }
.rh-desc { font-size:13px; color:var(--t2); line-height:1.6; }
.rh-bullets { display:flex; flex-direction:column; gap:6px; margin-top:14px; }
.rh-b { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--t2); }
.rh-dot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }
.spark { margin-top:18px; }
.spark-lbl { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:7px; }
.spark-bars { display:flex; align-items:flex-end; gap:4px; height:30px; }
.sbar { flex:1; border-radius:3px 3px 0 0; background:var(--g1); border-top:1px solid var(--g2); }
.sbar.now { background:var(--g2); border-top:2px solid var(--g); }
.rh-right { background:var(--bg); border:1px solid var(--bd); border-radius:16px; padding:22px 24px; }
.rec-eye { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--g); display:flex; align-items:center; gap:6px; margin-bottom:12px; }
.ldot { width:7px; height:7px; border-radius:50%; background:var(--g); animation:lp 2s infinite; }
@keyframes lp { 0%,100%{box-shadow:0 0 0 0 rgba(26,158,110,.4)}50%{box-shadow:0 0 0 5px rgba(26,158,110,0)} }
.rec-title { font-size:22px; font-weight:800; letter-spacing:-.02em; margin-bottom:4px; }
.rec-sub { font-family:'DM Mono',monospace; font-size:11px; color:var(--t3); margin-bottom:12px; }
.rec-why { font-size:13px; color:var(--t2); line-height:1.65; background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:12px 14px; margin-bottom:14px; }
.imp-grid { display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:14px; }
.imp-t { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:9px 12px; }
.imp-l { font-size:9px; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:3px; }
.imp-v { font-family:'DM Mono',monospace; font-size:13px; font-weight:500; }
.kpi-strip { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-bottom:14px; }
.kpi { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:16px 18px; box-shadow:var(--sh); transition:transform .15s,box-shadow .15s; }
.kpi:hover { transform:translateY(-1px); box-shadow:var(--sh-md); }
.kpi-l { font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:8px; }
.kpi-v { font-size:24px; font-weight:800; line-height:1; letter-spacing:-.02em; margin-bottom:4px; }
.kpi-d { font-family:'DM Mono',monospace; font-size:11px; }
.ts-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:22px 24px; box-shadow:var(--sh); }
.ts-hd { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); margin-bottom:14px; }
.ts-row { display:flex; align-items:center; padding:9px 0; border-bottom:1px solid var(--bd); }
.ts-row:last-child { border-bottom:none; }
.ts-l { flex:1; }
.ts-name { font-size:14px; font-weight:600; }
.ts-m { font-size:11px; color:var(--t3); font-family:'DM Mono',monospace; margin-top:1px; }
.ts-r { text-align:right; }
.ts-verdict { font-size:13px; font-weight:700; margin-bottom:3px; }
.ts-bar { width:56px; height:3px; background:var(--bd); border-radius:2px; overflow:hidden; display:inline-block; }
.ts-bf { height:100%; border-radius:2px; }

/* Output mini */
.out-mini { background:linear-gradient(135deg,var(--sur) 0%,var(--g1) 100%); border:1px solid var(--g2); border-radius:var(--rad); padding:16px 20px; box-shadow:var(--sh); display:flex; align-items:center; justify-content:space-between; gap:20px; }
.om-icon { width:38px; height:38px; border-radius:10px; background:var(--g2); border:1px solid var(--g3); display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; }
.om-lbl { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--g); margin-bottom:2px; }
.om-val { font-size:17px; font-weight:800; letter-spacing:-.02em; }
.om-bt { flex:1; max-width:180px; }
.om-track { height:5px; background:var(--g1); border-radius:3px; overflow:hidden; border:1px solid var(--g2); }
.om-fill { height:100%; border-radius:3px; background:var(--g); }

/* ══ TRAINING ══ */
.filter-bar { display:flex; gap:6px; margin-bottom:16px; flex-wrap:wrap; }
.fbtn { padding:5px 14px; border-radius:20px; font-size:12px; font-weight:500; border:1px solid var(--bd); background:var(--sur); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.fbtn:hover { background:var(--sur3); color:var(--t1); }
.fbtn.active { background:var(--t1); color:#fff; border-color:var(--t1); }
.hist-grp { margin-bottom:20px; }
.hg-lbl { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); margin-bottom:8px; }
.hrow { display:flex; align-items:center; gap:13px; background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:13px 16px; margin-bottom:6px; cursor:pointer; box-shadow:var(--sh); transition:all .12s; }
.hrow:hover { transform:translateY(-1px); box-shadow:var(--sh-md); border-color:var(--bd2); }
.htype { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0; }
.htype.run{background:var(--g1)} .htype.bike{background:var(--b1)} .htype.swim{background:#f3f0ff}
.hmain { flex:1; }
.hname { font-size:14px; font-weight:600; margin-bottom:2px; }
.hmeta { font-size:11px; color:var(--t3); font-family:'DM Mono',monospace; }
.hright { text-align:right; }
.hload { font-size:19px; font-weight:800; letter-spacing:-.02em; margin-bottom:3px; }
/* Plan builder (self-coached) */
.plan-builder { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:22px 24px; box-shadow:var(--sh); margin-bottom:14px; }
.pb-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.pb-title { font-size:16px; font-weight:700; }
.week-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
.wday { background:var(--sur3); border:1px solid var(--bd); border-radius:8px; padding:10px 8px; text-align:center; cursor:pointer; transition:all .12s; }
.wday:hover { background:var(--b1); border-color:var(--b2); }
.wday.has-workout { background:var(--g1); border-color:var(--g2); }
.wday.rest { background:var(--sur3); opacity:.6; }
.wd-day { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:5px; }
.wd-icon { font-size:18px; margin-bottom:3px; }
.wd-type { font-size:10px; color:var(--t2); font-weight:500; }

/* ══ PERFORMANCE ══ */
.perf-hero { background:var(--sur); border:1px solid var(--bd); border-radius:20px; box-shadow:var(--sh-md); padding:32px 36px; margin-bottom:14px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:1px; background-color:var(--bd); overflow:hidden; }
.perf-cell { background:var(--sur); padding:26px 28px; position:relative; overflow:hidden; }
.perf-cell::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; }
.pc-fit::before{background:var(--g)} .pc-fat::before{background:var(--a)} .pc-read::before{background:var(--b)}
.pc-bg { position:absolute; top:-60px; right:-60px; width:160px; height:160px; border-radius:50%; pointer-events:none; }
.pc-fit .pc-bg{background:radial-gradient(circle,rgba(26,158,110,.05) 0%,transparent 70%)}
.pc-fat .pc-bg{background:radial-gradient(circle,rgba(217,119,6,.05) 0%,transparent 70%)}
.pc-read .pc-bg{background:radial-gradient(circle,rgba(37,99,235,.05) 0%,transparent 70%)}
.pc-type { font-size:9px; font-weight:600; letter-spacing:.16em; text-transform:uppercase; color:var(--t3); margin-bottom:4px; }
.pc-name { font-size:13px; font-weight:600; color:var(--t2); margin-bottom:10px; }
.pc-val { font-size:52px; font-weight:800; line-height:1; letter-spacing:-.03em; margin-bottom:6px; }
.pc-fit .pc-val{color:var(--g)} .pc-fat .pc-val{color:var(--a)} .pc-read .pc-val{color:var(--b)}
.pc-verdict { font-size:12px; color:var(--t2); line-height:1.5; margin-bottom:10px; }
.pc-stats { display:flex; flex-direction:column; gap:3px; }
.pc-stat { display:flex; justify-content:space-between; font-size:11px; color:var(--t3); font-family:'DM Mono',monospace; }
.pc-stat span:last-child { color:var(--t2); }
.analytics-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.a-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:20px 22px; box-shadow:var(--sh); }
.a-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t3); margin-bottom:14px; }
.zrow { display:flex; align-items:center; gap:8px; padding:6px 0; border-bottom:1px solid var(--bd); }
.zrow:last-child { border-bottom:none; }
.zlbl { font-size:12px; color:var(--t2); width:52px; }
.ztrack { flex:1; height:6px; background:var(--bd); border-radius:3px; overflow:hidden; }
.zfill { height:100%; border-radius:3px; }
.zpct { font-family:'DM Mono',monospace; font-size:11px; color:var(--t3); width:28px; text-align:right; }

/* ══ INTELLIGENCE ══ */
.intel-hero { background:linear-gradient(135deg,#f0fdf7 0%,#e8f8f0 100%); border:1px solid var(--g2); border-radius:20px; padding:32px 36px; margin-bottom:14px; box-shadow:var(--sh-md); }
.ih-eyebrow { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--g); margin-bottom:10px; display:flex; align-items:center; gap:7px; }
.ih-title { font-size:26px; font-weight:800; letter-spacing:-.03em; margin-bottom:6px; }
.ih-sub { font-size:14px; color:var(--t2); line-height:1.6; max-width:600px; }
.intel-cards { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:14px; }
.intel-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:20px 22px; box-shadow:var(--sh); }
.ic-eye { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; margin-bottom:8px; }
.ic-title { font-size:17px; font-weight:800; letter-spacing:-.02em; margin-bottom:6px; }
.ic-body { font-size:13px; color:var(--t2); line-height:1.65; }
.ic-meta { font-family:'DM Mono',monospace; font-size:11px; color:var(--t3); margin-top:10px; }

/* ══ DISCOVER / CADY CORE ══ */
.cady-hero { background:linear-gradient(135deg,var(--gold1) 0%,#fef9f0 100%); border:1px solid var(--gold2); border-radius:20px; padding:36px 40px; margin-bottom:18px; box-shadow:var(--sh-md); display:grid; grid-template-columns:1fr auto; gap:32px; align-items:center; }
.ch-badge { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
.cady-badge { display:inline-flex; align-items:center; gap:7px; background:var(--gold); color:#fff; padding:6px 14px; border-radius:20px; font-size:12px; font-weight:700; letter-spacing:.02em; }
.cady-badge-icon { font-size:14px; }
.ch-title { font-size:28px; font-weight:800; letter-spacing:-.03em; margin-bottom:6px; }
.ch-sub { font-size:14px; color:var(--t2); line-height:1.6; max-width:500px; }
.ch-stats { display:flex; gap:24px; }
.ch-stat { text-align:center; }
.ch-stat-val { font-size:22px; font-weight:800; color:var(--gold); }
.ch-stat-lbl { font-size:11px; color:var(--t3); }
.discover-filters { display:flex; gap:8px; margin-bottom:18px; flex-wrap:wrap; align-items:center; }
.df-lbl { font-size:12px; color:var(--t3); font-weight:500; margin-right:4px; }
.coach-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
.coach-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:22px 24px; box-shadow:var(--sh); cursor:pointer; transition:all .15s; }
.coach-card:hover { transform:translateY(-2px); box-shadow:var(--sh-md); border-color:var(--bd2); }
.coach-card-top { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:14px; }
.coach-avi-lg { width:52px; height:52px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; font-weight:700; border:3px solid transparent; }
.cady-verified { display:inline-flex; align-items:center; gap:5px; background:var(--gold1); color:var(--gold); border:1px solid var(--gold2); padding:3px 10px; border-radius:12px; font-size:10px; font-weight:700; }
.coach-name { font-size:16px; font-weight:800; margin-bottom:2px; }
.coach-spec { font-size:12px; color:var(--t3); margin-bottom:10px; }
.coach-bio { font-size:13px; color:var(--t2); line-height:1.6; margin-bottom:14px; }
.coach-stats { display:flex; gap:14px; margin-bottom:14px; }
.cst { }
.cst-val { font-size:16px; font-weight:800; letter-spacing:-.02em; }
.cst-lbl { font-size:10px; color:var(--t3); font-family:'DM Mono',monospace; }
.prog-pill { display:inline-flex; align-items:center; gap:5px; background:var(--sur3); border:1px solid var(--bd); border-radius:8px; padding:4px 10px; font-size:11px; color:var(--t2); margin:2px; }

/* Verified profile page */
.verified-profile { background:var(--sur); border:1px solid var(--bd); border-radius:20px; overflow:hidden; box-shadow:var(--sh-md); margin-bottom:14px; }
.vp-banner { height:100px; background:linear-gradient(135deg,#1a1814 0%,#2a2620 100%); position:relative; display:flex; align-items:flex-end; padding:16px 28px; }
.vp-avi { width:72px; height:72px; border-radius:50%; border:3px solid #fff; background:var(--g1); color:var(--g); display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:700; position:absolute; bottom:-36px; left:28px; }
.vp-body { padding:52px 28px 28px; }
.vp-name { font-size:24px; font-weight:800; letter-spacing:-.02em; margin-bottom:4px; }
.vp-creds { display:flex; align-items:center; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.vp-bio { font-size:14px; color:var(--t2); line-height:1.7; margin-bottom:16px; max-width:600px; }

/* ══ COACH: ROSTER LEDGER ══ */
.coach-strip { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-bottom:18px; }
.cs-c { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:14px 16px; box-shadow:var(--sh); }
.cs-l { font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:8px; }
.cs-v { font-size:26px; font-weight:800; letter-spacing:-.02em; margin-bottom:3px; }
.cs-s { font-family:'DM Mono',monospace; font-size:11px; }
.ledger { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); box-shadow:var(--sh-md); overflow:hidden; }
.ledger-tb { display:flex; align-items:center; gap:8px; padding:12px 16px; border-bottom:1px solid var(--bd); background:var(--sur2); }
.ldg-search { flex:1; max-width:200px; background:var(--sur); border:1px solid var(--bd); border-radius:20px; padding:6px 14px; color:var(--t1); font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; outline:none; }
.ldg-search::placeholder{color:var(--t4)}
.spill { padding:5px 13px; border-radius:20px; font-size:12px; font-weight:500; background:var(--sur); border:1px solid var(--bd); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.spill:hover { background:var(--sur3); color:var(--t1); }
.spill.active { background:var(--t1); color:#fff; border-color:var(--t1); }
.ldg-ct { margin-left:auto; font-family:'DM Mono',monospace; font-size:11px; color:var(--t4); }
.ldg-head { display:grid; grid-template-columns:190px 78px 68px 68px 68px 86px 105px 100px; padding:9px 16px; border-bottom:1px solid var(--bd); background:var(--sur2); }
.lhc { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); cursor:pointer; user-select:none; }
.lhc:hover{color:var(--t2)} .lhc.sorted{color:var(--b)}
.arow-w {}
.arow { display:grid; grid-template-columns:190px 78px 68px 68px 68px 86px 105px 100px; border-bottom:1px solid var(--bd); cursor:pointer; transition:background .1s; }
.arow:hover{background:var(--sur2)} .arow.at-risk{border-left:3px solid var(--r)} .arow.flagged{border-left:3px solid var(--a)} .arow.selected{background:var(--b1)}
.arc { padding:12px 0 12px 16px; display:flex; align-items:center; font-size:13px; }
.ath-id { display:flex; align-items:center; gap:9px; }
.avi-s { width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:700; flex-shrink:0; border:2px solid transparent; }
.an { font-size:13px; font-weight:700; }
.ae { font-size:10px; color:var(--t4); font-family:'DM Mono',monospace; margin-top:1px; }
.sc-cell { display:flex; flex-direction:column; }
.sc-num { font-size:16px; font-weight:800; letter-spacing:-.02em; }
.sc-bar { width:34px; height:3px; background:var(--bd); border-radius:2px; overflow:hidden; margin-top:3px; }
.sc-fill { height:100%; border-radius:2px; }
/* Drill */
.drill-panel { display:none; padding:24px 26px; background:var(--sur2); border-top:1px solid var(--bd); }
.drill-panel.open{display:block;animation:fadeUp .2s ease both}
.drill-top { display:flex; align-items:center; justify-content:space-between; margin-bottom:18px; padding-bottom:16px; border-bottom:1px solid var(--bd); }
.dident { display:flex; align-items:center; gap:11px; }
.dname { font-size:19px; font-weight:800; letter-spacing:-.02em; }
.dmeta { font-size:11px; color:var(--t3); font-family:'DM Mono',monospace; margin-top:2px; }
.drill-bs { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:16px; }
.dbs { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:14px 16px; border-top:2px solid transparent; }
.dbs.g{border-top-color:var(--g)} .dbs.a{border-top-color:var(--a)} .dbs.r{border-top-color:var(--r)} .dbs.b{border-top-color:var(--b)}
.dbs-type { font-size:9px; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); margin-bottom:3px; }
.dbs-val { font-size:32px; font-weight:800; letter-spacing:-.03em; margin-bottom:3px; }
.dbs-desc { font-size:12px; color:var(--t2); line-height:1.5; }
.dtabs { display:flex; gap:4px; margin-bottom:14px; }
.dtab { padding:5px 14px; border-radius:20px; font-size:12px; font-weight:500; border:1px solid var(--bd); background:var(--sur); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.dtab:hover{background:var(--sur3);color:var(--t1)} .dtab.active{background:var(--t1);color:#fff;border-color:var(--t1)}
.dsec{display:none} .dsec.active{display:block}
.dwo { display:flex; align-items:center; gap:11px; padding:9px 12px; background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); margin-bottom:5px; box-shadow:var(--sh); }
.dwo-t { width:30px; height:30px; border-radius:7px; display:flex; align-items:center; justify-content:center; font-size:13px; flex-shrink:0; }
.dwo-t.run{background:var(--g1)} .dwo-t.bike{background:var(--b1)} .dwo-t.swim{background:#f3f0ff}
.dwo-m { flex:1; }
.dwo-n { font-size:13px; font-weight:600; }
.dwo-mt { font-size:10px; color:var(--t3); font-family:'DM Mono',monospace; }
.note-box { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:13px 15px; box-shadow:var(--sh); }
.note-l { font-size:10px; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); font-weight:600; margin-bottom:6px; }
.note-ta { width:100%; background:none; border:none; color:var(--t2); font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; resize:none; outline:none; line-height:1.7; }
.note-f { display:flex; justify-content:flex-end; margin-top:8px; }

/* ══ PROGRAMS ══ */
.prog-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
.prog-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:20px 22px; box-shadow:var(--sh); cursor:pointer; transition:all .15s; }
.prog-card:hover { transform:translateY(-1px); box-shadow:var(--sh-md); }
.prog-card-top { display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:12px; }
.prog-icon { width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; }
.prog-name { font-size:16px; font-weight:700; margin-bottom:3px; }
.prog-meta { font-size:11px; color:var(--t3); font-family:'DM Mono',monospace; margin-bottom:8px; }
.prog-desc { font-size:13px; color:var(--t2); line-height:1.6; margin-bottom:12px; }
.prog-stats { display:flex; gap:14px; }
.pst-val { font-size:16px; font-weight:800; }
.pst-lbl { font-size:10px; color:var(--t4); }

/* ══ SCHEDULE ══ */
.cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.cal-nav { display:flex; align-items:center; gap:12px; }
.cal-month { font-size:18px; font-weight:700; }
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:1px; background:var(--bd); border:1px solid var(--bd); border-radius:var(--rad); overflow:hidden; margin-bottom:14px; }
.cal-day-head { background:var(--sur2); padding:8px; text-align:center; font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); }
.cal-day { background:var(--sur); padding:8px; min-height:72px; cursor:pointer; transition:background .1s; }
.cal-day:hover{background:var(--sur3)} .cal-day.today{background:var(--g1)}
.cal-day.other-month{background:var(--sur2)} .cal-day.other-month .cdn{color:var(--t4)}
.cdn { font-size:12px; font-weight:600; color:var(--t1); margin-bottom:4px; }
.cal-wo { font-size:10px; padding:2px 6px; border-radius:4px; margin-bottom:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.cal-wo.run{background:var(--g1);color:var(--g)} .cal-wo.bike{background:var(--b1);color:var(--b)} .cal-wo.swim{background:#f3f0ff;color:#7c3aed} .cal-wo.rest{background:var(--sur3);color:var(--t3)}

/* ══ INSIGHTS ══ */
.insight-strip { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-bottom:18px; }
.bar-chart-card { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:20px 22px; box-shadow:var(--sh); margin-bottom:14px; }
.bcc-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t3); margin-bottom:14px; }
.bar-viz { display:flex; align-items:flex-end; gap:5px; height:80px; margin-bottom:8px; }
.bv { flex:1; border-radius:4px 4px 0 0; transition:background .2s; cursor:pointer; }
.bv.fit{background:var(--g1);border-top:1px solid var(--g2)} .bv.fit.now{background:var(--g2);border-top:2px solid var(--g)}
.bv.fat{background:var(--a1);border-top:1px solid var(--a2)} .bv.fat.now{background:var(--a2);border-top:2px solid var(--a)}
.chart-ft { display:flex; justify-content:space-between; font-family:'DM Mono',monospace; font-size:9px; color:var(--t4); }
.roster-perf { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:20px 22px; box-shadow:var(--sh); }
.rp-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t3); margin-bottom:14px; }
.rp-row { display:flex; align-items:center; gap:10px; padding:9px 0; border-bottom:1px solid var(--bd); }
.rp-row:last-child{border-bottom:none}
.rp-avi { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:700; flex-shrink:0; }
.rp-name { font-size:13px; font-weight:600; flex:1; }
.rp-bars { display:flex; gap:6px; align-items:center; }
.rp-bar-item { display:flex; align-items:center; gap:4px; }
.rp-bar-lbl { font-size:9px; color:var(--t4); width:12px; }
.rp-bw { width:50px; height:4px; background:var(--bd); border-radius:2px; overflow:hidden; }
.rp-bf { height:100%; border-radius:2px; }
.rp-val { font-family:'DM Mono',monospace; font-size:11px; color:var(--t2); width:22px; text-align:right; }

/* ══ ALERTS (coach intelligence) ══ */
.alert-list { display:flex; flex-direction:column; gap:6px; margin-bottom:18px; }
.alrt { display:flex; align-items:flex-start; gap:11px; padding:14px 16px; border-radius:var(--rad); background:var(--sur); border:1px solid var(--bd); border-left:3px solid transparent; cursor:pointer; transition:all .1s; box-shadow:var(--sh); }
.alrt:hover{transform:translateY(-1px);box-shadow:var(--sh-md)}
.alrt.danger{border-left-color:var(--r)} .alrt.warn{border-left-color:var(--a)} .alrt.info{border-left-color:var(--b)}
.alrt-ic{font-size:16px;margin-top:1px;flex-shrink:0}
.alrt-b{flex:1}
.alrt-who{font-size:14px;font-weight:700;margin-bottom:2px}
.alrt-txt{font-size:13px;color:var(--t2);line-height:1.5}
.alrt-time{font-family:'DM Mono',monospace;font-size:10px;color:var(--t4);margin-top:4px}
.alrt-cta{flex-shrink:0;font-size:12px;font-weight:500;background:var(--sur3);border:1px solid var(--bd);border-radius:var(--rad-s);padding:5px 12px;cursor:pointer;color:var(--t2);transition:all .1s;font-family:'Plus Jakarta Sans',sans-serif;white-space:nowrap;align-self:center}
.alrt-cta:hover{background:var(--t1);color:#fff;border-color:var(--t1)}
.intel-coach-card{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);padding:18px 20px;box-shadow:var(--sh)}
.icc-eye{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;margin-bottom:6px}
.icc-title{font-size:15px;font-weight:700;margin-bottom:5px}
.icc-body{font-size:13px;color:var(--t2);line-height:1.6}
.icc-action{margin-top:10px}

/* ══ BUSINESS ══ */
.biz-hero { background:var(--sur); border:1px solid var(--bd); border-radius:20px; padding:32px 36px; margin-bottom:14px; box-shadow:var(--sh-md); display:grid; grid-template-columns:1fr auto; gap:32px; align-items:center; }
.biz-plan-badge { display:inline-flex; align-items:center; gap:7px; background:var(--g1); color:var(--g); border:1px solid var(--g2); border-radius:20px; padding:5px 14px; font-size:12px; font-weight:700; margin-bottom:10px; }
.biz-plan-name { font-size:26px; font-weight:800; letter-spacing:-.03em; margin-bottom:4px; }
.biz-plan-sub { font-size:14px; color:var(--t2); }
.biz-plan-price { text-align:right; }
.biz-price-amt { font-size:40px; font-weight:800; letter-spacing:-.03em; color:var(--t1); }
.biz-price-per { font-size:14px; color:var(--t3); }
.biz-metrics { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:14px; }
.biz-m { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:16px 18px; box-shadow:var(--sh); }
.biz-m-l { font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:7px; }
.biz-m-v { font-size:24px; font-weight:800; letter-spacing:-.02em; margin-bottom:3px; }
.biz-m-s { font-size:11px; font-family:'DM Mono',monospace; }
.billing-table { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); overflow:hidden; box-shadow:var(--sh); }
.bt-head { display:grid; grid-template-columns:1fr 100px 100px 100px 80px; padding:10px 18px; background:var(--sur2); border-bottom:1px solid var(--bd); }
.bth { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); }
.bt-row { display:grid; grid-template-columns:1fr 100px 100px 100px 80px; padding:13px 18px; border-bottom:1px solid var(--bd); font-size:13px; align-items:center; }
.bt-row:last-child{border-bottom:none} .bt-row:hover{background:var(--sur2)}
.cady-profile-section { background:linear-gradient(135deg,var(--gold1) 0%,#fff 100%); border:1px solid var(--gold2); border-radius:var(--rad); padding:22px 24px; margin-top:14px; }
.cps-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.cps-title { font-size:16px; font-weight:700; display:flex; align-items:center; gap:8px; }
.profile-form { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.pf-field { display:flex; flex-direction:column; gap:5px; }
.pf-field.full { grid-column:span 2; }
.pf-label { font-size:11px; font-weight:600; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); }
.pf-input,.pf-ta { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:9px 13px; font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; color:var(--t1); outline:none; transition:border-color .15s; }
.pf-input:focus,.pf-ta:focus { border-color:var(--bd2); }
.pf-ta { resize:none; line-height:1.6; }

/* ══ LOAD / COMPARE / PLANS ══ */
.load-shell{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);padding:22px 24px;box-shadow:var(--sh)}
.la-row{display:flex;align-items:center;gap:13px;padding:10px 0;border-bottom:1px solid var(--bd)}
.la-row:last-child{border-bottom:none}
.la-name{font-size:13px;font-weight:600;width:130px;flex-shrink:0}
.la-track{flex:1;height:8px;background:var(--bd);border-radius:4px;overflow:hidden}
.la-fill{height:100%;border-radius:4px;transition:width .8s cubic-bezier(.4,0,.2,1)}
.la-val{font-family:'DM Mono',monospace;font-size:12px;color:var(--t2);width:40px;text-align:right}
.la-st{width:70px;text-align:right}
.cmp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:14px}
.cmp-card{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);padding:20px 22px;box-shadow:var(--sh)}
.cmp-hd{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:13px;border-bottom:1px solid var(--bd)}
.cmp-n{font-size:14px;font-weight:700} .cmp-e{font-size:10px;color:var(--t4);font-family:'DM Mono',monospace}
.cmp-m-l{font-size:9px;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:3px}
.cmp-m-v{font-size:24px;font-weight:800;letter-spacing:-.02em;margin-bottom:2px}
.cmp-m-s{font-family:'DM Mono',monospace;font-size:10px;color:var(--t3)}
.cmp-bars{margin-top:12px;display:flex;flex-direction:column;gap:5px}
.cmp-br{display:flex;align-items:center;gap:5px}
.cmp-bl{font-size:10px;color:var(--t3);width:46px}
.cmp-bw{flex:1;height:5px;background:var(--bd);border-radius:3px;overflow:hidden}
.cmp-bf{height:100%;border-radius:3px}
.cmp-bv{font-family:'DM Mono',monospace;font-size:10px;color:var(--t3);margin-left:3px;width:22px}
.plan-shell{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);overflow:hidden;box-shadow:var(--sh-md)}
.plan-head{display:grid;grid-template-columns:170px repeat(7,1fr);padding:9px 16px;background:var(--sur2);border-bottom:1px solid var(--bd)}
.phc{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4)}
.plan-row{display:grid;grid-template-columns:170px repeat(7,1fr);padding:11px 16px;border-bottom:1px solid var(--bd);align-items:center}
.plan-row:last-child{border-bottom:none} .plan-row:hover{background:var(--sur2)}
.plan-ath{font-size:13px;font-weight:600}
.day-c{display:flex;justify-content:center}
.dd{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:10px;font-family:'DM Mono',monospace;font-weight:500;cursor:pointer;transition:all .1s}
.dd:hover{transform:scale(1.1)}
.dd.done{background:var(--g1);color:var(--g);border:1px solid var(--g2)}
.dd.sched{background:var(--b1);color:var(--b);border:1px solid var(--b2)}
.dd.missed{background:var(--r1);color:var(--r);border:1px solid var(--r2)}
.dd.rest{background:var(--sur3);color:var(--t4);border:1px solid var(--bd)}
.dd.race{background:var(--a1);color:var(--a);border:1px solid var(--a2)}
/* Period summary */
.period-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.period-card{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);padding:20px 22px;box-shadow:var(--sh)}
.period-t{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t3);margin-bottom:14px}
.par{display:flex;align-items:center;gap:9px;padding:8px 0;border-bottom:1px solid var(--bd)}
.par:last-child{border-bottom:none}
.pa-avi{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0}
.pa-name{font-size:13px;font-weight:600;flex:1}
.pa-d{font-family:'DM Mono',monospace;font-size:12px;font-weight:500}

/* ── RELATIONSHIP STATE ── */
.state-banner{display:flex;align-items:center;gap:13px;padding:12px 17px;border-radius:14px;border:1px solid var(--bd);margin-bottom:16px;font-size:13px}
.sb-self{background:var(--sur3);border-color:var(--bd)}
.sb-activated{background:var(--g1);border-color:var(--g2)}
.sb-assigned{background:var(--b1);border-color:var(--b2)}
.sb-icon{font-size:16px;flex-shrink:0}
.sb-main{flex:1}
.sb-title{font-weight:700;margin-bottom:1px}
.sb-sub{font-size:12px;color:var(--t2)}
/* KEY MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(26,24,20,.45);backdrop-filter:blur(8px);z-index:800;display:none;align-items:center;justify-content:center;padding:24px}
.modal-overlay.open{display:flex}
.modal-box{background:var(--sur);border:1px solid var(--bd);border-radius:20px;padding:34px 38px;max-width:460px;width:100%;box-shadow:var(--sh-lg);animation:fadeUp .2s ease both;position:relative}
.modal-title{font-size:18px;font-weight:800;letter-spacing:-.02em;margin-bottom:5px}
.modal-sub{font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:18px}
.key-input-wrap{background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:14px;margin-bottom:12px;text-align:center}
.key-input{background:none;border:none;font-family:'DM Mono',monospace;font-size:20px;font-weight:500;color:var(--t1);outline:none;text-align:center;letter-spacing:.2em;width:100%}
.key-input::placeholder{color:var(--t4);font-size:15px}
.key-disclosure{background:var(--b1);border:1px solid var(--b2);border-radius:8px;padding:11px 13px;font-size:12px;color:var(--b);line-height:1.65;margin-bottom:16px}
.modal-footer{display:flex;gap:8px;justify-content:flex-end}
.modal-close{position:absolute;top:14px;right:16px;background:none;border:none;color:var(--t3);font-size:18px;cursor:pointer;padding:4px;line-height:1}
/* REL BADGE */
.rel-badge{font-size:10px;font-family:'DM Mono',monospace;font-weight:500;padding:4px 10px;border-radius:6px}
.rel-self{background:var(--sur3);color:var(--t2);border:1px solid var(--bd)}
.rel-activated{background:var(--g1);color:var(--g);border:1px solid var(--g2)}
.rel-assigned{background:var(--b1);color:var(--b);border:1px solid var(--b2)}
/* AUTONOMY TOGGLE */
.auto-toggle{display:flex;gap:2px;background:var(--sur3);border:1px solid var(--bd);border-radius:20px;padding:3px}
.at-btn{padding:3px 7px;border-radius:14px;font-size:10px;font-weight:600;border:none;background:none;color:var(--t3);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:all .1s;white-space:nowrap}
.at-btn:hover{color:var(--t1)}
.at-btn.act-f{background:var(--r);color:#fff}
.at-btn.act-p{background:var(--a);color:#fff}
.at-btn.act-o{background:var(--g);color:#fff}
/* EXPIRY BAR */
.expiry-bar{background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:9px 13px;display:flex;align-items:center;gap:11px;margin-top:7px}
.exp-track{flex:1;height:4px;background:var(--bd);border-radius:2px;overflow:hidden}
.exp-fill{height:100%;border-radius:2px;background:var(--g)}
.exp-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--t3);white-space:nowrap}
/* STATE TAG in roster */
.a-state-tag{font-size:9px;font-family:'DM Mono',monospace;font-weight:500;padding:2px 6px;border-radius:4px;margin-top:2px;display:inline-block}


/* ══ v6 SIDEBAR LAYOUT ══ */
:root { --sidebar: 220px; }
.topbar { padding:0 !important; }
.tb-logo-zone { width:var(--sidebar); flex-shrink:0; display:flex; align-items:center; padding:0 20px; border-right:1px solid var(--bd); height:100%; }
.tb-workspace { flex:1; padding:0 18px; display:flex; flex-direction:column; justify-content:center; }
.tb-ws-name { font-size:12px; font-weight:600; color:var(--t1); }
.tb-ws-sub { font-size:10px; font-family:'DM Mono',monospace; color:var(--t4); margin-top:1px; }
.tb-right { display:flex; align-items:center; gap:10px; margin-left:auto; padding-right:18px; }
.notif-btn { width:30px; height:30px; border-radius:8px; background:none; border:none; color:var(--t3); font-size:14px; cursor:pointer; display:flex; align-items:center; justify-content:center; position:relative; transition:background .1s; }
.notif-btn:hover { background:var(--sur3); }
.notif-dot { position:absolute; top:5px; right:5px; width:6px; height:6px; border-radius:50%; background:var(--r); border:1.5px solid var(--bg); }
.sidebar { position:fixed; top:var(--topbar); left:0; bottom:0; width:var(--sidebar); background:var(--sur); border-right:1px solid var(--bd); z-index:300; display:none; flex-direction:column; overflow-y:auto; overflow-x:hidden; }
.sidebar.visible { display:flex; }
.sb-role-switcher { padding:12px 14px 10px; border-bottom:1px solid var(--bd); flex-shrink:0; }
.sb-role-pill { display:flex; background:var(--sur3); border:1px solid var(--bd); border-radius:24px; padding:3px; gap:2px; }
.sb-role-btn { flex:1; padding:5px 6px; border-radius:20px; border:none; background:none; font-family:'Plus Jakarta Sans',sans-serif; font-size:11px; font-weight:600; color:var(--t3); cursor:pointer; transition:all .15s; white-space:nowrap; display:flex; align-items:center; justify-content:center; gap:4px; }
.sb-role-btn.active { background:var(--t1); color:#fff; box-shadow:0 1px 3px rgba(26,24,20,.2); }
body.coach-mode .sb-role-btn.active.coach-btn { background:var(--b); }
.sb-nav { flex:1; padding:8px 0; }
.sb-group { margin-bottom:2px; }
.sb-group-lbl { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:.14em; color:var(--t4); padding:8px 18px 3px; display:block; }
.sb-item { display:flex; align-items:center; gap:9px; padding:7px 14px 7px 16px; cursor:pointer; transition:background .1s; position:relative; border:none; background:none; font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; font-weight:500; color:var(--t2); width:100%; text-align:left; }
.sb-item:hover { background:var(--sur3); color:var(--t1); }
.sb-item.active { background:var(--g1); color:var(--g); font-weight:700; }
body.coach-mode .sb-item.active { background:var(--b1); color:var(--b); }
.sb-item.active::before { content:''; position:absolute; left:0; top:4px; bottom:4px; width:3px; border-radius:0 2px 2px 0; background:var(--g); }
body.coach-mode .sb-item.active::before { background:var(--b); }
.sb-icon { width:18px; text-align:center; font-size:13px; flex-shrink:0; }
.sb-chevron { margin-left:auto; font-size:9px; color:var(--t4); transition:transform .15s; }
.sb-group.open .sb-chevron { transform:rotate(90deg); }
.sb-sub-items { display:none; }
.sb-group.open .sb-sub-items { display:block; }
.sb-sub-item { display:flex; align-items:center; gap:8px; padding:5px 14px 5px 43px; cursor:pointer; font-size:12px; color:var(--t3); transition:all .1s; border:none; background:none; font-family:'Plus Jakarta Sans',sans-serif; width:100%; text-align:left; }
.sb-sub-item:hover { color:var(--t1); background:var(--sur3); }
.sb-sub-item.active { color:var(--g); font-weight:600; }
body.coach-mode .sb-sub-item.active { color:var(--b); }
.sb-badge { margin-left:auto; background:var(--r); color:#fff; font-size:9px; font-weight:700; padding:1px 5px; border-radius:8px; font-family:'DM Mono',monospace; }
.sb-bottom { padding:12px 14px; border-top:1px solid var(--bd); flex-shrink:0; }
.sb-ws-info { background:var(--sur3); border:1px solid var(--bd); border-radius:8px; padding:8px 10px; }
.sb-ws-title { font-weight:700; font-size:12px; }
.sb-ws-detail { font-family:'DM Mono',monospace; font-size:10px; color:var(--t4); margin-top:1px; }
.app { margin-left:var(--sidebar) !important; }
.screen { padding:32px 36px; max-width:1080px; }
/* Coach Home */
.home-grid { display:grid; grid-template-columns:1fr 320px; gap:16px; margin-bottom:16px; }
.daily-summary { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:18px 20px; box-shadow:var(--sh); margin-bottom:12px; }
.ds-eyebrow { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--b); display:flex; align-items:center; gap:6px; margin-bottom:8px; }
.ldot-b { width:7px; height:7px; border-radius:50%; background:var(--b); animation:lp 2s infinite; flex-shrink:0; }
.athlete-spark-row { display:flex; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid var(--bd); cursor:pointer; transition:background .1s; }
.athlete-spark-row:last-child { border-bottom:none; }
.athlete-spark-row:hover { background:var(--sur2); margin:0 -20px; padding:8px 20px; }
.asr-avi { width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:10px; font-weight:700; flex-shrink:0; }
.asr-name { font-size:13px; font-weight:600; flex:1; }
.asr-sparks { display:flex; align-items:flex-end; gap:2px; height:18px; }
.asp { width:5px; border-radius:2px 2px 0 0; }
.asr-score { font-family:'DM Mono',monospace; font-size:13px; font-weight:600; width:26px; text-align:right; }
.asr-status { width:72px; text-align:right; }
.brief-alerts { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); overflow:hidden; box-shadow:var(--sh); margin-bottom:12px; }
.ba-head { padding:12px 16px 10px; border-bottom:1px solid var(--bd); display:flex; align-items:center; justify-content:space-between; }
.ba-head-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t3); }
.ba-count { font-family:'DM Mono',monospace; font-size:11px; color:var(--r); font-weight:600; }
.ba-item { display:flex; align-items:center; gap:9px; padding:10px 16px; border-bottom:1px solid var(--bd); cursor:pointer; transition:background .1s; }
.ba-item:last-child { border-bottom:none; }
.ba-item:hover { background:var(--sur2); }
.ba-item.danger { border-left:3px solid var(--r); }
.ba-item.warn { border-left:3px solid var(--a); }
.ba-item.info { border-left:3px solid var(--b); }
.ba-icon { font-size:13px; flex-shrink:0; }
.ba-main { flex:1; }
.ba-who { font-size:13px; font-weight:700; }
.ba-txt { font-size:11px; color:var(--t2); line-height:1.4; margin-top:1px; }
.ba-time { font-family:'DM Mono',monospace; font-size:10px; color:var(--t4); margin-top:2px; }
.ba-cta { font-size:11px; font-weight:500; background:var(--sur3); border:1px solid var(--bd); border-radius:6px; padding:4px 9px; cursor:pointer; color:var(--t2); font-family:'Plus Jakarta Sans',sans-serif; flex-shrink:0; transition:all .1s; }
.ba-cta:hover { background:var(--t1); color:#fff; }
.quick-actions { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:16px 18px; box-shadow:var(--sh); margin-bottom:12px; }
.qa-title { font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t3); margin-bottom:10px; }
.qa-btn { display:flex; align-items:center; gap:9px; width:100%; padding:8px 11px; background:var(--sur3); border:1px solid var(--bd); border-radius:var(--rad-s); margin-bottom:5px; cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; font-weight:500; color:var(--t1); transition:all .12s; text-align:left; }
.qa-btn:last-child { margin-bottom:0; }
.qa-btn:hover { background:var(--b1); border-color:var(--b2); color:var(--b); }
.roster-snapshot { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad); padding:16px 18px; box-shadow:var(--sh); }
/* Insights tabs */
.insight-tabs { display:flex; gap:0; border-bottom:1px solid var(--bd); margin-bottom:18px; }
.itab { padding:8px 16px; font-size:13px; font-weight:500; cursor:pointer; border:none; background:none; color:var(--t3); font-family:'Plus Jakarta Sans',sans-serif; transition:all .12s; border-bottom:2px solid transparent; margin-bottom:-1px; }
.itab:hover { color:var(--t1); }
.itab.active { color:var(--b); border-bottom-color:var(--b); font-weight:600; }
.itab-content { display:none; }
.itab-content.active { display:block; animation:fadeUp .18s ease both; }
/* Library / Builder */
.library-layout { display:flex; height:calc(100vh - var(--topbar)); margin:-32px -36px; overflow:hidden; }
.lib-sidebar { width:288px; flex-shrink:0; background:var(--sur); border-right:1px solid var(--bd); display:flex; flex-direction:column; overflow:hidden; }
.lib-header { padding:14px 16px 11px; border-bottom:1px solid var(--bd); flex-shrink:0; }
.lib-title { font-size:13px; font-weight:800; margin-bottom:8px; display:flex; align-items:center; justify-content:space-between; }
.lib-search { width:100%; background:var(--sur3); border:1px solid var(--bd); border-radius:var(--rad-s); padding:6px 11px; font-family:'Plus Jakarta Sans',sans-serif; font-size:12px; color:var(--t1); outline:none; }
.lib-search::placeholder { color:var(--t4); }
.lib-filters { display:flex; gap:4px; margin-top:7px; flex-wrap:wrap; }
.lib-filter { padding:3px 9px; border-radius:20px; font-size:11px; font-weight:500; border:1px solid var(--bd); background:var(--sur); color:var(--t3); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.lib-filter:hover { background:var(--sur3); color:var(--t1); }
.lib-filter.active { background:var(--b); color:#fff; border-color:var(--b); }
.lib-body { flex:1; overflow-y:auto; padding:8px; }
.lib-section-lbl { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); padding:8px 4px 4px; display:block; }
.wo-card { background:var(--sur); border:1.5px solid var(--bd); border-radius:10px; padding:9px 11px; margin-bottom:5px; cursor:grab; transition:all .15s; user-select:none; position:relative; }
.wo-card:hover { border-color:var(--bd2); box-shadow:var(--sh); transform:translateY(-1px); }
.wo-card.dragging { opacity:.4; cursor:grabbing; }
.wo-card-top { display:flex; align-items:center; gap:7px; margin-bottom:4px; }
.wo-type-dot { width:6px; height:6px; border-radius:50%; flex-shrink:0; }
.run-dot{background:var(--g)} .bike-dot{background:var(--b)} .swim-dot{background:#7c3aed} .strength-dot{background:var(--a)}
.wo-name { font-size:12px; font-weight:700; flex:1; }
.wo-duration { font-family:'DM Mono',monospace; font-size:10px; color:var(--t4); }
.wo-intervals { display:flex; gap:2px; align-items:flex-end; height:14px; margin-bottom:4px; }
.wi { border-radius:2px 2px 0 0; flex-shrink:0; }
.wi-warmup{background:var(--g1);border:1px solid var(--g2)} .wi-work{background:var(--b2);border:1px solid var(--b)}
.wi-rest{background:var(--bd);border:1px solid var(--bd2)} .wi-cool{background:var(--g1);border:1px solid var(--g2)} .wi-high{background:var(--r2);border:1px solid var(--r)}
.wo-tags { display:flex; gap:3px; flex-wrap:wrap; }
.wo-tag { font-size:9px; font-family:'DM Mono',monospace; font-weight:500; padding:2px 5px; border-radius:4px; }
.tag-z2{background:var(--g1);color:var(--g)} .tag-threshold{background:var(--a1);color:var(--a)}
.tag-vo2{background:var(--r1);color:var(--r)} .tag-recovery{background:var(--sur3);color:var(--t3)}
.tag-race{background:var(--gold1);color:var(--gold)} .tag-long{background:var(--b1);color:var(--b)}
.wo-card-actions { position:absolute; top:6px; right:6px; display:none; gap:2px; }
.wo-card:hover .wo-card-actions { display:flex; }
.wca-btn { width:18px; height:18px; border-radius:4px; background:var(--sur3); border:1px solid var(--bd); display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:9px; color:var(--t2); }
.wca-btn:hover { background:var(--t1); color:#fff; border-color:var(--t1); }
.lib-add-btn { margin:4px; padding:8px; border-radius:var(--rad-s); border:1.5px dashed var(--bd2); background:none; color:var(--t3); font-family:'Plus Jakarta Sans',sans-serif; font-size:12px; font-weight:500; cursor:pointer; width:calc(100% - 8px); transition:all .15s; display:flex; align-items:center; justify-content:center; gap:5px; }
.lib-add-btn:hover { background:var(--b1); color:var(--b); border-color:var(--b2); }
.plan-canvas-area { flex:1; display:flex; flex-direction:column; overflow:hidden; background:var(--bg); min-width:500px; }
.canvas-header { padding:13px 20px 11px; border-bottom:1px solid var(--bd); background:var(--sur); display:flex; align-items:center; gap:12px; flex-shrink:0; }
.plan-name-input { font-size:16px; font-weight:800; letter-spacing:-.02em; background:none; border:none; outline:none; color:var(--t1); font-family:'Plus Jakarta Sans',sans-serif; flex:1; }
.plan-meta-row { font-size:11px; font-family:'DM Mono',monospace; color:var(--t3); margin-top:1px; }
.canvas-toolbar { padding:8px 20px; border-bottom:1px solid var(--bd); background:var(--sur); display:flex; align-items:center; gap:6px; flex-shrink:0; flex-wrap:wrap; }
.tb-btn { padding:5px 11px; border-radius:var(--rad-s); font-size:12px; font-weight:500; border:1px solid var(--bd); background:var(--sur); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; display:flex; align-items:center; gap:5px; }
.tb-btn:hover { background:var(--sur3); color:var(--t1); }
.tb-primary { background:var(--b) !important; color:#fff !important; border-color:var(--b) !important; }
.tb-primary:hover { background:#1d4ed8 !important; }
.phase-legend { display:flex; align-items:center; gap:8px; margin-left:auto; }
.ph-leg { display:flex; align-items:center; gap:4px; font-size:10px; color:var(--t3); }
.ph-leg-dot { width:8px; height:8px; border-radius:2px; }
.weeks-container { flex:1; overflow-y:auto; padding:14px 20px 60px; }
.week-block { margin-bottom:18px; }
.week-header { display:flex; align-items:center; gap:10px; padding:0 2px 7px 0; border-bottom:1px solid var(--bd); }
.wk-stripe { width:3px; height:15px; border-radius:2px; flex-shrink:0; }
.phase-base .wk-stripe{background:var(--g)} .phase-build .wk-stripe{background:var(--b)}
.phase-peak .wk-stripe{background:var(--a)} .phase-taper .wk-stripe{background:#7c3aed}
.wk-num { font-family:'DM Mono',monospace; font-size:10px; font-weight:500; color:var(--t4); }
.wk-phase { font-size:11px; font-weight:700; }
.phase-base .wk-phase{color:var(--g)} .phase-build .wk-phase{color:var(--b)}
.phase-peak .wk-phase{color:var(--a)} .phase-taper .wk-phase{color:#7c3aed}
.wk-load { font-family:'DM Mono',monospace; font-size:10px; color:var(--t4); }
.wk-vol-bar { flex:1; max-width:80px; height:2px; background:var(--bd); border-radius:2px; overflow:hidden; }
.wk-vol-fill { height:100%; border-radius:2px; }
.phase-base .wk-vol-fill{background:var(--g)} .phase-build .wk-vol-fill{background:var(--b)}
.phase-peak .wk-vol-fill{background:var(--a)} .phase-taper .wk-vol-fill{background:#7c3aed}
.wk-actions { display:none; gap:4px; margin-left:auto; }
.week-block:hover .wk-actions { display:flex; }
.wk-act { padding:3px 7px; border-radius:var(--rad-s); font-size:10px; font-weight:500; border:1px solid var(--bd); background:var(--sur); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.wk-act:hover { background:var(--t1); color:#fff; border-color:var(--t1); }
.week-days { display:grid; grid-template-columns:repeat(7,1fr); background:var(--sur); border:1px solid var(--bd); border-radius:10px; overflow:hidden; margin-top:7px; }
.day-head { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); padding:6px 0 5px; text-align:center; border-bottom:1px solid var(--bd); border-right:1px solid var(--bd); }
.day-head:last-child { border-right:none; }
.day-cell { min-height:78px; border-right:1px solid var(--bd); padding:5px; position:relative; transition:background .1s; }
.day-cell:last-child { border-right:none; }
.day-cell.drop-target { background:var(--b1); outline:2px dashed var(--b2); outline-offset:-2px; }
.day-cell:hover { background:rgba(37,99,235,0.02); }
.placed-wo { display:flex; border-radius:5px; overflow:hidden; margin-bottom:3px; cursor:grab; position:relative; }
.placed-wo-stripe { width:3px; flex-shrink:0; }
.placed-wo-body { flex:1; padding:4px 6px; min-width:0; }
.placed-wo-name { font-weight:700; font-size:10px; color:var(--t1); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.placed-wo-meta { font-family:'DM Mono',monospace; font-size:9px; color:var(--t3); }
.placed-wo-del { position:absolute; top:2px; right:2px; width:12px; height:12px; border-radius:3px; background:rgba(220,53,69,.1); display:none; align-items:center; justify-content:center; font-size:8px; color:var(--r); cursor:pointer; }
.placed-wo:hover .placed-wo-del { display:flex; }
.placed-run .placed-wo-stripe{background:var(--g)} .placed-run .placed-wo-body{background:rgba(26,158,110,0.06)}
.placed-bike .placed-wo-stripe{background:var(--b)} .placed-bike .placed-wo-body{background:rgba(37,99,235,0.06)}
.placed-swim .placed-wo-stripe{background:#7c3aed} .placed-swim .placed-wo-body{background:rgba(124,58,237,0.06)}
.placed-strength .placed-wo-stripe{background:var(--a)} .placed-strength .placed-wo-body{background:rgba(217,119,6,0.06)}
.empty-drop { text-align:center; padding-top:20px; font-size:11px; color:var(--t4); cursor:pointer; }
.empty-drop:hover { color:var(--b); }
/* Builder overlay */
.builder-overlay { position:fixed; inset:0; background:rgba(26,24,20,.4); backdrop-filter:blur(5px); z-index:600; display:none; align-items:flex-end; justify-content:flex-end; padding-top:var(--topbar); }
.builder-overlay.open { display:flex; }
.builder-panel { width:460px; height:100%; background:var(--sur); border-left:1px solid var(--bd); display:flex; flex-direction:column; overflow:hidden; animation:slideIn .2s cubic-bezier(.4,0,.2,1) both; box-shadow:0 8px 32px rgba(26,24,20,.14); }
@keyframes slideIn { from{transform:translateX(100%)} to{transform:translateX(0)} }
.bp-header { padding:16px 18px 13px; border-bottom:1px solid var(--bd); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
.bp-title { font-size:14px; font-weight:800; }
.bp-close { width:24px; height:24px; border-radius:6px; background:var(--sur3); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; color:var(--t2); font-size:14px; }
.bp-close:hover { background:var(--t1); color:#fff; }
.bp-body { flex:1; overflow-y:auto; padding:14px 18px; }
.bp-section { margin-bottom:14px; }
.bp-label { font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:.12em; color:var(--t4); margin-bottom:5px; }
.bp-input { width:100%; background:var(--sur3); border:1px solid var(--bd); border-radius:var(--rad-s); padding:7px 11px; font-family:'Plus Jakarta Sans',sans-serif; font-size:13px; color:var(--t1); outline:none; }
.bp-input:focus { border-color:var(--b); background:var(--sur); }
.bp-row { display:grid; grid-template-columns:1fr 1fr; gap:9px; }
.sport-select { display:grid; grid-template-columns:repeat(4,1fr); gap:5px; }
.sport-opt { padding:7px 4px; border-radius:var(--rad-s); border:1.5px solid var(--bd); background:var(--sur3); text-align:center; cursor:pointer; transition:all .12s; }
.sport-opt:hover { border-color:var(--bd2); }
.sport-opt.selected { border-color:var(--b); background:var(--b1); }
.sport-opt-icon { font-size:15px; margin-bottom:2px; }
.sport-opt-lbl { font-size:10px; font-weight:600; color:var(--t2); }
.sport-opt.selected .sport-opt-lbl { color:var(--b); }
.interval-canvas { background:var(--sur3); border:1px solid var(--bd); border-radius:var(--rad-s); padding:10px; }
.interval-track { display:flex; align-items:flex-end; gap:2px; height:40px; margin-bottom:7px; }
.int-block { border-radius:3px 3px 0 0; cursor:pointer; transition:all .1s; }
.int-block.selected { outline:2px solid var(--t1); outline-offset:1px; }
.int-warmup{background:linear-gradient(to top,var(--g2),var(--g1));border:1px solid var(--g)}
.int-work{background:linear-gradient(to top,rgba(37,99,235,.25),var(--b2));border:1px solid var(--b)}
.int-rest{background:var(--bd);border:1px solid var(--bd2)}
.int-cool{background:linear-gradient(to top,var(--g2),var(--g1));border:1px solid var(--g)}
.int-hard{background:linear-gradient(to top,var(--r2),var(--r1));border:1px solid var(--r)}
.int-add-bar { display:flex; gap:4px; flex-wrap:wrap; }
.int-add-btn { padding:3px 8px; border-radius:var(--rad-s); font-size:10px; font-weight:600; border:1px solid var(--bd); background:var(--sur); color:var(--t2); cursor:pointer; font-family:'Plus Jakarta Sans',sans-serif; transition:all .1s; }
.int-add-btn:hover { background:var(--t1); color:#fff; border-color:var(--t1); }
.int-detail { background:var(--sur); border:1px solid var(--bd); border-radius:var(--rad-s); padding:9px 11px; margin-top:7px; display:none; }
.int-detail.show { display:block; }
.target-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; }
.target-box { background:var(--sur3); border:1px solid var(--bd); border-radius:6px; padding:6px 8px; }
.tgt-lbl { font-size:9px; text-transform:uppercase; letter-spacing:.1em; color:var(--t4); margin-bottom:2px; }
.tgt-input { background:none; border:none; font-family:'DM Mono',monospace; font-size:12px; font-weight:500; color:var(--t1); outline:none; width:100%; }
.int-summary { display:flex; gap:10px; padding:7px 0 0; border-top:1px solid var(--bd); margin-top:7px; font-size:11px; font-family:'DM Mono',monospace; color:var(--t3); }
.int-summary strong { color:var(--t1); font-weight:500; }
.bp-footer { padding:12px 18px; border-top:1px solid var(--bd); display:flex; gap:8px; justify-content:flex-end; flex-shrink:0; }
.toast { position:fixed; bottom:22px; left:50%; transform:translateX(-50%) translateY(16px); background:var(--t1); color:#fff; padding:8px 16px; border-radius:var(--rad-s); font-size:13px; font-weight:500; z-index:900; opacity:0; transition:all .22s; pointer-events:none; }
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* ══ INSIGHTS MODULE ══ */
@import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap');
.ins-wrap { max-width: 900px; margin: 0 auto; }
/* Rings */
.rings-row { display: flex; justify-content: center; gap: 40px; margin-bottom: 32px; flex-wrap: wrap; }
.ring-cell { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
.ring-svg { position: relative; }
.ring-track { fill: none; stroke: #e8e8e8; }
.ring-fill { fill: none; stroke-linecap: round; transition: stroke-dashoffset 0.8s cubic-bezier(.4,0,.2,1); }
.ring-label { font-family: 'DM Sans', sans-serif; font-weight: 700; font-size: 13px; letter-spacing: .06em; text-transform: uppercase; color: #666; margin-top: 10px; }
.ring-sublabel { font-size: 12px; color: #aaa; margin-top: 2px; font-family: 'DM Sans', sans-serif; }
.ring-sentence { font-size: 12px; color: #666; margin-top: 6px; max-width: 160px; text-align: center; line-height: 1.5; font-family: 'DM Sans', sans-serif; }
.ring-center-val { font-family: 'DM Serif Display', serif; font-size: 26px; fill: #1a1a1a; }
.ring-center-sub { font-family: 'DM Sans', sans-serif; font-size: 10px; fill: #aaa; }
/* Load bar (ring 2 special) */
.load-bar-wrap { width: 140px; height: 140px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.load-bar-track { width: 120px; height: 8px; background: #eee; border-radius: 4px; position: relative; margin: 10px 0; overflow: visible; }
.load-bar-center { position: absolute; left: 50%; top: -3px; width: 1px; height: 14px; background: #ccc; }
.load-bar-fill { height: 100%; border-radius: 4px; background: #f59e0b; transition: width .8s cubic-bezier(.4,0,.2,1); }
.load-pct { font-family: 'DM Serif Display', serif; font-size: 26px; color: #f59e0b; }
/* Today action */
.today-action { background: #fff; border: 1.5px solid #3b82f6; border-left: 4px solid #3b82f6; border-radius: 14px; padding: 20px 24px; margin-bottom: 24px; display: flex; align-items: center; gap: 20px; box-shadow: 0 2px 12px rgba(0,0,0,.06); }
.ta-icon { font-size: 32px; flex-shrink: 0; }
.ta-body { flex: 1; }
.ta-title { font-family: 'DM Serif Display', serif; font-size: 18px; color: #1a1a1a; margin-bottom: 4px; }
.ta-sub { font-size: 13px; color: #666; font-family: 'DM Sans', sans-serif; line-height: 1.5; }
.ta-actions { display: flex; flex-direction: column; gap: 8px; align-items: flex-end; flex-shrink: 0; }
.ta-btn { background: #1a1a1a; color: #fff; border: none; border-radius: 8px; padding: 10px 18px; font-size: 13px; font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif; white-space: nowrap; transition: background .15s; }
.ta-btn:hover { background: #333; }
.ta-swap { font-size: 12px; color: #aaa; cursor: pointer; font-family: 'DM Sans', sans-serif; text-decoration: underline; text-underline-offset: 3px; }
/* Week strip */
.week-strip { display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding-bottom: 4px; }
.day-card { flex: 1; min-width: 72px; max-width: 100px; background: #fff; border: 1.5px solid #e8e8e8; border-radius: 12px; padding: 12px 8px; display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; transition: all .15s; box-shadow: 0 1px 4px rgba(0,0,0,.04); }
.day-card:hover { border-color: #ccc; transform: translateY(-1px); box-shadow: 0 3px 10px rgba(0,0,0,.08); }
.day-card.today { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.12); }
.day-card.selected { border-color: #1a1a1a; background: #f8f8f6; }
.day-label { font-size: 10px; font-weight: 700; letter-spacing: .1em; text-transform: uppercase; color: #aaa; font-family: 'DM Sans', sans-serif; }
.day-dot { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; position: relative; }
.day-dot.done { }
.day-dot.today-pulse { animation: today-ring 2s ease-in-out infinite; }
@keyframes today-ring { 0%,100%{box-shadow:0 0 0 0 rgba(59,130,246,.3)} 50%{box-shadow:0 0 0 6px rgba(59,130,246,.05)} }
.day-dot.planned { border: 2px dashed #ccc; background: transparent; }
.day-dot.rest-dot { background: #e5e5e5; }
.day-sport { font-size: 9px; font-family: 'JetBrains Mono', monospace; color: #aaa; text-align: center; line-height: 1.3; }
.day-dur { font-size: 10px; font-family: 'JetBrains Mono', monospace; color: #888; }
/* Workout detail chart */
.wdc { background: #0f0f0f; border-radius: 20px; padding: 24px; margin-bottom: 24px; }
.wdc-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
.wdc-label { font-family: 'DM Mono', monospace; font-size: 11px; color: #555; letter-spacing: .08em; text-transform: uppercase; margin-bottom: 4px; }
.wdc-title { font-family: 'DM Serif Display', serif; font-size: 18px; color: #fff; }
.view-chips { display: flex; gap: 5px; flex-wrap: wrap; }
.vchip { padding: 5px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; border: 1px solid #2a2a2a; background: transparent; color: #888; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: all .12s; }
.vchip:hover { color: #ccc; border-color: #444; }
.vchip.active { background: #3b82f6; color: #fff; border-color: #3b82f6; }
.compare-chips { display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap; }
.cchip { padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 500; border: 1px solid #2a2a2a; background: transparent; color: #555; cursor: pointer; font-family: 'DM Mono', monospace; transition: all .12s; }
.cchip:hover { color: #888; }
.cchip.active { background: #3b82f6; color: #fff; border-color: #3b82f6; }
.scrub-tooltip { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px; padding: 8px 14px; font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #888; min-height: 32px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.scrub-time { color: #fff; font-weight: 500; }
.scrub-val { }
.wdc-panels { position: relative; }
.chart-panel { border-top: 1px solid #1e1e1e; padding-top: 8px; position: relative; overflow: hidden; }
.chart-panel:first-child { border-top: none; padding-top: 0; }
.cp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.cp-metric { font-size: 10px; font-weight: 600; letter-spacing: .1em; text-transform: uppercase; font-family: 'DM Sans', sans-serif; display: flex; align-items: center; gap: 5px; }
.cp-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.cp-scrub-val { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600; }
.chart-svg { display: block; width: 100%; }
.lap-marker { font-size: 9px; fill: #333; font-family: 'DM Mono', monospace; }
/* Insight cards */
.insight-card { border-radius: 16px; padding: 22px 24px; margin-bottom: 12px; transition: box-shadow .15s; }
.ic-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 10px; }
.ic-badge { font-size: 10px; font-weight: 700; letter-spacing: .06em; text-transform: uppercase; padding: 3px 9px; border-radius: 6px; font-family: 'DM Sans', sans-serif; }
.badge-red { background: #fce8e8; color: #ef4444; }
.badge-amber { background: #fef3c7; color: #d97706; }
.badge-ghost { background: #f0f0f0; color: #666; }
.ic-confidence { font-size: 10px; color: #aaa; font-family: 'DM Sans', sans-serif; }
.ic-title { font-family: 'DM Serif Display', serif; font-size: 18px; color: #1a1a1a; margin-bottom: 7px; line-height: 1.3; }
.ic-sowhat { font-size: 14px; color: #444; line-height: 1.6; margin-bottom: 12px; font-family: 'DM Sans', sans-serif; }
.ic-footer { display: flex; align-items: center; justify-content: space-between; }
.ic-expand { font-size: 13px; color: #3b82f6; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 500; background: none; border: none; padding: 0; }
.ic-expand:hover { text-decoration: underline; }
.ic-action-btn { background: #ef4444; color: #fff; border: none; border-radius: 8px; padding: 8px 16px; font-size: 12px; font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: background .12s; }
.ic-action-btn:hover { background: #dc2626; }
.ic-expanded-body { margin-top: 16px; padding-top: 16px; border-top: 1px solid #e8e8e8; display: none; }
.ic-expanded-body.open { display: block; animation: fadeUp .18s ease both; }
.ic-section-lbl { font-size: 10px; font-weight: 700; letter-spacing: .12em; text-transform: uppercase; color: #aaa; margin-bottom: 4px; font-family: 'DM Sans', sans-serif; }
.ic-section-txt { font-size: 14px; color: #444; line-height: 1.6; margin-bottom: 14px; font-family: 'DM Sans', sans-serif; }
.ic-mini-chart { background: #111; border-radius: 12px; padding: 16px 18px; margin-top: 4px; }
.ic-mini-title { font-size: 10px; color: #555; letter-spacing: .1em; text-transform: uppercase; margin-bottom: 10px; font-family: 'DM Sans', sans-serif; }
.ic-mini-note { font-size: 11px; margin-top: 8px; font-family: 'JetBrains Mono', monospace; }
/* Coach Roster (Insights coach mode) */
.roster-radar { background: #fff; border: 1px solid var(--bd); border-radius: var(--rad); overflow: hidden; box-shadow: var(--sh-md); margin-bottom: 16px; }
.group-event-banner { background: linear-gradient(135deg, var(--b1) 0%, #f0f7ff 100%); border: 1px solid var(--b2); border-radius: var(--rad); padding: 14px 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.geb-left { }
.geb-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--b); margin-bottom: 3px; }
.geb-title { font-size: 15px; font-weight: 700; }
.roster-row { display: grid; grid-template-columns: 1fr 70px 70px 100px auto; align-items: center; padding: 11px 18px; border-bottom: 1px solid var(--bd); cursor: pointer; transition: background .1s; }
.roster-row:hover { background: var(--sur2); }
.roster-row.expanded-row { background: var(--sur2); }
.rr-name { font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
.rr-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; display: inline-block; }
.rr-action { display: flex; justify-content: flex-end; }
.rr-expand { background: none; border: 1px solid var(--bd); border-radius: var(--rad-s); padding: 4px 10px; font-size: 11px; color: var(--t2); cursor: pointer; font-family: 'Plus Jakarta Sans', sans-serif; transition: all .1s; }
.rr-expand:hover { background: var(--t1); color: #fff; border-color: var(--t1); }
.roster-expanded { padding: 14px 18px 16px; background: var(--sur); border-bottom: 1px solid var(--bd); display: none; }
.roster-expanded.open { display: block; animation: fadeUp .15s ease both; }
.re-insight { font-size: 13px; color: var(--t2); line-height: 1.6; margin-bottom: 10px; padding: 10px 13px; background: var(--sur2); border-radius: var(--rad-s); border-left: 3px solid var(--a); }
.re-textarea { width: 100%; background: var(--sur3); border: 1px solid var(--bd); border-radius: var(--rad-s); padding: 9px 12px; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; color: var(--t1); resize: none; outline: none; line-height: 1.65; }
/* Group chart */
.gc-panel { background: #0f0f0f; border-radius: 20px; padding: 24px; margin-bottom: 16px; }
.gc-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; }
.gc-title { font-family: 'DM Serif Display', serif; font-size: 18px; color: #fff; }
.gc-sub { font-size: 11px; color: #555; margin-top: 3px; font-family: 'DM Mono', monospace; }
.gc-layout { display: flex; gap: 16px; }
.gc-chart-area { flex: 1; min-width: 0; }
.gc-legend { width: 140px; flex-shrink: 0; }
.gc-ath-name { font-size: 12px; font-weight: 600; padding: 5px 8px; border-radius: 6px; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: all .12s; display: flex; align-items: center; gap: 7px; margin-bottom: 3px; }
.gc-ath-name:hover { background: #1a1a1a; }
.gc-ath-name.highlighted { background: #1a1a1a; }
.gc-ath-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.ath-detail { background: #1a1a1a; border-radius: 10px; padding: 12px 14px; margin-top: 10px; display: none; }
.ath-detail.open { display: block; animation: fadeUp .15s ease both; }
.ath-detail-name { font-family: 'DM Serif Display', serif; font-size: 14px; color: #fff; margin-bottom: 8px; }
.ath-stat-row { display: flex; justify-content: space-between; font-size: 11px; padding: 4px 0; border-bottom: 1px solid #222; }
.ath-stat-row:last-child { border-bottom: none; }
.ath-stat-lbl { color: #555; font-family: 'DM Mono', monospace; }
.ath-stat-val { color: #fff; font-family: 'JetBrains Mono', monospace; font-weight: 500; }
</style>
</head>
<body>

<!-- ══════════════════════════════════════
     ONBOARDING OVERLAY
══════════════════════════════════════ -->
<div class="onboard-overlay" id="onboard">
  <div class="onboard-box">
    <div class="ob-logo">Coreformance<span>.</span></div>
    <div class="ob-step" id="ob-step-lbl">Step 1 of 2</div>
    <div class="ob-progress" id="ob-progress">
      <div class="ob-prog-dot active"></div>
      <div class="ob-prog-dot"></div>
    </div>

    <!-- Step 1: Role -->
    <div id="ob-s1">
      <div class="ob-q">How will you use Coreformance?</div>
      <div class="ob-sub">This determines your experience. You can always switch roles later.</div>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectRole('coach',this)">
          <div class="ob-opt-icon">📋</div>
          <div class="ob-opt-text">
            <div class="ob-opt-title">I'm a Coach</div>
            <div class="ob-opt-desc">Manage athletes, assign programs, monitor performance at scale</div>
          </div>
        </div>
        <div class="ob-opt" onclick="selectRole('athlete',this)">
          <div class="ob-opt-icon">🏃</div>
          <div class="ob-opt-text">
            <div class="ob-opt-title">I'm an Athlete</div>
            <div class="ob-opt-desc">Track your training, connect with a coach, and build toward your race</div>
          </div>
        </div>
      </div>
      <div class="ob-footer">
        <button class="btn btn-p" id="ob-next1" onclick="obNext()" disabled style="opacity:.4;cursor:not-allowed">Continue →</button>
      </div>
    </div>

    <!-- Step 2: Sport -->
    <div id="ob-s2" style="display:none">
      <div class="ob-q">What's your primary sport?</div>
      <div class="ob-sub">We'll calibrate your metrics and recommendations around this.</div>
      <div class="ob-options">
        <div class="ob-opt" onclick="selectSport('triathlon',this)">
          <div class="ob-opt-icon">🏊</div>
          <div class="ob-opt-text"><div class="ob-opt-title">Triathlon</div><div class="ob-opt-desc">Swim, bike, run — multi-sport tracking</div></div>
        </div>
        <div class="ob-opt" onclick="selectSport('running',this)">
          <div class="ob-opt-icon">🏃</div>
          <div class="ob-opt-text"><div class="ob-opt-title">Running</div><div class="ob-opt-desc">Road, trail, track</div></div>
        </div>
        <div class="ob-opt" onclick="selectSport('cycling',this)">
          <div class="ob-opt-icon">🚴</div>
          <div class="ob-opt-text"><div class="ob-opt-title">Cycling</div><div class="ob-opt-desc">Road, gravel, criterium</div></div>
        </div>
        <div class="ob-opt" onclick="selectSport('other',this)">
          <div class="ob-opt-icon">🏊</div>
          <div class="ob-opt-text"><div class="ob-opt-title">Swimming / Other</div><div class="ob-opt-desc">Open water, pool, cross-training</div></div>
        </div>
      </div>
      <div class="ob-footer" style="gap:10px;justify-content:space-between">
        <button class="btn btn-ghost" onclick="obBack()">← Back</button>
        <button class="btn btn-p" id="ob-next2" onclick="obFinish()" disabled style="opacity:.4;cursor:not-allowed">Enter Coreformance →</button>
      </div>
    </div>
      <!-- Step 2b: Athlete type -->
    <div id="ob-s2-athlete" style="display:none">
      <div class="ob-q">Are you on a team or school program?</div>
      <div class="ob-sub">Everyone starts self-coached by default — your coach relationship layers in naturally whenever you're ready.</div>
      <div class="ob-opts">
        <div class="ob-opt" onclick="obSelAthType('team',this)">
          <div class="ob-opt-ic">&#x1F3EB;</div>
          <div><div class="ob-opt-title">Yes — I'm on a team or school</div><div class="ob-opt-desc">Enter your team invite code to connect to your assigned coach</div></div>
        </div>
        <div class="ob-opt" onclick="obSelAthType('independent',this)">
          <div class="ob-opt-ic">&#x26A1;</div>
          <div><div class="ob-opt-title">No — I train independently</div><div class="ob-opt-desc">Start self-coached. Add a coach anytime via activation key or Discover</div></div>
        </div>
      </div>
      <div id="ob-team-code" style="display:none;margin-top:12px">
        <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:7px">Team Invite Code</div>
        <input style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:13px 16px;font-family:'DM Mono',monospace;font-size:16px;color:var(--t1);outline:none;text-align:center;letter-spacing:.12em" id="ob-team-input" placeholder="Paste your code here" oninput="obCheckTeamCode()">
        <div style="text-align:center;font-size:13px;color:var(--t3);cursor:pointer;text-decoration:underline;text-underline-offset:3px;margin-top:11px" onclick="obSelAthType('independent',document.querySelector('#ob-s2-athlete .ob-opt:last-child'))">Continue without a code →</div>
      </div>
      <div class="ob-footer" style="margin-top:18px">
        <button class="ob-back" onclick="obBack()">← Back</button>
        <button class="btn btn-p" id="ob-btn-ath" onclick="obFinishAthlete()" disabled style="opacity:.4;cursor:not-allowed">Enter Coreformance →</button>
      </div>
    </div>
    </div>
</div>

<!-- ══════════════════════════════════════
     TOPBAR
══════════════════════════════════════ -->

<!-- ACTIVATION KEY MODAL -->
<div class="modal-overlay" id="key-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal()">&#x2715;</button>
    <div class="modal-title">Enter Activation Key</div>
    <div class="modal-sub">Your coach shared this key — enter it to link their program, activate your training plan, and open a direct channel with your coach.</div>
    <div class="key-input-wrap">
      <input class="key-input" id="key-input" placeholder="XXXX — XXXX — XXXX" maxlength="18" oninput="formatKey(this)">
    </div>
    <div class="key-disclosure"><strong>What this does:</strong> Entering this key links you to your coach's program, activates the structured plan, and opens a direct communication channel. Your coach receives access to your performance data for the program term. The relationship auto-expires at term end — you revert to self-coached unless renewed.</div>
    <div class="modal-footer">
      <button class="btn btn-ghost" style="font-size:12px;padding:6px 13px" onclick="closeModal()">Cancel</button>
      <button class="btn btn-g" style="font-size:12px;padding:6px 13px" onclick="activateKey()">Activate Key →</button>
    </div>
  </div>
</div>

<!-- TOPBAR -->
<div class="topbar" id="topbar" style="display:none">
  <div class="tb-logo-zone">
    <div class="logo">Coreformance<span class="logo-dot">.</span></div>
  </div>
  <div class="tb-workspace" id="tb-workspace">
    <div class="tb-ws-name" id="tb-ws-name">Marcus Reid</div>
    <div class="tb-ws-sub" id="tb-ws-sub">Self-Coached · Ironman 70.3 · 47d</div>
  </div>
  <div class="tb-right">
    <div id="tb-coach-strip" style="display:none; align-items:center; gap:8px; background:var(--g1); border:1px solid var(--g2); border-radius:20px; padding:4px 12px; font-size:11px; font-family:'DM Mono',monospace; color:var(--g);"></div>
    <div class="race-tag" id="race-tag"><div class="rdot"></div>70.3 · 47d</div>
    <button class="notif-btn" title="Notifications">🔔<div class="notif-dot"></div></button>
    <div class="uavi a" id="uavi">MR</div>
  </div>
</div>
<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div class="sb-role-switcher" id="sb-role-switcher" style="display:none">
    <div class="sb-role-pill">
      <button class="sb-role-btn active" id="sb-athlete-btn" onclick="setMode('athlete')">🏃 Athlete</button>
      <button class="sb-role-btn coach-btn" id="sb-coach-btn" onclick="setMode('coach')">📋 Coach</button>
    </div>
  </div>
  <nav class="sb-nav" id="sb-nav"></nav>
  <div class="sb-bottom">
    <div class="sb-ws-info">
      <div class="sb-ws-title" id="sb-ws-title">Marcus Reid</div>
      <div class="sb-ws-detail" id="sb-ws-detail">Self-Coached</div>
    </div>
  </div>
</div>
<!-- TOAST -->
<div class="toast" id="toast"></div>

<div class="app" id="main-app" style="display:none">

<!-- ══════════════════════════════════════════
     ATHLETE: TODAY
══════════════════════════════════════════ -->
<div class="screen active" id="screen-today">
  <!-- Relationship State Banner -->
  <div class="state-banner sb-self" id="state-banner">
    <div class="sb-icon">&#x2699;&#xFE0F;</div>
    <div class="sb-main">
      <div class="sb-title">Self-Coached</div>
      <div class="sb-sub">You're running your own program. Add a coach anytime — enter an activation key or browse Discover.</div>
    </div>
    <button class="btn btn-ghost" style="font-size:12px;padding:6px 13px;flex-shrink:0" onclick="openModal()">Enter Key</button>
    <button class="btn btn-ghost" style="font-size:12px;padding:6px 13px;flex-shrink:0" onclick="go('discover')">Discover</button>
  </div>

  <div class="ph"><div class="ph-t">Good morning, Marcus.</div><div class="ph-s">Saturday, February 21 · Here's everything you need.</div></div>
  <div class="readiness-hero">
    <div>
      <div class="rh-greet">Your readiness today</div>
      <div style="display:flex;align-items:baseline;gap:14px;margin-bottom:8px">
        <div class="rh-score">82</div>
        <div><div class="rh-status">Productive</div><div class="rh-desc">Ready for quality training.</div></div>
      </div>
      <div class="rh-bullets">
        <div class="rh-b"><div class="rh-dot" style="background:var(--g)"></div>Fitness rising at a safe rate</div>
        <div class="rh-b"><div class="rh-dot" style="background:var(--a)"></div>Fatigue manageable — ratio healthy</div>
        <div class="rh-b"><div class="rh-dot" style="background:var(--g)"></div>Safe to train hard today</div>
      </div>
      <div class="spark"><div class="spark-lbl">7-day readiness</div><div class="spark-bars"><div class="sbar" style="height:55%"></div><div class="sbar" style="height:48%"></div><div class="sbar" style="height:70%"></div><div class="sbar" style="height:62%"></div><div class="sbar" style="height:54%"></div><div class="sbar" style="height:76%"></div><div class="sbar now" style="height:82%"></div></div></div>
    </div>
    <div class="rh-right">
      <div class="rec-eye"><div class="ldot"></div>Today's Session</div>
      <div class="rec-title">Zone 2 Aerobic Run</div>
      <div class="rec-sub">55 MIN · HR &lt;145 BPM · EASY EFFORT</div>
      <div class="rec-why">Fitness rising faster than fatigue. Extending that gap with low-stress volume is the highest-value thing you can do today.</div>
      <div class="imp-grid">
        <div class="imp-t"><div class="imp-l">Fitness gain</div><div class="imp-v up">+0.4 pts</div></div>
        <div class="imp-t"><div class="imp-l">Fatigue cost</div><div class="imp-v warn">+1.1 pts</div></div>
        <div class="imp-t"><div class="imp-l">Risk level</div><div class="imp-v up">Low</div></div>
        <div class="imp-t"><div class="imp-l">Coach assigned</div><div class="imp-v info">Yes</div></div>
      </div>
      <button class="btn btn-g" style="width:100%;justify-content:center">▶ Start Session</button>
    </div>
  </div>
  <div class="kpi-strip">
    <div class="kpi"><div class="kpi-l">Fitness Score</div><div class="kpi-v up">72</div><div class="kpi-d up">↑ +3.2 this week</div></div>
    <div class="kpi"><div class="kpi-l">Fatigue Score</div><div class="kpi-v warn">61</div><div class="kpi-d muted">→ stable</div></div>
    <div class="kpi"><div class="kpi-l">Training Load</div><div class="kpi-v">482</div><div class="kpi-d muted">TSS this week</div></div>
    <div class="kpi"><div class="kpi-l">Consistency</div><div class="kpi-v">87<span style="font-size:13px;color:var(--t4)">%</span></div><div class="kpi-d up">↑ last 30 days</div></div>
    <div class="kpi"><div class="kpi-l">Recovery</div><div class="kpi-v up" style="font-size:17px;padding-top:4px">Good</div><div class="kpi-d muted">18h to next hard</div></div>
  </div>
  <div class="g2">
    <div class="ts-card"><div class="ts-hd">Trend Summary — 30 Days</div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Fitness</div><div class="ts-m">Score 61 → 72</div></div><div class="ts-r"><div class="ts-verdict up">↑ Improving</div><div class="ts-bar" style="width:56px"><div class="ts-bf" style="width:72%;background:var(--g)"></div></div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Fatigue</div><div class="ts-m">Score 58 → 61</div></div><div class="ts-r"><div class="ts-verdict muted">→ Stable</div><div class="ts-bar"><div class="ts-bf" style="width:61%;background:var(--a)"></div></div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Form</div><div class="ts-m">Fitness minus fatigue</div></div><div class="ts-r"><div class="ts-verdict info">+11 Fresh</div><div class="ts-bar"><div class="ts-bf" style="width:60%;background:var(--b)"></div></div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Injury Risk</div><div class="ts-m">Load ramp rate</div></div><div class="ts-r"><div class="ts-verdict up">Low</div><div class="ts-bar"><div class="ts-bf" style="width:18%;background:var(--g)"></div></div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Race Readiness</div><div class="ts-m">47 days out</div></div><div class="ts-r"><div class="ts-verdict info">On Track</div><div class="ts-bar"><div class="ts-bf" style="width:80%;background:var(--b)"></div></div></div></div>
    </div>
    <div class="ts-card"><div class="ts-hd">This Week vs Last Week</div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Fitness</div><div class="ts-m">Week over week</div></div><div class="ts-r"><div class="ts-verdict up">↑ +3.2 pts</div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Fatigue</div><div class="ts-m">Week over week</div></div><div class="ts-r"><div class="ts-verdict muted">+1.4 pts</div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Sessions</div><div class="ts-m">Completed</div></div><div class="ts-r"><div class="ts-verdict">6 of 7</div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Total Load</div><div class="ts-m">TSS</div></div><div class="ts-r"><div class="ts-verdict up">482</div></div></div>
      <div class="ts-row"><div class="ts-l"><div class="ts-name">Proj. Race Fitness</div><div class="ts-m">At current trajectory</div></div><div class="ts-r"><div class="ts-verdict info">84 pts</div></div></div>
    </div>
  </div>
</div>

<!-- ══ ATHLETE: TRAINING ══ -->
<div class="screen" id="screen-training">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Training</div><div class="ph-s">Your assigned plan and session history.</div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:12px">Week View</button><button class="btn btn-ghost" style="font-size:12px">Month View</button></div></div></div>
  <!-- Self-coached plan builder (shown conditionally) -->
  <div class="plan-builder" id="self-plan-builder" style="display:none">
    <div class="pb-header"><div class="pb-title">Week Builder — Feb 17–23</div><button class="btn btn-b" style="font-size:12px">+ Add Workout</button></div>
    <div class="week-grid">
      <div class="wday has-workout"><div class="wd-day">Mon</div><div class="wd-icon">🚴</div><div class="wd-type">Tempo Bike</div></div>
      <div class="wday has-workout"><div class="wd-day">Tue</div><div class="wd-icon">🏃</div><div class="wd-type">Z2 Run</div></div>
      <div class="wday rest"><div class="wd-day">Wed</div><div class="wd-icon">—</div><div class="wd-type">Rest</div></div>
      <div class="wday has-workout"><div class="wd-day">Thu</div><div class="wd-icon">🏊</div><div class="wd-type">Swim</div></div>
      <div class="wday has-workout"><div class="wd-day">Fri</div><div class="wd-icon">🚴</div><div class="wd-type">Intervals</div></div>
      <div class="wday has-workout"><div class="wd-day">Sat</div><div class="wd-icon">🏃</div><div class="wd-type">Long Run</div></div>
      <div class="wday rest"><div class="wd-day">Sun</div><div class="wd-icon">—</div><div class="wd-type">Rest</div></div>
    </div>
  </div>
  <div class="filter-bar">
    <button class="fbtn active">All</button><button class="fbtn">🏃 Run</button><button class="fbtn">🚴 Bike</button><button class="fbtn">🏊 Swim</button><button class="fbtn">Last 7 days</button><button class="fbtn">Last 30 days</button>
  </div>
  <div class="hist-grp"><div class="hg-lbl">This Week</div>
    <div class="hrow"><div class="htype run">🏃</div><div class="hmain"><div class="hname">Zone 2 Run</div><div class="hmeta">SAT FEB 21 · 45 MIN · 6.2 MI · HR AVG 138</div></div><div class="hright"><div class="hload up">62</div><div class="chip cg">Positive</div></div></div>
    <div class="hrow"><div class="htype bike">🚴</div><div class="hmain"><div class="hname">Tempo Intervals</div><div class="hmeta">FRI FEB 20 · 60 MIN · 3×12MIN · 245W AVG</div></div><div class="hright"><div class="hload warn">88</div><div class="chip ca">High Load</div></div></div>
    <div class="hrow"><div class="htype swim">🏊</div><div class="hmain"><div class="hname">Easy Aerobic Swim</div><div class="hmeta">THU FEB 19 · 35 MIN · 2,400M</div></div><div class="hright"><div class="hload up">41</div><div class="chip cg">Positive</div></div></div>
    <div class="hrow"><div class="htype run">🏃</div><div class="hmain"><div class="hname">Recovery Run</div><div class="hmeta">WED FEB 18 · 30 MIN · HR AVG 122</div></div><div class="hright"><div class="hload muted">28</div><div class="chip cn">Recovery</div></div></div>
  </div>
  <div class="hist-grp"><div class="hg-lbl">Last Week</div>
    <div class="hrow"><div class="htype bike">🚴</div><div class="hmain"><div class="hname">Long Ride</div><div class="hmeta">SAT FEB 14 · 3H 20MIN · 240W NP</div></div><div class="hright"><div class="hload warn">112</div><div class="chip ca">High Load</div></div></div>
    <div class="hrow"><div class="htype run">🏃</div><div class="hmain"><div class="hname">Brick Run</div><div class="hmeta">SAT FEB 14 · 20 MIN · Post-bike</div></div><div class="hright"><div class="hload up">31</div><div class="chip cg">Productive</div></div></div>
  </div>
</div>

<!-- ══ ATHLETE: PERFORMANCE ══ -->
<div class="screen" id="screen-performance">
  <div class="ph"><div class="ph-t">Performance</div><div class="ph-s">Your physiological status, training history, and how you're adapting.</div></div>

  <!-- STATUS RINGS (front door) -->
  <div class="rings-row" id="perf-rings" style="margin-bottom:28px">
    <div class="ring-cell" onclick="document.getElementById('perf-sleep-card').scrollIntoView({behavior:'smooth'})">
      <svg width="140" height="140" viewBox="0 0 140 140">
        <circle class="ring-track" cx="70" cy="70" r="54" stroke-width="8"/>
        <circle id="perf-ring-body" class="ring-fill" cx="70" cy="70" r="54" stroke-width="8" stroke="#f59e0b"
          stroke-dasharray="339.3" stroke-dashoffset="339.3" transform="rotate(-90 70 70)"/>
        <text x="70" y="65" class="ring-center-val" text-anchor="middle" style="font-family:DM Serif Display,serif;font-size:26px;fill:#1a1a1a">62</text>
        <text x="70" y="81" text-anchor="middle" style="font-family:DM Sans,sans-serif;font-size:10px;fill:#aaa">out of 100</text>
      </svg>
      <div class="ring-label">Body</div>
      <div class="ring-sublabel">Recovering</div>
      <div class="ring-sentence">Still catching up from Wednesday's bike.</div>
    </div>
    <div class="ring-cell" onclick="document.getElementById('perf-load-card').scrollIntoView({behavior:'smooth'})">
      <div style="width:140px;height:140px;display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div style="font-family:DM Serif Display,serif;font-size:26px;color:#f59e0b">+28%</div>
        <div style="font-size:11px;color:#aaa;font-family:DM Sans,sans-serif;margin-bottom:10px">above baseline</div>
        <div style="position:relative;width:120px;height:8px;background:#eee;border-radius:4px">
          <div style="position:absolute;left:50%;top:-3px;width:1px;height:14px;background:#ccc"></div>
          <div id="perf-load-bar" style="height:100%;border-radius:4px;background:#f59e0b;width:0;margin-left:50%;transition:width .9s cubic-bezier(.4,0,.2,1)"></div>
        </div>
        <div style="display:flex;justify-content:space-between;width:120px;margin-top:4px">
          <span style="font-size:9px;color:#ccc;font-family:DM Mono,monospace">Baseline</span>
          <span style="font-size:9px;color:#ccc;font-family:DM Mono,monospace">+50%</span>
        </div>
      </div>
      <div class="ring-label">Load</div>
      <div class="ring-sublabel">+28% above baseline</div>
      <div class="ring-sentence">Right at the edge of the safe zone.</div>
    </div>
    <div class="ring-cell" onclick="document.getElementById('perf-week-strip').scrollIntoView({behavior:'smooth'})">
      <svg width="140" height="140" viewBox="0 0 140 140">
        <circle class="ring-track" cx="70" cy="70" r="54" stroke-width="8"/>
        <circle id="perf-ring-cons" class="ring-fill" cx="70" cy="70" r="54" stroke-width="8" stroke="#22c55e"
          stroke-dasharray="339.3" stroke-dashoffset="339.3" transform="rotate(-90 70 70)"/>
        <text x="70" y="63" class="ring-center-val" text-anchor="middle" style="font-family:DM Serif Display,serif;font-size:26px;fill:#1a1a1a">4/5</text>
        <text x="70" y="80" text-anchor="middle" style="font-family:DM Sans,sans-serif;font-size:10px;fill:#aaa">key workouts</text>
      </svg>
      <div class="ring-label">Consistency</div>
      <div class="ring-sublabel">4 of 5 key workouts</div>
      <div class="ring-sentence">Long run streak intact — protect Saturday.</div>
    </div>
  </div>

  <!-- BALANCE SHEET (existing) -->
  <div class="perf-hero" style="border-radius:20px;margin-bottom:14px;box-shadow:var(--sh-md)">
    <div class="perf-cell pc-fit"><div class="pc-bg"></div><div class="pc-type">Asset</div><div class="pc-name">Fitness Score</div><div class="pc-val">72</div><div class="pc-verdict">Building at safe rate. Season high.</div><div class="pc-stats"><div class="pc-stat"><span>7d change</span><span class="up">+3.2</span></div><div class="pc-stat"><span>30d change</span><span class="up">+11.4</span></div><div class="pc-stat"><span>Season peak</span><span>78</span></div></div></div>
    <div class="perf-cell pc-fat"><div class="pc-bg"></div><div class="pc-type">Liability</div><div class="pc-name">Fatigue Score</div><div class="pc-val">61</div><div class="pc-verdict">Manageable. Not accumulating faster than fitness.</div><div class="pc-stats"><div class="pc-stat"><span>7d change</span><span class="warn">+2.1</span></div><div class="pc-stat"><span>Ratio F:F</span><span class="up">0.85 ✓</span></div><div class="pc-stat"><span>Risk level</span><span class="up">Low</span></div></div></div>
    <div class="perf-cell pc-read"><div class="pc-bg"></div><div class="pc-type">Equity</div><div class="pc-name">Readiness</div><div class="pc-val">82</div><div class="pc-verdict">Ready for productive training today.</div><div class="pc-stats"><div class="pc-stat"><span>Status</span><span class="info">Productive</span></div><div class="pc-stat"><span>HRV trend</span><span class="info">↑ Stable</span></div><div class="pc-stat"><span>Confidence</span><span class="info">High</span></div></div></div>
  </div>

  <!-- WEEK STRIP -->
  <div id="perf-week-strip" class="week-strip" style="margin-bottom:16px">
    <div class="day-card" id="perf-day-mon" onclick="perfSelectDay('mon')"><div class="day-label">Mon</div><div class="day-dot done" style="background:#60a5fa;color:#fff;font-size:11px">🏊</div><div class="day-sport">Swim</div><div class="day-dur">45m easy</div></div>
    <div class="day-card" id="perf-day-tue" onclick="perfSelectDay('tue')"><div class="day-label">Tue</div><div class="day-dot done" style="background:#f87171;color:#fff;font-size:11px">🏃</div><div class="day-sport">Run</div><div class="day-dur">55m hard</div></div>
    <div class="day-card" id="perf-day-wed" onclick="perfSelectDay('wed')"><div class="day-label">Wed</div><div class="day-dot done" style="background:#a78bfa;color:#fff;font-size:11px">🚴</div><div class="day-sport">Bike</div><div class="day-dur">90m mod</div></div>
    <div class="day-card" id="perf-day-thu" onclick="perfSelectDay('thu')"><div class="day-label">Thu</div><div class="day-dot done" style="background:#f87171;color:#fff;font-size:11px">🏃</div><div class="day-sport">Run</div><div class="day-dur">30m easy</div></div>
    <div class="day-card today selected" id="perf-day-fri" onclick="perfSelectDay('fri')"><div class="day-label">Fri</div><div class="day-dot today-pulse" style="background:#3b82f6;color:#fff;font-size:11px">🏊</div><div class="day-sport">Swim</div><div class="day-dur">50m easy</div></div>
    <div class="day-card" id="perf-day-sat" onclick="perfSelectDay('sat')"><div class="day-label">Sat</div><div class="day-dot planned" style="width:28px;height:28px;font-size:11px;display:flex;align-items:center;justify-content:center">🏃</div><div class="day-sport">Long Run</div><div class="day-dur">1h45 easy</div></div>
    <div class="day-card"><div class="day-label">Sun</div><div class="day-dot rest-dot"></div><div class="day-sport">Rest</div><div class="day-dur"></div></div>
  </div>

  <!-- WORKOUT DETAIL CHART -->
  <div class="wdc" id="perf-wdc">
    <div class="wdc-header">
      <div>
        <div class="wdc-label" id="perf-wdc-label">Friday Swim · 50 min · 2,400m</div>
        <div class="wdc-title">Workout Detail</div>
      </div>
      <div>
        <div class="view-chips" id="perf-view-chips"></div>
        <div class="compare-chips">
          <button class="cchip active" onclick="perfSetCmp(this,'this')">This workout</button>
          <button class="cchip" onclick="perfSetCmp(this,'last')">vs Last Similar</button>
          <button class="cchip" onclick="perfSetCmp(this,'base')">vs Baseline</button>
          <button class="cchip" onclick="perfSetCmp(this,'best')">vs Best</button>
        </div>
      </div>
    </div>
    <div class="scrub-tooltip" id="perf-scrub-tt">Move cursor over chart to explore</div>
    <div class="wdc-panels" id="perf-wdc-panels" onmouseleave="perfClearScrub()"></div>
  </div>

  <!-- ANALYTICS GRID (existing) -->
  <div class="analytics-grid" style="margin-top:14px">
    <div class="a-card"><div class="a-title">Efficiency Trends</div>
      <div class="irow"><div class="ilbl">Cardiac drift</div><div class="ival up">↓ improving</div></div>
      <div class="irow"><div class="ilbl">Run economy</div><div class="ival up">↑ +4% vs Jan</div></div>
      <div class="irow"><div class="ilbl">Threshold pace</div><div class="ival">6:42/mi</div></div>
      <div class="irow"><div class="ilbl">FTP (bike)</div><div class="ival">272W · 3.6 W/kg</div></div>
      <div class="irow"><div class="ilbl">Swim CSS</div><div class="ival">1:38/100m</div></div>
    </div>
    <div class="a-card"><div class="a-title">HR Zone Distribution — 30d</div>
      <div class="zrow"><div class="zlbl">Zone 1</div><div class="ztrack"><div class="zfill" style="width:12%;background:var(--g)"></div></div><div class="zpct">12%</div></div>
      <div class="zrow"><div class="zlbl">Zone 2</div><div class="ztrack"><div class="zfill" style="width:52%;background:var(--g)"></div></div><div class="zpct">52%</div></div>
      <div class="zrow"><div class="zlbl">Zone 3</div><div class="ztrack"><div class="zfill" style="width:18%;background:var(--a)"></div></div><div class="zpct">18%</div></div>
      <div class="zrow"><div class="zlbl">Zone 4</div><div class="ztrack"><div class="zfill" style="width:13%;background:var(--a)"></div></div><div class="zpct">13%</div></div>
      <div class="zrow"><div class="zlbl">Zone 5</div><div class="ztrack"><div class="zfill" style="width:5%;background:var(--r)"></div></div><div class="zpct">5%</div></div>
    </div>
    <div class="a-card"><div class="a-title">Season Goal</div>
      <div class="irow"><div class="ilbl">Race</div><div class="ival">Ironman 70.3</div></div>
      <div class="irow"><div class="ilbl">Date</div><div class="ival">Apr 9, 2026</div></div>
      <div class="irow"><div class="ilbl">Target finish</div><div class="ival">4:45:00</div></div>
      <div class="irow"><div class="ilbl">Required fitness</div><div class="ival">80–85 pts</div></div>
      <div class="irow"><div class="ilbl">Trajectory</div><div class="ival up">On target ✓</div></div>
    </div>
  </div>
</div>

<!-- ══ ATHLETE: INTELLIGENCE ══ -->

<!-- ══ ATHLETE: INTELLIGENCE ══ -->
<div class="screen" id="screen-intelligence">
  <div class="ph"><div class="ph-t">Intelligence</div><div class="ph-s">What the data means for you — and what to do about it.</div></div>

  <div class="intel-hero">
    <div class="ih-eyebrow"><div class="ldot"></div>AI Analysis — Updated 6:45 AM</div>
    <div class="ih-title">You're in your best training window of the season.</div>
    <div class="ih-sub">Fitness is rising faster than fatigue for the third consecutive week. The next 10 days are your highest-leverage training window before your taper begins.</div>
  </div>

  <!-- TODAY ACTION -->
  <div class="today-action" style="margin-bottom:20px">
    <div class="ta-icon">🏊</div>
    <div class="ta-body">
      <div class="ta-title">Today: Easy Swim — 50 min</div>
      <div class="ta-sub">Keep intensity easy — your body is still recovering from this week's load. Zone 2 only, no tempo efforts.</div>
    </div>
    <div class="ta-actions">
      <button class="ta-btn" onclick="go('today')">View today's plan →</button>
      <span class="ta-swap">Swap to rest day</span>
    </div>
  </div>

  <!-- INSIGHT CARD: SLEEP DEBT -->
  <div id="perf-sleep-card" class="insight-card" style="border:1.5px solid #ef4444;background:#fff8f8;margin-bottom:10px">
    <div class="ic-header">
      <span class="ic-badge badge-red">Act Today</span>
      <span class="ic-confidence">High confidence</span>
    </div>
    <div class="ic-title">Sleep Debt Compounding</div>
    <div class="ic-sowhat">You're 2.5 hours behind on sleep this week. Hard sessions feel harder and your body is taking longer to bounce back.</div>
    <div class="ic-footer">
      <button class="ic-expand" onclick="perfToggleCard('sleep')">Show me why →</button>
      <button class="ic-action-btn">Apply to plan</button>
    </div>
    <div class="ic-expanded-body" id="perf-ic-sleep">
      <div class="ic-section-lbl">Do This Next</div>
      <div class="ic-section-txt">Aim for bed by 9:30pm tonight — that single night closes most of the gap before Saturday's long run.</div>
      <div class="ic-section-lbl">Watch This</div>
      <div class="ic-section-txt">Resting HR tomorrow morning. If it's still elevated, keep Saturday easy and conversational.</div>
      <div class="ic-mini-chart">
        <div class="ic-mini-title">Sleep Bank — Last 7 Days</div>
        <div id="intel-sleep-chart"></div>
        <div class="ic-mini-note" style="color:#ef4444">−2.5h deficit this week</div>
      </div>
    </div>
  </div>

  <!-- INSIGHT CARD: LOAD SPIKE -->
  <div id="perf-load-card" class="insight-card" style="border:1.5px solid #f59e0b;background:#fffbf0;margin-bottom:10px">
    <div class="ic-header">
      <span class="ic-badge badge-amber">Watch This Week</span>
      <span class="ic-confidence">Medium confidence</span>
    </div>
    <div class="ic-title">Load Spike Risk</div>
    <div class="ic-sowhat">This week jumped 28% above your 4-week average. That's right at the edge of where small injuries tend to appear.</div>
    <div class="ic-footer">
      <button class="ic-expand" onclick="perfToggleCard('load')">Show me why →</button>
    </div>
    <div class="ic-expanded-body" id="perf-ic-load">
      <div class="ic-section-lbl">Do This Next</div>
      <div class="ic-section-txt">Keep today's swim as planned — easy effort only. Don't add Saturday yardage even if you feel strong.</div>
      <div class="ic-section-lbl">Watch This</div>
      <div class="ic-section-txt">Any tightness in calves or Achilles on Saturday's warm-up. Stop the session early if it's there.</div>
      <div class="ic-mini-chart">
        <div class="ic-mini-title">Weekly Load vs 4-Week Average</div>
        <div id="intel-load-chart"></div>
        <div class="ic-mini-note" style="color:#f59e0b">+28% above baseline — edge of safe zone</div>
      </div>
    </div>
  </div>

  <!-- INSIGHT CARD: AEROBIC BASE -->
  <div class="insight-card" style="border:1.5px solid #e5e5e5;background:#fafafa;margin-bottom:10px">
    <div class="ic-header">
      <span class="ic-badge badge-ghost">On Track</span>
      <span class="ic-confidence">High confidence</span>
    </div>
    <div class="ic-title">Aerobic Base Building</div>
    <div class="ic-sowhat">Your easy pace at zone 2 heart rate has improved 8 seconds per mile over 6 weeks. The base is working.</div>
    <div class="ic-footer">
      <button class="ic-expand" onclick="perfToggleCard('aerobic')">Show me why →</button>
    </div>
    <div class="ic-expanded-body" id="perf-ic-aerobic">
      <div class="ic-section-lbl">Do This Next</div>
      <div class="ic-section-txt">Nothing to change — this is confirmation to keep the easy volume consistent through next week.</div>
      <div class="ic-section-lbl">Watch This</div>
      <div class="ic-section-txt">Pace at the same heart rate on Saturday's long run vs. last Saturday. Expect another small improvement.</div>
      <div class="ic-mini-chart">
        <div class="ic-mini-title">Same Effort, Faster Pace — 6-Week Trend</div>
        <div id="intel-aerobic-chart"></div>
        <div class="ic-mini-note" style="color:#34d399">↓ 18s/mi improvement at same heart rate — the base is working</div>
      </div>
    </div>
  </div>

  <!-- EXISTING INTEL CARDS -->
  <div class="intel-cards" style="margin-top:6px">
    <div class="intel-card"><div class="ic-eye up">↑ Fitness Insight</div><div class="ic-title">Extend your long run by 8 minutes</div><div class="ic-body">Your aerobic efficiency has improved 4% since January. Your body is ready for more volume at low intensity. Adding 8 minutes to Saturday's long run will accelerate your CTL without meaningfully increasing injury risk.</div><div class="ic-meta">Confidence: High · Based on 42 days of data</div></div>
    <div class="intel-card"><div class="ic-eye warn">⚡ Load Warning</div><div class="ic-title">Don't add a 7th workout this week</div><div class="ic-body">Your current 6-session week is producing excellent adaptation. Adding a 7th session at this point in your build phase would push your fatigue-to-fitness ratio above optimal. Rest day is doing real work.</div><div class="ic-meta">Confidence: High · Load modeling</div></div>
    <div class="intel-card"><div class="ic-eye info">◈ Race Readiness</div><div class="ic-title">You're 6 fitness points from your race target</div><div class="ic-body">Target fitness for your Ironman 70.3 is 80–85 points. You're at 72 with 47 days remaining. At your current build rate of +3.2/week, you'll peak at approximately 84 — right in the target window.</div><div class="ic-meta">Projection: 84 pts at race day</div></div>
    <div class="intel-card"><div class="ic-eye up">💤 Recovery Signal</div><div class="ic-title">Your recovery pattern is optimal</div><div class="ic-body">HRV has been stable or rising for 9 consecutive mornings. This is your body signaling that the current training-recovery balance is working. Maintain the pattern through the end of this build block.</div><div class="ic-meta">HRV trend: ↑ +8% vs last week</div></div>
  </div>
</div>


<!-- ══ ATHLETE: DISCOVER (Open only) ══ -->
<div class="screen" id="screen-discover">
  <div class="ph"><div class="ph-t">Discover</div><div class="ph-s">Find your coach. Browse Cady Core verified programs.</div></div>
  <div class="cady-hero">
    <div>
      <div class="ch-badge"><div class="cady-badge"><span class="cady-badge-icon">✦</span> Cady Core</div></div>
      <div class="ch-title">Coaches you can trust.</div>
      <div class="ch-sub">Cady Core is Coreformance's verification program. Every coach here has been vetted, credentialed, and approved. Not a marketplace — a curated directory of the best endurance coaches on the platform.</div>
    </div>
    <div class="ch-stats">
      <div class="ch-stat"><div class="ch-stat-val">47</div><div class="ch-stat-lbl">Verified coaches</div></div>
      <div class="ch-stat"><div class="ch-stat-val">12</div><div class="ch-stat-lbl">Sports covered</div></div>
      <div class="ch-stat"><div class="ch-stat-val">2,400+</div><div class="ch-stat-lbl">Active athletes</div></div>
    </div>
  </div>
  <div class="discover-filters">
    <span class="df-lbl">Filter by:</span>
    <button class="fbtn active">All Sports</button>
    <button class="fbtn">🏊 Triathlon</button>
    <button class="fbtn">🏃 Running</button>
    <button class="fbtn">🚴 Cycling</button>
    <button class="fbtn active" style="margin-left:8px">Cady Core Only</button>
  </div>
  <div class="coach-grid">
    <div class="coach-card" onclick="go('coach-profile')">
      <div class="coach-card-top">
        <div class="coach-avi-lg" style="background:var(--g1);color:var(--g);border-color:var(--g2)">JT</div>
        <div class="cady-verified"><span>✦</span> Cady Core</div>
      </div>
      <div class="coach-name">Jordan Taylor</div>
      <div class="coach-spec">Triathlon · Ironman Specialist · 12 years</div>
      <div class="coach-bio">"I coach working professionals who want to finish strong — not just finish. My athletes average 23% performance improvement in their first season."</div>
      <div class="coach-stats"><div class="cst"><div class="cst-val up">34</div><div class="cst-lbl">Athletes</div></div><div class="cst"><div class="cst-val">94%</div><div class="cst-lbl">Completion rate</div></div><div class="cst"><div class="cst-val up">4.9★</div><div class="cst-lbl">Rating</div></div></div>
      <div><span class="prog-pill">20-wk IM 70.3</span><span class="prog-pill">16-wk Olympic</span><span class="prog-pill">Base Building</span></div>
    </div>
    <div class="coach-card">
      <div class="coach-card-top">
        <div class="coach-avi-lg" style="background:var(--b1);color:var(--b);border-color:var(--b2)">SR</div>
        <div class="cady-verified"><span>✦</span> Cady Core</div>
      </div>
      <div class="coach-name">Sam Rivera</div>
      <div class="coach-spec">Marathon · Boston Qualifier · 8 years</div>
      <div class="coach-bio">"Former D1 coach now working with age-groupers. I specialize in athletes who've plateaued and need to break through to the next level."</div>
      <div class="coach-stats"><div class="cst"><div class="cst-val up">28</div><div class="cst-lbl">Athletes</div></div><div class="cst"><div class="cst-val">91%</div><div class="cst-lbl">Completion rate</div></div><div class="cst"><div class="cst-val up">4.8★</div><div class="cst-lbl">Rating</div></div></div>
      <div><span class="prog-pill">18-wk Marathon</span><span class="prog-pill">BQ Training</span><span class="prog-pill">Speed Block</span></div>
    </div>
    <div class="coach-card">
      <div class="coach-card-top">
        <div class="coach-avi-lg" style="background:var(--a1);color:var(--a);border-color:var(--a2)">DK</div>
        <div class="cady-verified"><span>✦</span> Cady Core</div>
      </div>
      <div class="coach-name">Dana Kim</div>
      <div class="coach-spec">Cycling · Gravel · FTP Development</div>
      <div class="coach-bio">"Power-based coaching for cyclists who want real numbers to train against. I turn data into decisions so you don't have to."</div>
      <div class="coach-stats"><div class="cst"><div class="cst-val up">19</div><div class="cst-lbl">Athletes</div></div><div class="cst"><div class="cst-val">96%</div><div class="cst-lbl">Completion rate</div></div><div class="cst"><div class="cst-val up">5.0★</div><div class="cst-lbl">Rating</div></div></div>
      <div><span class="prog-pill">12-wk FTP Build</span><span class="prog-pill">Gravel Prep</span></div>
    </div>
  </div>
</div>

<!-- ══ COACH PROFILE (Cady Core) ══ -->
<div class="screen" id="screen-coach-profile">
  <div class="ph"><div class="ph-row"><div><button class="btn btn-ghost" style="font-size:12px;margin-bottom:12px" onclick="go('discover')">← Back to Discover</button><div class="ph-t">Jordan Taylor</div><div class="ph-s">Cady Core Verified Coach</div></div><button class="btn btn-g" style="font-size:13px;align-self:flex-start;margin-top:40px">Enroll with Jordan</button></div></div>
  <div class="verified-profile">
    <div class="vp-banner"><div style="position:absolute;top:14px;right:24px"><div class="cady-badge"><span class="cady-badge-icon">✦</span> Cady Core Verified</div></div></div>
    <div class="vp-avi">JT</div>
    <div class="vp-body">
      <div class="vp-name">Jordan Taylor</div>
      <div class="vp-creds"><div class="cady-verified"><span>✦</span> Cady Core</div><span class="chip cn">Triathlon</span><span class="chip cn">Ironman</span><span class="chip cn">12 years coaching</span></div>
      <div class="vp-bio">I coach working professionals who want to compete seriously without burning out. My methodology is rooted in aerobic base development, progressive overload, and intelligent recovery. My athletes finish races — and come back next year stronger.</div>
      <div class="g3" style="margin-bottom:18px">
        <div class="kpi"><div class="kpi-l">Athletes Coached</div><div class="kpi-v">34</div><div class="kpi-d muted">active this season</div></div>
        <div class="kpi"><div class="kpi-l">Avg Improvement</div><div class="kpi-v up">+23%</div><div class="kpi-d up">first season</div></div>
        <div class="kpi"><div class="kpi-l">Completion Rate</div><div class="kpi-v up">94%</div><div class="kpi-d muted">of prescribed sessions</div></div>
      </div>
      <div class="sdiv">Programs</div>
      <div class="prog-grid">
        <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--b1)">🏊</div><div class="chip cg" style="font-size:10px">Open Enrollment</div></div><div class="prog-name">20-Week Ironman 70.3</div><div class="prog-meta">20 WEEKS · 6 SESSIONS/WK · INTERMEDIATE</div><div class="prog-desc">Full periodized build from base to peak. Designed for athletes targeting 4:30–5:30 finish times with 8–12 hrs/week available.</div><div class="prog-stats"><div><div class="pst-val">47</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val up">4.9★</div><div class="pst-lbl">Rating</div></div></div></div>
        <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--g1)">🏃</div><div class="chip cg" style="font-size:10px">Open Enrollment</div></div><div class="prog-name">16-Week Olympic Tri</div><div class="prog-meta">16 WEEKS · 5 SESSIONS/WK · ALL LEVELS</div><div class="prog-desc">Sprint to Olympic distance. Emphasis on pacing strategy and race-day execution. Good for first-timers and improvement-seekers.</div><div class="prog-stats"><div><div class="pst-val">31</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val up">4.8★</div><div class="pst-lbl">Rating</div></div></div></div>
        <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--a1)">⚡</div><div class="chip cn" style="font-size:10px">Waitlist</div></div><div class="prog-name">Aerobic Base Build</div><div class="prog-meta">12 WEEKS · 4 SESSIONS/WK · BEGINNER</div><div class="prog-desc">For athletes returning from injury or building from scratch. Low intensity, high consistency. The foundation everything else is built on.</div><div class="prog-stats"><div><div class="pst-val">22</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val up">5.0★</div><div class="pst-lbl">Rating</div></div></div></div>
      </div>
    </div>
  </div>
</div>


<!-- INVITE ATHLETE SCREEN -->
<div class="screen" id="screen-invite">
  <div class="ph"><div class="ph-row"><div><button class="btn btn-ghost" style="font-size:12px;padding:6px 13px;margin-bottom:12px" onclick="go('roster')">← Back to Roster</button><div class="ph-t">Add Athlete</div><div class="ph-s">Invite to your roster or generate an activation key for external distribution.</div></div></div></div>
  <div class="g2">
    <div class="card card-p">
      <div style="font-size:15px;font-weight:700;margin-bottom:4px">Invite to Roster</div>
      <div style="font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:16px">Generate a team invite link or code. When the athlete joins, they're automatically rostered to you. You set their autonomy level from the start.</div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px">
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:5px">Athlete Email</div><input style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none" placeholder="athlete@email.com"></div>
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:5px">Default Autonomy</div><select style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none;cursor:pointer"><option>Full Control — Today and Performance only, no Discover</option><option selected>Partial Autonomy — assigned program + can self-log, coach sees all</option><option>Open — rostered but self-coached, coach has visibility only</option></select></div>
      </div>
      <button class="btn btn-b" style="width:100%;justify-content:center">Send Invite Link</button>
    </div>
    <div class="card card-p">
      <div style="font-size:15px;font-weight:700;margin-bottom:4px">Generate Activation Key</div>
      <div style="font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:16px">Create a key for a specific program. Share externally — your website, social, wherever. When the athlete enters it in Coreformance, they link to you automatically.</div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px">
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:5px">Program</div><select style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none;cursor:pointer"><option>20-Week Ironman 70.3 (20-week term)</option><option>16-Week Olympic Tri (16-week term)</option><option>12-Week Base Build (12-week term)</option></select></div>
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:5px">Term Length</div><select style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:9px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none;cursor:pointer"><option>Matches program length (recommended)</option><option>Custom term</option></select></div>
        <div style="background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:10px 13px;font-size:12px;color:var(--t2);line-height:1.65">When the term ends, the athlete automatically reverts to self-coached unless you issue a renewal key. This prevents orphaned relationships.</div>
      </div>
      <button class="btn btn-g" style="width:100%;justify-content:center">Generate Activation Key →</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════════════════════
     COACH: ROSTER
══════════════════════════════════════════ -->

<!-- ══ COACH: HOME (Daily Brief) ══ -->
<div class="screen" id="screen-home">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Good morning, Jordan.</div><div class="ph-s">Monday, February 23 · Here's your roster at a glance.</div></div><div style="display:flex;gap:8px"><button class="btn btn-b" style="font-size:12px" onclick="go('invite')">+ Invite Athlete</button></div></div></div>
  <div class="home-grid">
    <div>
      <div class="daily-summary">
        <div class="ds-eyebrow"><div class="ldot-b"></div>Today — Feb 23 · 9 athletes training</div>
        <div style="font-size:16px;font-weight:800;letter-spacing:-.02em;margin-bottom:4px">Session completion yesterday: <span class="up">7/9 (78%)</span></div>
        <div style="font-size:13px;color:var(--t2);margin-bottom:14px">Sarah Chen's HRV alarm active — rest day mandatory. Derek Osei missed 3/5 sessions this week.</div>
        <div id="home-athlete-rows">
          <div class="athlete-spark-row" onclick="go('roster')"><div class="asr-avi" style="background:var(--r1);color:var(--r)">SC</div><div class="asr-name">Sarah Chen</div><div class="asr-sparks"><div class="asp" style="height:62%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:74%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:68%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:58%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:44%;background:var(--a1);border-top:1px solid var(--a2)"></div><div class="asp" style="height:32%;background:var(--r2);border-top:1px solid var(--r)"></div><div class="asp" style="height:24%;background:var(--r2);border-top:1.5px solid var(--r)"></div></div><div class="asr-score risk">38</div><div class="asr-status"><span class="chip cr" style="font-size:9px">AT RISK</span></div></div>
          <div class="athlete-spark-row" onclick="go('roster')"><div class="asr-avi" style="background:var(--g1);color:var(--g)">MR</div><div class="asr-name">Marcus Reid</div><div class="asr-sparks"><div class="asp" style="height:62%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:68%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:73%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:76%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:78%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:80%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:82%;background:var(--g3);border-top:1.5px solid var(--g)"></div></div><div class="asr-score up">82</div><div class="asr-status"><span class="chip cg" style="font-size:9px">Productive</span></div></div>
          <div class="athlete-spark-row" onclick="go('roster')"><div class="asr-avi" style="background:var(--a1);color:var(--a)">DO</div><div class="asr-name">Derek Osei</div><div class="asr-sparks"><div class="asp" style="height:64%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:62%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:58%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:55%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:52%;background:var(--a1);border-top:1px solid var(--a2)"></div><div class="asp" style="height:53%;background:var(--a2);border-top:1px solid var(--a)"></div><div class="asp" style="height:54%;background:var(--a2);border-top:1.5px solid var(--a)"></div></div><div class="asr-score warn">54</div><div class="asr-status"><span class="chip ca" style="font-size:9px">Low Consist.</span></div></div>
          <div class="athlete-spark-row" onclick="go('roster')"><div class="asr-avi" style="background:var(--b1);color:var(--b)">AL</div><div class="asr-name">Aisha Lawson</div><div class="asr-sparks"><div class="asp" style="height:70%;background:var(--g1);border-top:1px solid var(--g2)"></div><div class="asp" style="height:72%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:74%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:76%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:77%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:78%;background:var(--g2);border-top:1px solid var(--g)"></div><div class="asp" style="height:79%;background:var(--g2);border-top:1.5px solid var(--g)"></div></div><div class="asr-score up">79</div><div class="asr-status"><span class="chip cg" style="font-size:9px">On Track</span></div></div>
        </div>
        <div style="margin-top:10px;font-size:11px;font-family:'DM Mono',monospace;color:var(--b);cursor:pointer" onclick="go('roster')">View full roster (12 athletes) →</div>
      </div>
    </div>
    <div>
      <div class="brief-alerts" style="margin-bottom:12px">
        <div class="ba-head"><div class="ba-head-title">Alerts</div><div class="ba-count">3 active</div></div>
        <div class="ba-item danger" onclick="go('roster')"><div class="ba-icon">⚠️</div><div class="ba-main"><div class="ba-who">Sarah Chen</div><div class="ba-txt">HRV −22% · overreach threshold breached</div><div class="ba-time">2h ago · Auto-detected</div></div><button class="ba-cta">View</button></div>
        <div class="ba-item warn" onclick="go('roster')"><div class="ba-icon">⏰</div><div class="ba-main"><div class="ba-who">Derek Osei</div><div class="ba-txt">3 of 5 sessions missed this week</div><div class="ba-time">Yesterday · Session missed</div></div><button class="ba-cta">View</button></div>
        <div class="ba-item info" onclick="go('roster')"><div class="ba-icon">🎯</div><div class="ba-main"><div class="ba-who">Marcus Reid</div><div class="ba-txt">Fitness crossed 70 — season milestone</div><div class="ba-time">Today 6:45 AM</div></div><button class="ba-cta">View</button></div>
      </div>
      <div class="quick-actions" style="margin-bottom:12px">
        <div class="qa-title">Quick Actions</div>
        <button class="qa-btn" onclick="go('library');setTimeout(openBuilder,200)"><span>➕</span>New Workout</button>
        <button class="qa-btn" onclick="go('invite')"><span>👤</span>Invite Athlete</button>
        <button class="qa-btn" onclick="go('schedule')"><span>📅</span>Assign Workout</button>
        <button class="qa-btn" onclick="go('library')"><span>📚</span>Open Plan Library</button>
      </div>
      <div class="roster-snapshot">
        <div class="qa-title">Roster Snapshot</div>
        <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--bd);font-size:13px"><span style="color:var(--t2)">Avg Readiness</span><span class="mono up" style="font-weight:600">74</span></div>
        <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--bd);font-size:13px"><span style="color:var(--t2)">Sessions today</span><span class="mono" style="font-weight:600">9</span></div>
        <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--bd);font-size:13px"><span style="color:var(--t2)">Completion (yesterday)</span><span class="mono up" style="font-weight:600">78%</span></div>
        <div style="display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--bd);font-size:13px"><span style="color:var(--t2)">Athletes at risk</span><span class="mono risk" style="font-weight:600">1</span></div>
        <div style="display:flex;justify-content:space-between;padding:7px 0;font-size:13px"><span style="color:var(--t2)">Avg fitness Δ (7d)</span><span class="mono up" style="font-weight:600">+2.8</span></div>
      </div>
    </div>
  </div>
</div>

<!-- ══ COACH: LIBRARY (Program Builder) ══ -->
<div class="screen" id="screen-library" style="padding:0">
  <div class="library-layout">
    <div class="lib-sidebar">
      <div class="lib-header">
        <div class="lib-title"><span>Workout Library</span><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--t4);font-weight:400">24 workouts</span></div>
        <input class="lib-search" placeholder="🔍  Search workouts…">
        <div class="lib-filters">
          <button class="lib-filter active" onclick="filterLib(this,'all')">All</button>
          <button class="lib-filter" onclick="filterLib(this,'run')">🏃 Run</button>
          <button class="lib-filter" onclick="filterLib(this,'bike')">🚴 Bike</button>
          <button class="lib-filter" onclick="filterLib(this,'swim')">🏊 Swim</button>
        </div>
      </div>
      <div class="lib-body" id="lib-body">
        <div class="lib-section-lbl">Running</div>
        <div class="wo-card" draggable="true" data-type="run" data-id="r1" data-name="Zone 2 Aerobic Run" data-dur="55 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot run-dot"></div><div class="wo-name">Zone 2 Aerobic Run</div><div class="wo-duration">55 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:18px;height:35%"></div><div class="wi wi-work" style="width:88px;height:68%"></div><div class="wi wi-cool" style="width:14px;height:28%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-z2">z2</span><span class="wo-tag tag-long">aerobic</span></div>
        </div>
        <div class="wo-card" draggable="true" data-type="run" data-id="r2" data-name="5K Race Pace Intervals" data-dur="50 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot run-dot"></div><div class="wo-name">5K Race Pace Intervals</div><div class="wo-duration">50 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:12px;height:40%"></div><div class="wi wi-high" style="width:9px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:28%"></div><div class="wi wi-high" style="width:9px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:28%"></div><div class="wi wi-high" style="width:9px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:28%"></div><div class="wi wi-high" style="width:9px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:28%"></div><div class="wi wi-high" style="width:9px;height:100%"></div><div class="wi wi-cool" style="width:12px;height:32%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-vo2">vo2</span><span class="wo-tag tag-race">race-pace</span></div>
        </div>
        <div class="wo-card" draggable="true" data-type="run" data-id="r3" data-name="Long Run" data-dur="90 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot run-dot"></div><div class="wo-name">Long Run</div><div class="wo-duration">90 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:12px;height:35%"></div><div class="wi wi-work" style="width:115px;height:60%"></div><div class="wi wi-cool" style="width:10px;height:28%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-z2">z2</span><span class="wo-tag tag-long">long</span></div>
        </div>
        <div class="wo-card" draggable="true" data-type="run" data-id="r4" data-name="Tempo 3×15min" data-dur="65 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot run-dot"></div><div class="wo-name">Tempo 3×15min</div><div class="wo-duration">65 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:16px;height:40%"></div><div class="wi wi-work" style="width:26px;height:82%"></div><div class="wi wi-rest" style="width:7px;height:28%"></div><div class="wi wi-work" style="width:26px;height:82%"></div><div class="wi wi-rest" style="width:7px;height:28%"></div><div class="wi wi-work" style="width:26px;height:82%"></div><div class="wi wi-cool" style="width:14px;height:34%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-threshold">threshold</span></div>
        </div>
        <div class="lib-section-lbl">Cycling</div>
        <div class="wo-card" draggable="true" data-type="bike" data-id="b1" data-name="3×12 Threshold Bike" data-dur="70 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot bike-dot"></div><div class="wo-name">3×12 Threshold Bike</div><div class="wo-duration">70 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:14px;height:38%"></div><div class="wi wi-work" style="width:24px;height:88%"></div><div class="wi wi-rest" style="width:7px;height:32%"></div><div class="wi wi-work" style="width:24px;height:88%"></div><div class="wi wi-rest" style="width:7px;height:32%"></div><div class="wi wi-work" style="width:24px;height:88%"></div><div class="wi wi-cool" style="width:14px;height:32%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-threshold">threshold</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--t3)">95% FTP</span></div>
        </div>
        <div class="wo-card" draggable="true" data-type="bike" data-id="b2" data-name="VO2 Max 6×3min Bike" data-dur="55 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot bike-dot"></div><div class="wo-name">VO2 Max 6×3min</div><div class="wo-duration">55 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:12px;height:38%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:30%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:30%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:30%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:30%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-rest" style="width:5px;height:30%"></div><div class="wi wi-high" style="width:8px;height:100%"></div><div class="wi wi-cool" style="width:12px;height:32%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-vo2">vo2</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--t3)">120% FTP</span></div>
        </div>
        <div class="wo-card" draggable="true" data-type="bike" data-id="b3" data-name="Zone 2 Endurance Ride" data-dur="120 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot bike-dot"></div><div class="wo-name">Z2 Endurance Ride</div><div class="wo-duration">120 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:14px;height:35%"></div><div class="wi wi-work" style="width:140px;height:65%"></div><div class="wi wi-cool" style="width:12px;height:28%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-z2">z2</span><span class="wo-tag tag-long">endurance</span></div>
        </div>
        <div class="lib-section-lbl">Swimming</div>
        <div class="wo-card" draggable="true" data-type="swim" data-id="s1" data-name="Aerobic Swim 2400m" data-dur="40 min" ondragstart="libDragStart(event)" ondragend="libDragEnd(event)">
          <div class="wo-card-top"><div class="wo-type-dot swim-dot"></div><div class="wo-name">Aerobic Swim 2400m</div><div class="wo-duration">40 min</div><div class="wo-card-actions"><div class="wca-btn" onclick="openBuilder()">✎</div></div></div>
          <div class="wo-intervals"><div class="wi wi-warmup" style="width:14px;height:35%"></div><div class="wi wi-work" style="width:72px;height:62%"></div><div class="wi wi-rest" style="width:6px;height:30%"></div><div class="wi wi-work" style="width:36px;height:68%"></div><div class="wi wi-cool" style="width:12px;height:28%"></div></div>
          <div class="wo-tags"><span class="wo-tag tag-z2">aerobic</span></div>
        </div>
        <button class="lib-add-btn" onclick="openBuilder()">+ Add New Workout</button>
      </div>
    </div>
    <div class="plan-canvas-area">
      <div class="canvas-header">
        <div style="flex:1">
          <input class="plan-name-input" value="20-Week Ironman 70.3 — Full Build" id="plan-name-input">
          <div class="plan-meta-row">20 WEEKS · 6 SESSIONS/WK · INTERMEDIATE · <span class="up">47 enrolled</span></div>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn btn-ghost" style="font-size:12px;padding:6px 13px">Preview</button>
          <button class="btn btn-b" style="font-size:12px;padding:6px 13px">Assign to Athlete</button>
        </div>
      </div>
      <div class="canvas-toolbar">
        <button class="tb-btn tb-primary" onclick="openBuilder()">+ New Workout</button>
        <button class="tb-btn" onclick="addWeek()">+ Add Week</button>
        <button class="tb-btn">⚡ Auto-Progress</button>
        <button class="tb-btn">📌 Anchor Race</button>
        <button class="tb-btn">🏷 Set Phase</button>
        <div class="phase-legend">
          <div class="ph-leg"><div class="ph-leg-dot" style="background:var(--g)"></div>Base</div>
          <div class="ph-leg"><div class="ph-leg-dot" style="background:var(--b)"></div>Build</div>
          <div class="ph-leg"><div class="ph-leg-dot" style="background:var(--a)"></div>Peak</div>
          <div class="ph-leg"><div class="ph-leg-dot" style="background:#7c3aed"></div>Taper</div>
        </div>
      </div>
      <div class="weeks-container" id="weeks-container"></div>
    </div>
  </div>
</div>

<div class="screen" id="screen-roster">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Athlete Roster</div><div class="ph-s">12 athletes · Physiological ledger. Click any row to drill in.</div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:12px">Export</button><button class="btn btn-b" style="font-size:12px" onclick="go('invite')">+ Invite Athlete</button></div></div></div>
  <div class="coach-strip">
    <div class="cs-c"><div class="cs-l">Athletes</div><div class="cs-v">12</div><div class="cs-s muted">active this week</div></div>
    <div class="cs-c"><div class="cs-l">Avg Readiness</div><div class="cs-v up">74</div><div class="cs-s up">↑ +4 vs last week</div></div>
    <div class="cs-c" style="border-top:2px solid var(--r)"><div class="cs-l">At Risk</div><div class="cs-v risk">1</div><div class="cs-s risk">HRV alarm active</div></div>
    <div class="cs-c" style="border-top:2px solid var(--a)"><div class="cs-l">Flagged</div><div class="cs-v warn">2</div><div class="cs-s warn">Need check-in</div></div>
    <div class="cs-c"><div class="cs-l">Completion</div><div class="cs-v">91%</div><div class="cs-s muted">sessions this week</div></div>
  </div>
  <div class="ledger">
    <div class="ledger-tb">
      <input class="ldg-search" type="text" placeholder="🔍  Search athletes…">
      <button class="spill active">All</button>
      <button class="spill" onclick="spill(this)">At Risk</button>
      <button class="spill" onclick="spill(this)">Flagged</button>
      <button class="spill" onclick="spill(this)">By Readiness</button>
      <button class="spill" onclick="spill(this)">By Fitness</button>
      <div class="ldg-ct">12 athletes</div>
    </div>
    <div class="ldg-head">
      <div class="lhc">Athlete</div><div class="lhc sorted">Readiness ↕</div><div class="lhc">Fitness</div><div class="lhc">Fatigue</div><div class="lhc">Form</div><div class="lhc">Consist.</div><div class="lhc">Autonomy</div><div class="lhc">Status</div>
    </div>
    <!-- Sarah Chen — AT RISK -->
    <div class="arow-w">
      <div class="arow at-risk" onclick="drill('sc')">
        <div class="arc"><div class="ath-id"><div class="avi-s" style="background:var(--r1);color:var(--r);border-color:var(--r2)">SC</div><div><div class="an">Sarah Chen</div><div class="ae">Boston · 61d</div><div><span class="a-state-tag" style="background:var(--b1);color:var(--b)">INVITED</span></div></div></div></div>
        <div class="arc"><div class="sc-cell"><div class="sc-num risk">38</div><div class="sc-bar"><div class="sc-fill" style="width:38%;background:var(--r)"></div></div></div></div>
        <div class="arc"><div class="sc-num">65</div></div><div class="arc"><div class="sc-num risk">87</div></div><div class="arc"><div class="sc-num risk">−22</div></div>
        <div class="arc"><div class="sc-num">79%</div></div>
        <div class="arc" onclick="event.stopPropagation()"><div class="auto-toggle"><button class="at-btn act-f" onclick="setAuto(this,'f')">Full</button><button class="at-btn" onclick="setAuto(this,'p')">Part</button><button class="at-btn" onclick="setAuto(this,'o')">Open</button></div></div>
        <div class="arc"><span class="chip cr">AT RISK</span></div>
      </div>
      <div class="drill-panel" id="drill-sc">
        <div class="drill-top"><div class="dident"><div class="avi-s" style="width:40px;height:40px;background:var(--r1);color:var(--r);border:2px solid var(--r2);font-size:13px">SC</div><div><div class="dname">Sarah Chen</div><div class="dmeta">INVITED · FULL CONTROL · BOSTON 61 DAYS · ⚠ OVERREACH</div></div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:11px" onclick="closeDrill('sc')">✕</button><button class="btn btn-b" style="font-size:11px">✉ Message</button></div></div>
        <div class="drill-bs"><div class="dbs r"><div class="dbs-type">Readiness (Equity)</div><div class="dbs-val risk">38</div><div class="dbs-desc">Critical. Rest only. HRV dropped 22% overnight.</div></div><div class="dbs a"><div class="dbs-type">Fitness (Asset)</div><div class="dbs-val">65</div><div class="dbs-desc">Good baseline. Masked by current fatigue.</div></div><div class="dbs r"><div class="dbs-type">Fatigue (Liability)</div><div class="dbs-val risk">87</div><div class="dbs-desc">Dangerously high. Exceeds fitness by 22 pts.</div></div></div>
        <div class="dtabs"><button class="dtab active" onclick="drillTab(this,'wk-sc')">Workouts</button><button class="dtab" onclick="drillTab(this,'note-sc')">Notes</button></div>
        <div class="dsec active" id="wk-sc"><div class="dwo"><div class="dwo-t run">🏃</div><div class="dwo-m"><div class="dwo-n">Tempo Run</div><div class="dwo-mt">WED FEB 19 · 50 MIN</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="warn">91</div></div><div class="dwo"><div class="dwo-t bike">🚴</div><div class="dwo-m"><div class="dwo-n">Hard Intervals</div><div class="dwo-mt">TUE FEB 18 · 75 MIN</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="risk">118</div></div><div class="dwo"><div class="dwo-t run">🏃</div><div class="dwo-m"><div class="dwo-n">Long Run — 18mi</div><div class="dwo-mt">SUN FEB 16 · Marathon pace</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="risk">142</div></div></div>
        <div class="dsec" id="note-sc"><div class="note-box"><div class="note-l">Coach Notes</div><textarea class="note-ta" rows="3">⚠ Rest day mandatory. Call Sarah — HRV dropped 22%. Reduce next week by 20-25%. Watch closely before resuming intensity.</textarea><div class="note-f"><button class="btn btn-g" style="font-size:11px">Save</button></div></div></div>
      </div>
    </div>
    <!-- Marcus Reid -->
    <div class="arow-w">
      <div class="arow" onclick="drill('mr')">
        <div class="arc"><div class="ath-id"><div class="avi-s" style="background:var(--g1);color:var(--g);border-color:var(--g2)">MR</div><div><div class="an">Marcus Reid</div><div class="ae">IM 70.3 · 47d</div><div><span class="a-state-tag" style="background:var(--g1);color:var(--g)">ACTIVATED</span></div></div></div></div>
        <div class="arc"><div class="sc-cell"><div class="sc-num up">82</div><div class="sc-bar"><div class="sc-fill" style="width:82%;background:var(--g)"></div></div></div></div>
        <div class="arc"><div class="sc-num up">72</div></div><div class="arc"><div class="sc-num warn">61</div></div><div class="arc"><div class="sc-num up">+11</div></div>
        <div class="arc"><div class="sc-num">87%</div></div>
        <div class="arc" onclick="event.stopPropagation()"><div class="auto-toggle"><button class="at-btn" onclick="setAuto(this,'f')">Full</button><button class="at-btn act-p" onclick="setAuto(this,'p')">Part</button><button class="at-btn" onclick="setAuto(this,'o')">Open</button></div></div>
        <div class="arc"><span class="chip cg">Productive</span></div>
      </div>
      <div class="drill-panel" id="drill-mr">
        <div class="drill-top"><div class="dident"><div class="avi-s" style="width:40px;height:40px;background:var(--g1);color:var(--g);border:2px solid var(--g2);font-size:13px">MR</div><div><div class="dname">Marcus Reid</div><div class="dmeta">ACTIVATED · PARTIAL AUTONOMY · IM 70.3 · 47 DAYS · WEEK 8 OF 20</div></div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:11px" onclick="closeDrill('mr')">✕</button><button class="btn btn-b" style="font-size:11px">✉ Message</button></div></div>
        <div class="drill-bs"><div class="dbs g"><div class="dbs-type">Readiness (Equity)</div><div class="dbs-val up">82</div><div class="dbs-desc">Productive — ready for quality training today.</div></div><div class="dbs g"><div class="dbs-type">Fitness (Asset)</div><div class="dbs-val up">72</div><div class="dbs-desc">Season high. Building at +3.2/wk — optimal.</div></div><div class="dbs a"><div class="dbs-type">Fatigue (Liability)</div><div class="dbs-val warn">61</div><div class="dbs-desc">Manageable. Ratio 0.85 — healthy range.</div></div></div>
        <div class="dtabs"><button class="dtab active" onclick="drillTab(this,'wk-mr')">Workouts</button><button class="dtab" onclick="drillTab(this,'note-mr')">Notes</button></div>
        <div class="dsec active" id="wk-mr"><div class="dwo"><div class="dwo-t run">🏃</div><div class="dwo-m"><div class="dwo-n">Zone 2 Run</div><div class="dwo-mt">SAT FEB 21 · 45 MIN</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="up">62</div></div><div class="dwo"><div class="dwo-t bike">🚴</div><div class="dwo-m"><div class="dwo-n">Tempo Intervals</div><div class="dwo-mt">FRI FEB 20 · 60 MIN · 245W</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="warn">88</div></div><div class="dwo"><div class="dwo-t swim">🏊</div><div class="dwo-m"><div class="dwo-n">Easy Swim</div><div class="dwo-mt">THU FEB 19 · 35 MIN</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="up">41</div></div></div>
        <div class="dsec" id="note-mr"><div class="note-box"><div class="note-l">Coach Notes</div><textarea class="note-ta" rows="3">Marcus tracking well. CTL crossed 70 — season milestone. Increase long run by 5 min this weekend. Watch left knee. Keep Z2 emphasis through next week.</textarea><div class="note-f"><button class="btn btn-g" style="font-size:11px">Save</button></div></div>
          <div class="expiry-bar"><div class="exp-track"><div class="exp-fill" style="width:62%"></div></div><div class="exp-label">Week 8 of 20 &middot; Term expires Apr 9 &middot; Auto-reverts to self-coached</div></div>
          </div>
    </div>
    </div>
    <!-- Derek Osei — FLAGGED -->
    <div class="arow-w">
      <div class="arow flagged" onclick="drill('do')">
        <div class="arc"><div class="ath-id"><div class="avi-s" style="background:var(--a1);color:var(--a);border-color:var(--a2)">DO</div><div><div class="an">Derek Osei</div><div class="ae">Chicago Tri · 89d</div><div><span class="a-state-tag" style="background:var(--g1);color:var(--g)">ACTIVATED</span></div></div></div></div>
        <div class="arc"><div class="sc-cell"><div class="sc-num warn">54</div><div class="sc-bar"><div class="sc-fill" style="width:54%;background:var(--a)"></div></div></div></div>
        <div class="arc"><div class="sc-num">48</div></div><div class="arc"><div class="sc-num warn">52</div></div><div class="arc"><div class="sc-num warn">−4</div></div>
        <div class="arc"><div class="sc-num risk">41%</div></div>
        <div class="arc" onclick="event.stopPropagation()"><div class="auto-toggle"><button class="at-btn" onclick="setAuto(this,'f')">Full</button><button class="at-btn act-p" onclick="setAuto(this,'p')">Part</button><button class="at-btn" onclick="setAuto(this,'o')">Open</button></div></div>
        <div class="arc"><span class="chip ca">Low Consist.</span></div>
      </div>
      <div class="drill-panel" id="drill-do">
        <div class="drill-top"><div class="dident"><div class="avi-s" style="width:40px;height:40px;background:var(--a1);color:var(--a);border:2px solid var(--a2);font-size:13px">DO</div><div><div class="dname">Derek Osei</div><div class="dmeta">ACTIVATED · PARTIAL AUTONOMY · CHICAGO TRI · 89 DAYS</div></div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:11px" onclick="closeDrill('do')">✕</button><button class="btn btn-b" style="font-size:11px">✉ Message</button></div></div>
        <div class="drill-bs"><div class="dbs a"><div class="dbs-type">Readiness (Equity)</div><div class="dbs-val warn">54</div><div class="dbs-desc">Below target. Missed sessions may signal life stress.</div></div><div class="dbs b"><div class="dbs-type">Fitness (Asset)</div><div class="dbs-val">48</div><div class="dbs-desc">Plateaued. Needs consistent load to build.</div></div><div class="dbs b"><div class="dbs-type">Fatigue (Liability)</div><div class="dbs-val">52</div><div class="dbs-desc">Not the issue. Consistency is the problem.</div></div></div>
        <div class="dtabs"><button class="dtab active" onclick="drillTab(this,'wk-do')">Workouts</button><button class="dtab" onclick="drillTab(this,'note-do')">Notes</button></div>
        <div class="dsec active" id="wk-do"><div class="dwo"><div class="dwo-t run">🏃</div><div class="dwo-m"><div class="dwo-n">Easy Run</div><div class="dwo-mt">WED FEB 19 · 30 MIN</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="up">35</div></div><div class="dwo" style="opacity:.5"><div class="dwo-t run">🏃</div><div class="dwo-m"><div class="dwo-n" style="color:var(--r)">Missed — Zone 2 Run</div><div class="dwo-mt">TUE FEB 18 · Scheduled</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="risk">—</div></div><div class="dwo" style="opacity:.5"><div class="dwo-t bike">🚴</div><div class="dwo-m"><div class="dwo-n" style="color:var(--r)">Missed — Threshold Bike</div><div class="dwo-mt">MON FEB 17 · Scheduled</div></div><div style="font-family:'DM Mono',monospace;font-size:14px;font-weight:800" class="risk">—</div></div></div>
        <div class="dsec" id="note-do"><div class="note-box"><div class="note-l">Coach Notes</div><textarea class="note-ta" rows="3">Missed 3 sessions this week. Text Derek — check on work stress. If consistency doesn't improve by Friday, revise race goal.</textarea><div class="note-f"><button class="btn btn-g" style="font-size:11px">Save</button></div></div></div>
      </div>
    </div>
    <!-- Aisha Lawson -->
    <div class="arow-w"><div class="arow"><div class="arc"><div class="ath-id"><div class="avi-s" style="background:var(--b1);color:var(--b);border-color:var(--b2)">AL</div><div><div class="an">Aisha Lawson</div><div class="ae">NYC Marathon · 104d</div></div></div></div><div class="arc"><div class="sc-cell"><div class="sc-num up">79</div><div class="sc-bar"><div class="sc-fill" style="width:79%;background:var(--g)"></div></div></div></div><div class="arc"><div class="sc-num up">68</div></div><div class="arc"><div class="sc-num">57</div></div><div class="arc"><div class="sc-num up">+11</div></div><div class="arc"><div class="sc-num up">94%</div></div><div class="arc"><span class="chip cg">On Track</span></div><div class="arc"><button class="btn btn-ghost" style="font-size:11px;padding:6px 12px">Drill in →</button></div></div></div>
    <div style="padding:11px 16px;background:var(--sur2);border-top:1px solid var(--bd);font-family:'DM Mono',monospace;font-size:11px;color:var(--t4)">Showing 4 of 12 · <span style="color:var(--b);cursor:pointer">Load full roster →</span></div>
  </div>
</div>

<!-- ══ COACH: PROGRAMS ══ -->
<div class="screen" id="screen-programs">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Programs</div><div class="ph-s">Your training plan library. Build, assign, and publish.</div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost" style="font-size:12px">Import Plan</button><button class="btn btn-b" style="font-size:12px">+ New Program</button></div></div></div>
  <div class="prog-grid">
    <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--b1)">🏊</div><div class="cady-verified"><span>✦</span> Published</div></div><div class="prog-name">20-Week IM 70.3</div><div class="prog-meta">20 WEEKS · 6/WK · INTERMEDIATE · 47 ENROLLED</div><div class="prog-desc">Full periodized build. Swim, bike, run. Designed for athletes targeting 4:30–5:30 finish times.</div><div class="prog-stats"><div><div class="pst-val up">47</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val">6</div><div class="pst-lbl">Assigned</div></div><div><div class="pst-val up">4.9★</div><div class="pst-lbl">Rating</div></div></div></div>
    <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--g1)">🏃</div><div class="chip cg" style="font-size:10px">Active</div></div><div class="prog-name">16-Week Olympic Tri</div><div class="prog-meta">16 WEEKS · 5/WK · ALL LEVELS · 31 ENROLLED</div><div class="prog-desc">Sprint to Olympic distance. Pacing strategy and race-day execution emphasis.</div><div class="prog-stats"><div><div class="pst-val up">31</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val">4</div><div class="pst-lbl">Assigned</div></div><div><div class="pst-val up">4.8★</div><div class="pst-lbl">Rating</div></div></div></div>
    <div class="prog-card"><div class="prog-card-top"><div class="prog-icon" style="background:var(--a1)">⚡</div><div class="chip cn" style="font-size:10px">Draft</div></div><div class="prog-name">12-Week Base Build</div><div class="prog-meta">12 WEEKS · 4/WK · BEGINNER · IN PROGRESS</div><div class="prog-desc">Foundation block. Low intensity, high consistency. For returning or new athletes.</div><div class="prog-stats"><div><div class="pst-val muted">—</div><div class="pst-lbl">Enrolled</div></div><div><div class="pst-val">2</div><div class="pst-lbl">Assigned</div></div><div><div class="pst-val muted">Draft</div><div class="pst-lbl">Status</div></div></div></div>
  </div>
</div>

<!-- ══ COACH: SCHEDULE ══ -->

<!-- ══ COACH: PLAN ASSIGNMENT ══ -->
<div class="screen" id="screen-plan-assign">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Plan Assignment</div><div class="ph-s">Assign training programs to individual athletes or groups.</div></div><div style="display:flex;gap:8px"><button class="btn btn-b" style="font-size:12px" onclick="go('library')">Open Builder →</button></div></div></div>
  <div class="g2" style="margin-bottom:14px">
    <div class="card card-p">
      <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:10px">Assign Program to Athlete</div>
      <div style="display:flex;flex-direction:column;gap:9px">
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:4px">Athlete</div>
          <select style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:8px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none;cursor:pointer">
            <option>Marcus Reid — IM 70.3</option><option>Derek Osei — Chicago Tri</option><option>Aisha Lawson — NYC Marathon</option><option>Sarah Chen — Boston</option>
          </select>
        </div>
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:4px">Program</div>
          <select style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:8px 12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--t1);outline:none;cursor:pointer">
            <option>20-Week Ironman 70.3 — Full Build</option><option>16-Week Olympic Tri</option><option>12-Week Aerobic Base</option><option>8-Week Speed Block</option>
          </select>
        </div>
        <div><div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:4px">Start Date</div>
          <input type="date" style="width:100%;background:var(--sur3);border:1px solid var(--bd);border-radius:8px;padding:8px 12px;font-family:'DM Mono',monospace;font-size:13px;color:var(--t1);outline:none" value="2026-02-23">
        </div>
      </div>
      <button class="btn btn-b" style="width:100%;justify-content:center;margin-top:14px">Assign Program →</button>
    </div>
    <div class="card card-p">
      <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:10px">Bulk Assign to Group</div>
      <div style="background:var(--sur3);border:1px solid var(--bd);border-radius:var(--rad-s);padding:10px 13px;font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:12px">Select multiple athletes and assign the same program in one action. Athletes who already have a plan will not be overwritten unless you check the override box.</div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer"><input type="checkbox"> Marcus Reid</label>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer"><input type="checkbox"> Derek Osei</label>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer"><input type="checkbox"> Aisha Lawson</label>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer"><input type="checkbox"> Sarah Chen</label>
      </div>
      <button class="btn btn-ghost" style="width:100%;justify-content:center;margin-top:12px;font-size:13px">Bulk Assign Selected →</button>
    </div>
  </div>
  <div class="sdiv">Current Assignments</div>
  <div class="plan-shell">
    <div class="plan-head" style="grid-template-columns:1fr 160px 90px 100px 80px 90px"><div class="phc">Athlete</div><div class="phc">Program</div><div class="phc">Progress</div><div class="phc">Start</div><div class="phc">End</div><div class="phc">Status</div></div>
    <div class="plan-row" style="grid-template-columns:1fr 160px 90px 100px 80px 90px"><div class="plan-ath">Marcus Reid</div><div style="font-size:12px;color:var(--t2)">IM 70.3 Build</div><div style="font-size:12px"><span class="mono up">Wk 8/20</span></div><div class="muted mono" style="font-size:11px">Nov 1</div><div class="muted mono" style="font-size:11px">Apr 9</div><div><span class="chip cg">Active</span></div></div>
    <div class="plan-row" style="grid-template-columns:1fr 160px 90px 100px 80px 90px"><div class="plan-ath">Derek Osei</div><div style="font-size:12px;color:var(--t2)">Olympic Tri</div><div style="font-size:12px"><span class="mono warn">Wk 2/12</span></div><div class="muted mono" style="font-size:11px">Feb 8</div><div class="muted mono" style="font-size:11px">May 3</div><div><span class="chip ca">Low Compliance</span></div></div>
    <div class="plan-row" style="grid-template-columns:1fr 160px 90px 100px 80px 90px"><div class="plan-ath">Aisha Lawson</div><div style="font-size:12px;color:var(--t2)">Marathon Prep</div><div style="font-size:12px"><span class="mono up">Wk 5/18</span></div><div class="muted mono" style="font-size:11px">Jan 19</div><div class="muted mono" style="font-size:11px">May 24</div><div><span class="chip cg">Active</span></div></div>
    <div class="plan-row" style="grid-template-columns:1fr 160px 90px 100px 80px 90px"><div class="plan-ath">Sarah Chen</div><div style="font-size:12px;color:var(--t2)">Boston Build</div><div style="font-size:12px"><span class="mono risk">Wk 6/20</span></div><div class="muted mono" style="font-size:11px">Oct 15</div><div class="muted mono" style="font-size:11px">Apr 20</div><div><span class="chip cr">At Risk</span></div></div>
  </div>
</div>

<div class="screen" id="screen-schedule">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Schedule</div><div class="ph-s">Assign workouts across your roster. Click any day to edit.</div></div><div style="display:flex;gap:8px;align-items:center"><button class="btn btn-ghost" style="font-size:12px">← Jan</button><div style="font-size:15px;font-weight:700;padding:0 8px">February 2026</div><button class="btn btn-ghost" style="font-size:12px">Mar →</button></div></div></div>
  <div class="cal-grid">
    <div class="cal-day-head">Sun</div><div class="cal-day-head">Mon</div><div class="cal-day-head">Tue</div><div class="cal-day-head">Wed</div><div class="cal-day-head">Thu</div><div class="cal-day-head">Fri</div><div class="cal-day-head">Sat</div>
    <div class="cal-day other-month"><div class="cdn">26</div></div><div class="cal-day other-month"><div class="cdn">27</div></div><div class="cal-day other-month"><div class="cdn">28</div></div><div class="cal-day other-month"><div class="cdn">29</div></div><div class="cal-day other-month"><div class="cdn">30</div></div><div class="cal-day other-month"><div class="cdn">31</div></div>
    <div class="cal-day"><div class="cdn">1</div></div>
    <div class="cal-day"><div class="cdn">2</div><div class="cal-wo run">MR · Z2 Run</div><div class="cal-wo bike">AL · Bike</div></div>
    <div class="cal-day"><div class="cdn">3</div><div class="cal-wo bike">MR · Tempo</div></div>
    <div class="cal-day"><div class="cdn">4</div><div class="cal-wo swim">SC · Swim</div></div>
    <div class="cal-day"><div class="cdn">5</div><div class="cal-wo run">MR · Recovery</div><div class="cal-wo run">DO · Z2</div></div>
    <div class="cal-day"><div class="cdn">6</div><div class="cal-wo bike">AL · Intervals</div></div>
    <div class="cal-day"><div class="cdn">7</div><div class="cal-wo run">MR · Long Run</div><div class="cal-wo bike">SC · Long Ride</div></div>
    <div class="cal-day"><div class="cdn">8</div><div class="cal-wo rest">SC · Rest</div></div>
    <div class="cal-day"><div class="cdn">9</div></div><div class="cal-day"><div class="cdn">10</div><div class="cal-wo bike">MR · FTP</div></div>
    <div class="cal-day"><div class="cdn">11</div><div class="cal-wo swim">SC · Swim</div></div>
    <div class="cal-day"><div class="cdn">12</div><div class="cal-wo run">AL · Threshold</div></div>
    <div class="cal-day"><div class="cdn">13</div><div class="cal-wo swim">MR · Open Water</div></div>
    <div class="cal-day"><div class="cdn">14</div><div class="cal-wo bike">MR · Long Ride</div><div class="cal-wo run">SC · LR</div></div>
    <div class="cal-day"><div class="cdn">15</div></div><div class="cal-day"><div class="cdn">16</div></div>
    <div class="cal-day"><div class="cdn">17</div></div><div class="cal-day"><div class="cdn">18</div><div class="cal-wo bike">DO · Threshold</div></div>
    <div class="cal-day"><div class="cdn">19</div><div class="cal-wo run">SC · Tempo</div></div>
    <div class="cal-day today"><div class="cdn" style="color:var(--g);font-weight:800">21</div><div class="cal-wo run">MR · Z2 Run</div></div>
    <div class="cal-day"><div class="cdn">22</div></div>
    <div class="cal-day"><div class="cdn">23</div></div>
  </div>
  <div class="plan-shell">
    <div class="plan-head"><div class="phc">Athlete</div><div class="phc">MON</div><div class="phc">TUE</div><div class="phc">WED</div><div class="phc">THU</div><div class="phc">FRI</div><div class="phc">SAT</div><div class="phc">SUN</div></div>
    <div class="plan-row"><div class="plan-ath">Marcus Reid</div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd sched">Z2</div></div><div class="day-c"><div class="dd rest">—</div></div></div>
    <div class="plan-row"><div class="plan-ath">Sarah Chen</div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd sched">T</div></div><div class="day-c"><div class="dd sched">LR</div></div><div class="day-c"><div class="dd rest" style="background:var(--r1);color:var(--r);border-color:var(--r2)">REST</div></div><div class="day-c"><div class="dd rest">—</div></div></div>
    <div class="plan-row"><div class="plan-ath">Derek Osei</div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd missed">✗</div></div><div class="day-c"><div class="dd missed">✗</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd missed">✗</div></div><div class="day-c"><div class="dd sched">B</div></div><div class="day-c"><div class="dd sched">R</div></div></div>
    <div class="plan-row"><div class="plan-ath">Aisha Lawson</div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd done">✓</div></div><div class="day-c"><div class="dd sched">LR</div></div></div>
  </div>
</div>

<!-- ══ COACH: INSIGHTS ══ -->

<!-- ══ INSIGHTS ══ -->

<!-- ══ COACH: INSIGHTS CHARTS ══ -->
<div class="screen" id="screen-insights-charts">
  <div class="ph">
    <div class="ph-row">
      <div>
        <div class="ph-t">Charts</div>
        <div class="ph-s">Workout detail charts for any athlete — same view athletes see for themselves.</div>
      </div>
    </div>
  </div>

  <!-- ATHLETE FILTER -->
  <div style="margin-bottom:16px">
    <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:8px">Viewing Athlete</div>
    <div style="display:flex;gap:6px;flex-wrap:wrap" id="coach-ath-filters">
      <button class="lib-filter active" onclick="coachSelectAth(this,'Marcus Reid','fri','swim')">Marcus Reid</button>
      <button class="lib-filter" onclick="coachSelectAth(this,'Sarah Chen','tue','run')">Sarah Chen</button>
      <button class="lib-filter" onclick="coachSelectAth(this,'Derek Osei','wed','bike')">Derek Osei</button>
      <button class="lib-filter" onclick="coachSelectAth(this,'Aisha Lawson','thu','run')">Aisha Lawson</button>
    </div>
  </div>

  <!-- ATHLETE STATUS STRIP -->
  <div id="coach-ath-status" style="background:var(--sur);border:1px solid var(--bd);border-radius:var(--rad);padding:14px 18px;margin-bottom:16px;display:flex;align-items:center;gap:20px;flex-wrap:wrap;box-shadow:var(--sh)">
    <div style="display:flex;align-items:center;gap:10px">
      <div id="coach-ath-avi" style="width:36px;height:36px;border-radius:50%;background:var(--g1);color:var(--g);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700">MR</div>
      <div>
        <div id="coach-ath-name-lbl" style="font-weight:700;font-size:14px">Marcus Reid</div>
        <div id="coach-ath-status-txt" style="font-size:11px;color:var(--t3);font-family:'DM Mono',monospace">Week 8 of 20 · Ironman 70.3 · Readiness: 82</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-left:auto">
      <div style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:16px;font-weight:600;color:var(--g)">82</div><div style="font-size:10px;color:var(--t4)">Readiness</div></div>
      <div style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:16px;font-weight:600">72</div><div style="font-size:10px;color:var(--t4)">Fitness</div></div>
      <div style="text-align:center"><div style="font-family:'DM Mono',monospace;font-size:16px;font-weight:600;color:var(--a)">61</div><div style="font-size:10px;color:var(--t4)">Fatigue</div></div>
    </div>
  </div>

  <!-- WEEK STRIP -->
  <div class="week-strip" id="coach-week-strip" style="margin-bottom:14px">
    <div class="day-card" id="coachday-mon" onclick="coachSelectDay('mon')"><div class="day-label">Mon</div><div class="day-dot done" style="background:#60a5fa;color:#fff;font-size:11px">🏊</div><div class="day-sport">Swim</div><div class="day-dur">45m easy</div></div>
    <div class="day-card" id="coachday-tue" onclick="coachSelectDay('tue')"><div class="day-label">Tue</div><div class="day-dot done" style="background:#f87171;color:#fff;font-size:11px">🏃</div><div class="day-sport">Run</div><div class="day-dur">55m hard</div></div>
    <div class="day-card" id="coachday-wed" onclick="coachSelectDay('wed')"><div class="day-label">Wed</div><div class="day-dot done" style="background:#a78bfa;color:#fff;font-size:11px">🚴</div><div class="day-sport">Bike</div><div class="day-dur">90m mod</div></div>
    <div class="day-card" id="coachday-thu" onclick="coachSelectDay('thu')"><div class="day-label">Thu</div><div class="day-dot done" style="background:#f87171;color:#fff;font-size:11px">🏃</div><div class="day-sport">Run</div><div class="day-dur">30m easy</div></div>
    <div class="day-card today selected" id="coachday-fri" onclick="coachSelectDay('fri')"><div class="day-label">Fri</div><div class="day-dot today-pulse" style="background:#3b82f6;color:#fff;font-size:11px">🏊</div><div class="day-sport">Swim</div><div class="day-dur">50m easy</div></div>
    <div class="day-card" id="coachday-sat" onclick="coachSelectDay('sat')"><div class="day-label">Sat</div><div class="day-dot planned" style="width:28px;height:28px;font-size:11px;display:flex;align-items:center;justify-content:center">🏃</div><div class="day-sport">Long Run</div><div class="day-dur">1h45 easy</div></div>
    <div class="day-card"><div class="day-label">Sun</div><div class="day-dot rest-dot"></div><div class="day-sport">Rest</div></div>
  </div>

  <!-- WORKOUT DETAIL CHART (reuses same SVG engine) -->
  <div class="wdc" id="coach-wdc">
    <div class="wdc-header">
      <div>
        <div class="wdc-label" id="coach-wdc-label">Friday Swim · 50 min · 2,400m — Marcus Reid</div>
        <div class="wdc-title">Workout Detail</div>
      </div>
      <div>
        <div class="view-chips" id="coach-view-chips"></div>
        <div class="compare-chips">
          <button class="cchip active" onclick="coachSetCmp(this,'this')">This workout</button>
          <button class="cchip" onclick="coachSetCmp(this,'last')">vs Last Similar</button>
          <button class="cchip" onclick="coachSetCmp(this,'base')">vs Baseline</button>
          <button class="cchip" onclick="coachSetCmp(this,'best')">vs Best</button>
        </div>
      </div>
    </div>
    <div class="scrub-tooltip" id="coach-scrub-tt">Move cursor over chart to explore</div>
    <div class="wdc-panels" id="coach-wdc-panels" onmouseleave="coachClearScrub()"></div>
  </div>

  <!-- INSIGHT CARDS (same data engine, scoped to selected athlete) -->
  <div style="margin-top:16px">
    <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:10px" id="coach-insights-lbl">Marcus Reid — Insights</div>
    <div id="coach-insight-cards">
      <div class="insight-card" style="border:1.5px solid #f59e0b;background:#fffbf0;margin-bottom:8px">
        <div class="ic-header"><span class="ic-badge badge-amber">Watch This Week</span><span class="ic-confidence">Medium confidence</span></div>
        <div class="ic-title">Load Spike Risk</div>
        <div class="ic-sowhat">This week jumped 28% above the 4-week average. Right at the edge of where small injuries tend to appear.</div>
        <div class="ic-footer"><button class="ic-expand" onclick="coachToggleCard(this,'load')">Show me why →</button></div>
        <div class="ic-expanded-body" id="coach-ic-load">
          <div class="ic-section-lbl">Coaching Action</div>
          <div class="ic-section-txt">Keep today's swim as planned — easy effort only. Don't add Saturday yardage even if Marcus feels strong.</div>
          <div class="ic-section-lbl">Watch Saturday</div>
          <div class="ic-section-txt">Any tightness in calves or Achilles on warm-up. Stop the session early if it's there.</div>
          <div class="ic-mini-chart"><div class="ic-mini-title">Weekly Load vs 4-Week Average</div><div id="coach-load-chart"></div><div class="ic-mini-note" style="color:#f59e0b">+28% above baseline</div></div>
        </div>
      </div>
      <div class="insight-card" style="border:1.5px solid #e5e5e5;background:#fafafa;margin-bottom:8px">
        <div class="ic-header"><span class="ic-badge badge-ghost">On Track</span><span class="ic-confidence">High confidence</span></div>
        <div class="ic-title">Aerobic Base Building</div>
        <div class="ic-sowhat">Easy pace at zone 2 has improved 8 seconds per mile over 6 weeks. The base is working — program is effective.</div>
        <div class="ic-footer"><button class="ic-expand" onclick="coachToggleCard(this,'aerobic')">Show me why →</button></div>
        <div class="ic-expanded-body" id="coach-ic-aerobic">
          <div class="ic-section-lbl">Coaching Action</div>
          <div class="ic-section-txt">Nothing to change — maintain the current prescription structure through next week.</div>
          <div class="ic-mini-chart"><div class="ic-mini-title">Same Effort, Faster Pace — 6-Week Trend</div><div id="coach-aerobic-chart"></div><div class="ic-mini-note" style="color:#34d399">↓ 18s/mi improvement at same HR</div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="screen" id="screen-insights">
<div id="insights-athlete" style="display:none"></div>
<div id="insights-coach">
  <div class="ph" style="padding-bottom:0">
    <div class="ph-row">
      <div>
        <div class="ph-t">Roster &amp; Flags</div>
        <div class="ph-s">Performance trends and active alerts across your full roster.</div>
      </div>
      <div style="display:flex;gap:6px;align-items:center">
        <span class="alrt-count-badge" style="background:var(--r1);color:var(--r);font-family:'DM Mono',monospace;font-size:11px;font-weight:700;padding:3px 9px;border-radius:6px;border:1px solid var(--r2)">3 alerts</span>
        <button class="btn btn-ghost" style="font-size:12px" onclick="go('insights-charts')">Open Charts →</button>
      </div>
    </div>
  </div>

  <!-- KPI STRIP -->
  <div class="insight-strip">
    <div class="cs-c"><div class="cs-l">Avg Readiness</div><div class="cs-v up">74</div><div class="cs-s up">↑ +4 vs last week</div></div>
    <div class="cs-c" style="border-top:2px solid var(--r)"><div class="cs-l">At Risk</div><div class="cs-v risk">1</div><div class="cs-s risk">Overreach</div></div>
    <div class="cs-c" style="border-top:2px solid var(--a)"><div class="cs-l">Load Spikes</div><div class="cs-v warn">2</div><div class="cs-s warn">SC, DO</div></div>
    <div class="cs-c"><div class="cs-l">Completion</div><div class="cs-v">78%</div><div class="cs-s muted">7d sessions</div></div>
    <div class="cs-c"><div class="cs-l">Avg Fitness Δ</div><div class="cs-v up">+2.8</div><div class="cs-s up">7-day</div></div>
  </div>

  <!-- ACTIVE FLAGS (alerts at top, visible without any tab click) -->
  <div style="margin-bottom:14px">
    <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:8px">Active Flags</div>
    <div class="alrt danger"><div class="alrt-ic">⚠️</div><div class="alrt-b"><div class="alrt-who">Sarah Chen</div><div class="alrt-txt">HRV dropped 22% overnight. Fatigue (87) exceeds fitness (65). Rest day mandatory.</div><div class="alrt-time">2h ago · Overreach</div></div><button class="alrt-cta" onclick="go('insights-charts');setTimeout(()=>coachSelectAth(document.querySelector('[onclick*="Sarah Chen"]'),'Sarah Chen','tue','run'),200)">View Charts →</button></div>
    <div class="alrt warn" style="margin-top:5px"><div class="alrt-ic">⏰</div><div class="alrt-b"><div class="alrt-who">Derek Osei</div><div class="alrt-txt">Missed 3 of 5 sessions this week. Consistency at 41%.</div><div class="alrt-time">Yesterday · Session missed</div></div><button class="alrt-cta" onclick="go('roster')">View Roster →</button></div>
    <div class="alrt info" style="margin-top:5px"><div class="alrt-ic">🎯</div><div class="alrt-b"><div class="alrt-who">Marcus Reid</div><div class="alrt-txt">Fitness crossed 70 for first time this season. On pace for race-day 84.</div><div class="alrt-time">Today 6:45 AM · Milestone</div></div><button class="alrt-cta" onclick="go('insights-charts')">View Charts →</button></div>
  </div>

  <!-- ROSTER BAR CHART -->
  <div class="bar-chart-card" style="margin-bottom:14px">
    <div class="bcc-title">7-Day Readiness — All Athletes</div>
    <div class="bar-viz">
      <div class="bv fit" style="height:38%;background:var(--r)" title="SC: 38 ⚠"></div>
      <div class="bv fit now" style="height:82%" title="MR: 82"></div>
      <div class="bv fit" style="height:54%;background:var(--a)" title="DO: 54"></div>
      <div class="bv fit" style="height:79%" title="AL: 79"></div>
      <div class="bv fit" style="height:71%"></div><div class="bv fit" style="height:68%"></div>
      <div class="bv fit" style="height:74%"></div><div class="bv fit" style="height:66%"></div>
      <div class="bv fit" style="height:81%"></div><div class="bv fit" style="height:77%"></div>
      <div class="bv fit" style="height:62%"></div><div class="bv fit" style="height:88%"></div>
    </div>
    <div class="chart-ft"><span>12 athletes · Mon–Sun</span><span class="up">Avg: 74</span></div>
  </div>

  <!-- INDIVIDUAL ROSTER ROWS -->
  <div class="roster-perf">
    <div class="rp-title" style="display:flex;align-items:center;justify-content:space-between">
      <span>Individual Performance — This Week</span>
      <button class="btn btn-ghost" style="font-size:11px;padding:4px 10px" onclick="go('insights-charts')">Open Charts →</button>
    </div>
    <div class="rp-row" style="cursor:pointer" onclick="go('insights-charts');setTimeout(()=>{var b=document.querySelectorAll('#coach-ath-filters .lib-filter')[1];if(b)coachSelectAth(b,'Sarah Chen','tue','run');},200)">
      <div class="rp-avi" style="background:var(--r1);color:var(--r)">SC</div><div class="rp-name">Sarah Chen</div>
      <div class="rp-bars"><div class="rp-bar-item"><div class="rp-bar-lbl">F</div><div class="rp-bw"><div class="rp-bf" style="width:65%;background:var(--b)"></div></div><div class="rp-val muted">65</div></div><div class="rp-bar-item"><div class="rp-bar-lbl">L</div><div class="rp-bw"><div class="rp-bf" style="width:87%;background:var(--r)"></div></div><div class="rp-val risk">87</div></div></div>
      <span class="chip cr" style="font-size:10px">AT RISK</span>
    </div>
    <div class="rp-row" style="cursor:pointer" onclick="go('insights-charts')">
      <div class="rp-avi" style="background:var(--g1);color:var(--g)">MR</div><div class="rp-name">Marcus Reid</div>
      <div class="rp-bars"><div class="rp-bar-item"><div class="rp-bar-lbl">F</div><div class="rp-bw"><div class="rp-bf" style="width:72%;background:var(--g)"></div></div><div class="rp-val up">72</div></div><div class="rp-bar-item"><div class="rp-bar-lbl">L</div><div class="rp-bw"><div class="rp-bf" style="width:61%;background:var(--a)"></div></div><div class="rp-val warn">61</div></div></div>
      <span class="chip cg" style="font-size:10px">Productive</span>
    </div>
    <div class="rp-row" style="cursor:pointer" onclick="go('insights-charts');setTimeout(()=>{var b=document.querySelectorAll('#coach-ath-filters .lib-filter')[2];if(b)coachSelectAth(b,'Derek Osei','wed','bike');},200)">
      <div class="rp-avi" style="background:var(--a1);color:var(--a)">DO</div><div class="rp-name">Derek Osei</div>
      <div class="rp-bars"><div class="rp-bar-item"><div class="rp-bar-lbl">F</div><div class="rp-bw"><div class="rp-bf" style="width:48%;background:var(--b)"></div></div><div class="rp-val muted">48</div></div><div class="rp-bar-item"><div class="rp-bar-lbl">L</div><div class="rp-bw"><div class="rp-bf" style="width:52%;background:var(--a)"></div></div><div class="rp-val warn">52</div></div></div>
      <span class="chip ca" style="font-size:10px">Low Consist.</span>
    </div>
    <div class="rp-row">
      <div class="rp-avi" style="background:var(--b1);color:var(--b)">AL</div><div class="rp-name">Aisha Lawson</div>
      <div class="rp-bars"><div class="rp-bar-item"><div class="rp-bar-lbl">F</div><div class="rp-bw"><div class="rp-bf" style="width:68%;background:var(--g)"></div></div><div class="rp-val up">68</div></div><div class="rp-bar-item"><div class="rp-bar-lbl">L</div><div class="rp-bw"><div class="rp-bf" style="width:58%;background:var(--g)"></div></div><div class="rp-val up">58</div></div></div>
      <span class="chip cg" style="font-size:10px">On Track</span>
    </div>
  </div>
</div>
</div>

<div class="screen" id="screen-business">
  <div class="ph"><div class="ph-t">Business</div><div class="ph-s">Subscriptions, billing, and your coach profile.</div></div>

  <div class="biz-hero">
    <div>
      <div class="biz-plan-badge">✓ Active Plan</div>
      <div class="biz-plan-name">Coreformance Pro Coach</div>
      <div class="biz-plan-sub">Up to 25 athletes · Cady Core eligible · Full platform access</div>
    </div>
    <div class="biz-plan-price">
      <div class="biz-price-amt">$129</div>
      <div class="biz-price-per">/month · Billed annually</div>
      <button class="btn btn-ghost" style="font-size:12px;margin-top:10px">Manage Plan</button>
    </div>
  </div>

  <div class="biz-metrics">
    <div class="biz-m"><div class="biz-m-l">Active Athletes</div><div class="biz-m-v up">12</div><div class="biz-m-s muted">of 25 seats used</div></div>
    <div class="biz-m"><div class="biz-m-l">MRR</div><div class="biz-m-v up">$960</div><div class="biz-m-s up">↑ +2 athletes vs last month</div></div>
    <div class="biz-m"><div class="biz-m-l">Avg Revenue / Athlete</div><div class="biz-m-v">$80</div><div class="biz-m-s muted">/month average</div></div>
    <div class="biz-m"><div class="biz-m-l">Renewal Rate</div><div class="biz-m-v up">91%</div><div class="biz-m-s up">Last 12 months</div></div>
  </div>

  <div class="sdiv">Athlete Subscriptions</div>
  <div class="billing-table">
    <div class="bt-head" style="grid-template-columns:1fr 95px 85px 90px 75px 80px"><div class="bth">Athlete</div><div class="bth">State</div><div class="bth">Plan</div><div class="bth">Amount</div><div class="bth">Expires</div><div class="bth">Status</div></div>
    <div class="bt-row" style="grid-template-columns:1fr 95px 85px 90px 75px 80px"><div style="font-weight:600">Marcus Reid</div><div><span class="chip cg" style="font-size:9px">ACTIVATED</span></div><div class="muted mono" style="font-size:12px">Monthly</div><div class="up mono" style="font-size:12px">$80/mo</div><div class="muted mono" style="font-size:11px">Apr 9</div><div><span class="chip cg">Active</span></div></div>
    <div class="bt-row" style="grid-template-columns:1fr 95px 85px 90px 75px 80px"><div style="font-weight:600">Sarah Chen</div><div><span class="chip cb" style="font-size:9px">INVITED</span></div><div class="muted mono" style="font-size:12px">Monthly</div><div class="up mono" style="font-size:12px">$80/mo</div><div class="muted mono" style="font-size:11px">Apr 30</div><div><span class="chip cg">Active</span></div></div>
    <div class="bt-row" style="grid-template-columns:1fr 95px 85px 90px 75px 80px"><div style="font-weight:600">Derek Osei</div><div><span class="chip cg" style="font-size:9px">ACTIVATED</span></div><div class="muted mono" style="font-size:12px">Monthly</div><div class="up mono" style="font-size:12px">$80/mo</div><div class="muted mono" style="font-size:11px">May 15</div><div><span class="chip ca">At Risk</span></div></div>
    <div class="bt-row" style="grid-template-columns:1fr 95px 85px 90px 75px 80px"><div style="font-weight:600">Aisha Lawson</div><div><span class="chip cb" style="font-size:9px">INVITED</span></div><div class="muted mono" style="font-size:12px">Annual</div><div class="up mono" style="font-size:12px">$720/yr</div><div class="muted mono" style="font-size:11px">Jan 2027</div><div><span class="chip cg">Active</span></div></div>
    <div style="padding:10px 18px;background:var(--sur2);border-top:1px solid var(--bd);font-family:'DM Mono',monospace;font-size:11px;color:var(--t4)">Showing 4 of 12 · <span style="color:var(--b);cursor:pointer">View all →</span></div>
  </div>


  <div class="sdiv">Key Insights</div>
  <div class="g2" style="margin-bottom:14px">
    <div class="card card-p"><div style="font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:var(--a);margin-bottom:6px">⏰ EXPIRING SOON</div><div style="font-size:15px;font-weight:700;margin-bottom:5px">2 activation terms expire this season</div><div style="font-size:13px;color:var(--t2);line-height:1.6">Marcus Reid's term expires Apr 9 (47d). Consider sending a renewal key before term ends to maintain the relationship without interruption.</div><div style="margin-top:10px"><button class="btn btn-ghost" style="font-size:12px;padding:6px 13px" onclick="go('invite')">Generate Renewal Key</button></div></div>
    <div class="card card-p"><div style="font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:var(--g);margin-bottom:6px">↑ ROSTER HEALTH</div><div style="font-size:15px;font-weight:700;margin-bottom:5px">Activation model working well</div><div style="font-size:13px;color:var(--t2);line-height:1.6">7 of 12 athletes came through activation keys this season. 91% renewal rate among athletes who completed a full program term. Strong signal for the key model.</div><div style="margin-top:10px"><button class="btn btn-ghost" style="font-size:12px;padding:6px 13px" onclick="go('insights')">View Roster Insights</button></div></div>
  </div>
  <div style="background:var(--gold1);border:1px solid var(--gold2);border-radius:var(--rad);padding:16px 20px;margin-top:14px;display:flex;align-items:center;justify-content:space-between">
    <div>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><div class="cady-badge" style="padding:3px 10px"><span>✦</span> Cady Core</div><span style="font-size:11px;font-weight:600;color:var(--gold)">Profile Live</span></div>
      <div style="font-size:13px;color:var(--t2)">Your Cady Core profile is visible to athletes in Discover. 34 active athletes. 94% completion rate.</div>
    </div>
    <button class="btn btn-gold" style="font-size:12px;flex-shrink:0" onclick="setMode('athlete');setTimeout(()=>go('discover'),100)">Edit Profile →</button>
  </div>
</div>

</div><!-- /app -->

</div><!-- /app -->

<script>
/* ════════════════════════════════════
   STATE
════════════════════════════════════ */
var userRole = null;
var currentMode = 'athlete';
var obSelRoleVal = null;
var obSelectedSport = null;
var REL_STATE = 'self';
var obAthType = null;

// Interval builder state
var blocks = [];
var selectedBlock = null;
var dragSrcEl = null;
var dragData = null;

// Plan canvas state
var planWeeks = [
  {num:1,phase:'base',load:280,days:['r1','b1',null,'s1',null,'r3',null]},
  {num:2,phase:'base',load:310,days:['r1','b1',null,'s1','r4','r3',null]},
  {num:3,phase:'base',load:295,days:[null,'b1','r1','s1',null,'r3',null]},
  {num:4,phase:'base',load:260,days:['r1','b2',null,'s1',null,'r1',null]},
  {num:5,phase:'build',load:355,days:['r4','b1',null,'s1','r2','r3',null]},
  {num:6,phase:'build',load:380,days:['r4','b1','r1','s1','r2','r3',null]},
  {num:7,phase:'build',load:405,days:['r4','b2',null,'s1','r2','r3',null]},
  {num:8,phase:'build',load:390,days:['r4','b1','r1','s1',null,'r3',null]},
  {num:9,phase:'peak',load:440,days:['r4','b2','r1','s1','r2','r3',null]},
  {num:10,phase:'peak',load:460,days:['r4','b2','r1','s1','r2','r3','b3']},
  {num:11,phase:'taper',load:320,days:['r1','b1',null,'s1',null,'r1',null]},
  {num:12,phase:'taper',load:240,days:['r1',null,null,'s1',null,null,null]},
];

var workoutLib = {
  r1:{name:'Zone 2 Run',dur:'55 min',type:'run',tag:'z2'},
  r2:{name:'5K Race Pace',dur:'50 min',type:'run',tag:'race'},
  r3:{name:'Long Run',dur:'90 min',type:'run',tag:'long'},
  r4:{name:'Tempo 3×15',dur:'65 min',type:'run',tag:'threshold'},
  b1:{name:'Threshold Bike',dur:'70 min',type:'bike',tag:'threshold'},
  b2:{name:'VO2 6×3min',dur:'55 min',type:'bike',tag:'vo2'},
  b3:{name:'Z2 Endurance',dur:'120 min',type:'bike',tag:'z2'},
  s1:{name:'Aerobic Swim',dur:'40 min',type:'swim',tag:'aerobic'},
};

/* ════════════════════════════════════
   ONBOARDING
════════════════════════════════════ */
function selectRole(role, el) {
  obSelRoleVal = role;
  document.querySelectorAll('#ob-s1 .ob-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  var btn = document.getElementById('ob-next1');
  btn.disabled = false; btn.style.opacity = '1'; btn.style.cursor = 'pointer';
}
function selectSport(sport, el) {
  obSelectedSport = sport;
  document.querySelectorAll('#ob-s2 .ob-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  var btn = document.getElementById('ob-next2');
  btn.disabled = false; btn.style.opacity = '1'; btn.style.cursor = 'pointer';
}
function obNext() {
  document.getElementById('ob-s1').style.display = 'none';
  var s2 = obSelRoleVal === 'coach' ? 'ob-s2' : 'ob-s2-athlete';
  document.getElementById(s2).style.display = 'block';
  document.getElementById('ob-step-lbl').textContent = 'Step 2 of 2';
  var dots = document.querySelectorAll('.ob-prog-dot');
  dots[0].classList.remove('active'); dots[0].classList.add('done');
  dots[1].classList.add('active');
}
function obBack() {
  ['ob-s2','ob-s2-athlete'].forEach(id => { var e=document.getElementById(id); if(e)e.style.display='none'; });
  document.getElementById('ob-s1').style.display = 'block';
  document.getElementById('ob-step-lbl').textContent = 'Step 1 of 2';
  var dots = document.querySelectorAll('.ob-prog-dot');
  dots[0].classList.remove('done'); dots[0].classList.add('active');
  dots[1].classList.remove('active');
}
function obFinish() {
  userRole = obSelRoleVal;
  launchFromOnboard();
}
function obSelAthType(type, el) {
  obAthType = type;
  document.querySelectorAll('#ob-s2-athlete .ob-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('ob-team-code').style.display = type === 'team' ? 'block' : 'none';
  if (type === 'independent') {
    var btn = document.getElementById('ob-btn-ath');
    btn.disabled = false; btn.style.opacity = '1'; btn.style.cursor = 'pointer';
  }
}
function obCheckTeamCode() {
  if (document.getElementById('ob-team-input').value.trim().length >= 4) {
    var btn = document.getElementById('ob-btn-ath');
    btn.disabled = false; btn.style.opacity = '1'; btn.style.cursor = 'pointer';
  }
}
function obFinishAthlete() {
  userRole = 'athlete';
  REL_STATE = obAthType === 'team' ? 'assigned-partial' : 'self';
  launchFromOnboard();
}
function launchFromOnboard() {
  document.getElementById('onboard').style.display = 'none';
  document.getElementById('topbar').style.display = 'flex';
  document.getElementById('main-app').style.display = 'block';
  document.getElementById('sidebar').classList.add('visible');
  if (userRole === 'coach') {
    document.getElementById('sb-role-switcher').style.display = 'block';
    setMode('coach');
  } else {
    setMode('athlete');
    renderRelationshipUI();
  }
}

/* ════════════════════════════════════
   SIDEBAR NAV CONFIG
════════════════════════════════════ */
var athleteNavConfig = {
  'self':             [{id:'today',icon:'📍',label:'Today'},{id:'training',icon:'🗓️',label:'Training'},{id:'performance',icon:'📈',label:'Performance'},{id:'intelligence',icon:'🤖',label:'Intelligence'},{id:'discover',icon:'🔍',label:'Discover'}],
  'activated':        [{id:'today',icon:'📍',label:'Today'},{id:'training',icon:'🗓️',label:'Training'},{id:'performance',icon:'📈',label:'Performance'},{id:'intelligence',icon:'🤖',label:'Intelligence'},{id:'discover',icon:'🔍',label:'Discover'}],
  'assigned-open':    [{id:'today',icon:'📍',label:'Today'},{id:'training',icon:'🗓️',label:'Training'},{id:'performance',icon:'📈',label:'Performance'},{id:'intelligence',icon:'🤖',label:'Intelligence'},{id:'discover',icon:'🔍',label:'Discover'}],
  'assigned-partial': [{id:'today',icon:'📍',label:'Today'},{id:'training',icon:'🗓️',label:'Training'},{id:'performance',icon:'📈',label:'Performance'},{id:'intelligence',icon:'🤖',label:'Intelligence'},{id:'discover',icon:'🔍',label:'Discover'}],
  'assigned-full':    [{id:'today',icon:'📍',label:'Today'},{id:'training',icon:'🗓️',label:'Training'},{id:'performance',icon:'📈',label:'Performance'}],
};

var coachNavGroups = [
  {label:'', items:[{id:'home',icon:'🏠',label:'Home'}]},
  {label:'Athletes', items:[
    {id:'roster',icon:'👥',label:'Roster',noNav:true, subs:[
      {id:'roster',label:'All Athletes'},
      {id:'invite',label:'Invite & Keys'},
    ]},
  ]},
  {label:'Planning', items:[
    {id:'schedule',icon:'📅',label:'Schedule',noNav:true, subs:[
      {id:'schedule',label:'Calendar'},
      {id:'plan-assign',label:'Plan Assignment'},
    ]},
    {id:'library',icon:'📚',label:'Programs',noNav:true, subs:[
      {id:'library',label:'Plan Library'},
      {id:'programs',label:'Templates'},
    ]},
  ]},
  {label:'Analytics', items:[
    {id:'insights',icon:'📊',label:'Insights',noNav:true, subs:[
      {id:'insights',label:'Roster & Flags'},
      {id:'insights-charts',label:'Charts'},
    ]},
  ]},
  {label:'', items:[
    {id:'business',icon:'⚙️',label:'Business',noNav:true, subs:[
      {id:'business',label:'Billing & Plans'},
      {id:'my-profile',label:'Coach Profile'},
    ]},
  ]},
];

function buildSidebar() {
  var nav = document.getElementById('sb-nav');
  if (!nav) return;
  nav.innerHTML = '';

  if (currentMode === 'coach') {
    coachNavGroups.forEach(function(grp) {
      var grpEl = document.createElement('div');
      grpEl.className = 'sb-group';
      var html = '';
      if (grp.label) html += '<span class="sb-group-lbl">' + grp.label + '</span>';
      grp.items.forEach(function(item) {
        var hasSubs = item.subs && item.subs.length > 0;
        html += '<button class="sb-item" id="sb-' + item.id + '" data-sid="' + item.id + '" data-hassubs="' + (hasSubs?'1':'0') + '" data-nonav="' + (item.noNav?'1':'0') + '" onclick="sbItemClick(this)">';
        html += '<span class="sb-icon">' + item.icon + '</span>';
        html += '<span>' + item.label + '</span>';
        if (hasSubs) html += '<span class="sb-chevron">›</span>';
        html += '</button>';
        if (hasSubs) {
          html += '<div class="sb-sub-items">';
          item.subs.forEach(function(sub,i) {
            html += '<button class="sb-sub-item" data-sid="' + sub.id + '" onclick="go(this.dataset.sid)">' + sub.label + '</button>';
          });
          html += '</div>';
        }
      });
      grpEl.innerHTML = html;
      nav.appendChild(grpEl);
    });
    // Update workspace info
    document.getElementById('sb-ws-title').textContent = 'Jordan Taylor';
    document.getElementById('sb-ws-detail').textContent = 'Coach View · 12 athletes';
  } else {
    var items = athleteNavConfig[REL_STATE] || athleteNavConfig['self'];
    var grpEl = document.createElement('div');
    grpEl.className = 'sb-group';
    var html = '';
    items.forEach(function(item) {
      html += '<button class="sb-item" id="sb-' + item.id + '" data-sid="' + item.id + '" onclick="go(this.dataset.sid)">';
      html += '<span class="sb-icon">' + item.icon + '</span>';
      html += '<span>' + item.label + '</span>';
      html += '</button>';
    });
    grpEl.innerHTML = html;
    nav.appendChild(grpEl);
    document.getElementById('sb-ws-title').textContent = 'Marcus Reid';
    document.getElementById('sb-ws-detail').textContent = relStateLabel();
  }
}

function sbItemClick(el) {
  var id = el.dataset.sid;
  var hasSubs = el.dataset.hassubs === '1';
  var noNav = el.dataset.nonav === '1';
  if (hasSubs) {
    var grp = el.closest('.sb-group');
    var wasOpen = grp.classList.contains('open');
    document.querySelectorAll('#sb-nav .sb-group').forEach(g => g.classList.remove('open'));
    if (!wasOpen) grp.classList.add('open');
  }
  if (!noNav) go(id);
}

function setSidebarActive(id) {
  document.querySelectorAll('.sb-item').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.sb-sub-item').forEach(b => b.classList.remove('active'));
  var btn = document.getElementById('sb-' + id);
  if (btn) btn.classList.add('active');
}

/* ════════════════════════════════════
   MODE SWITCH
════════════════════════════════════ */
function setMode(mode) {
  currentMode = mode;
  var isCoach = mode === 'coach';
  document.body.classList.toggle('coach-mode', isCoach);
  document.getElementById('sb-athlete-btn').classList.toggle('active', !isCoach);
  document.getElementById('sb-coach-btn').classList.toggle('active', isCoach);
  var dot = document.querySelector('.logo-dot');
  if (dot) dot.style.color = isCoach ? 'var(--b)' : 'var(--g)';
  var av = document.getElementById('uavi');
  av.className = 'uavi ' + (isCoach?'c':'a');
  av.textContent = isCoach ? 'JT' : 'MR';
  document.getElementById('race-tag').style.display = isCoach ? 'none' : 'flex';
  // Update topbar workspace
  document.getElementById('tb-ws-name').textContent = isCoach ? 'Jordan Taylor' : 'Marcus Reid';
  document.getElementById('tb-ws-sub').textContent = isCoach ? 'Coach View · 12 athletes' : 'Self-Coached · Ironman 70.3 · 47d';
  buildSidebar();
  var activeScreen = document.querySelector('.screen.active');
  if(activeScreen && activeScreen.id === 'screen-insights') {
    showInsightsForMode();
    go('insights');
  } else {
    go(isCoach ? 'home' : 'today');
  }
}

/* ════════════════════════════════════
   NAVIGATION
════════════════════════════════════ */
var coachScreenIds = ['home','roster','programs','schedule','plan-assign','insights','insights-charts','business','invite','coach-profile','library','my-profile'];

function go(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  var el = document.getElementById('screen-' + id);
  if (el) el.classList.add('active');
  setSidebarActive(id);
  if (id === 'library') buildWeeks();
  if (id === 'insights') showInsightsForMode();
  if (id === 'performance') setTimeout(function(){ perfAnimateRings(); perfRenderWDC(); }, 60);
  if (id === 'insights-charts') setTimeout(function(){ coachRenderWDC(); }, 60);
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ════════════════════════════════════
   RELATIONSHIP UI
════════════════════════════════════ */
function relStateLabel() {
  var m = {self:'Self-Coached',activated:'Activated · Jordan Taylor','assigned-partial':'Team · Partial Autonomy','assigned-full':'Team · Full Control','assigned-open':'Team · Open'};
  return m[REL_STATE] || 'Self-Coached';
}

function renderRelationshipUI() {
  // No jargon banner — just update topbar workspace sub and coach strip if activated
  document.getElementById('tb-ws-sub').textContent = 
    REL_STATE === 'self' ? 'Self-Coached · Ironman 70.3 · 47d' :
    REL_STATE === 'activated' ? 'Coached by Jordan Taylor · Week 8 of 20' :
    'Team Program · Partial Autonomy';
  var strip = document.getElementById('tb-coach-strip');
  if (REL_STATE === 'activated') {
    strip.style.display = 'flex';
    strip.textContent = '✅ Jordan Taylor · 20-Wk IM 70.3';
    strip.style.background = 'var(--g1)';
    strip.style.borderColor = 'var(--g2)';
    strip.style.color = 'var(--g)';
  } else if (REL_STATE.startsWith('assigned')) {
    strip.style.display = 'flex';
    strip.textContent = '🏫 Westlake XC · Team Program';
    strip.style.background = 'var(--b1)';
    strip.style.borderColor = 'var(--b2)';
    strip.style.color = 'var(--b)';
  } else {
    strip.style.display = 'none';
  }
  buildSidebar();
}

/* ════════════════════════════════════
   DRILL DOWN (Roster)
════════════════════════════════════ */
function drill(id) {
  var panel = document.getElementById('drill-' + id);
  if (!panel) return;
  var open = panel.classList.contains('open');
  document.querySelectorAll('.drill-panel').forEach(p => p.classList.remove('open'));
  document.querySelectorAll('.arow').forEach(r => r.classList.remove('selected'));
  if (!open) {
    panel.classList.add('open');
    panel.previousElementSibling.classList.add('selected');
    setTimeout(() => panel.scrollIntoView({behavior:'smooth',block:'nearest'}), 50);
  }
}
function closeDrill(id) {
  document.getElementById('drill-' + id)?.classList.remove('open');
  document.querySelectorAll('.arow').forEach(r => r.classList.remove('selected'));
}
function drillTab(btn, sid) {
  var p = btn.closest('.drill-panel');
  p.querySelectorAll('.dtab').forEach(t => t.classList.remove('active'));
  p.querySelectorAll('.dsec').forEach(s => s.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(sid)?.classList.add('active');
}

/* ════════════════════════════════════
   AUTONOMY TOGGLE
════════════════════════════════════ */
function setAuto(btn, level) {
  var toggle = btn.closest('.auto-toggle');
  toggle.querySelectorAll('.at-btn').forEach(b => { b.classList.remove('act-f','act-p','act-o'); });
  if (level==='f') btn.classList.add('act-f');
  else if (level==='p') btn.classList.add('act-p');
  else btn.classList.add('act-o');
}

/* ════════════════════════════════════
   FILTER / SPILL
════════════════════════════════════ */
document.addEventListener('click', e => {
  var bar = e.target.closest('.filter-bar');
  if (bar && e.target.classList.contains('fbtn')) {
    bar.querySelectorAll('.fbtn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
  }
});
function spill(btn) {
  btn.closest('.ledger-tb').querySelectorAll('.spill').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}
function filterLib(btn, type) {
  document.querySelectorAll('.lib-filter').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.wo-card').forEach(card => {
    if (type === 'all' || card.dataset.type === type) {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
}

/* ════════════════════════════════════
   INSIGHTS TABS
════════════════════════════════════ */
function switchInsightTab(btn, tabId) {
  document.querySelectorAll('.itab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.itab-content').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('itab-' + tabId)?.classList.add('active');
}

/* ════════════════════════════════════
   KEY MODAL
════════════════════════════════════ */
function openModal() { document.getElementById('key-modal').classList.add('open'); }
function closeModal() { document.getElementById('key-modal').classList.remove('open'); }
function formatKey(el) {
  var v = el.value.replace(/[^A-Za-z0-9]/g,'').toUpperCase().slice(0,12);
  var out = '';
  for (var i=0;i<v.length;i++) { if(i>0&&i%4===0) out+='—'; out+=v[i]; }
  el.value = out;
}
function activateKey() {
  var val = document.getElementById('key-input').value;
  if (val.length < 4) return;
  REL_STATE = 'activated';
  closeModal();
  renderRelationshipUI();
  showToast('Key activated — Jordan Taylor · 20-Week IM 70.3');
}

/* ════════════════════════════════════
   TOAST
════════════════════════════════════ */
function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

/* ════════════════════════════════════
   PLAN CANVAS
════════════════════════════════════ */
var DAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];

function buildWeeks() {
  var container = document.getElementById('weeks-container');
  if (!container) return;
  container.innerHTML = '';
  planWeeks.forEach(function(wk, wi) {
    var maxLoad = Math.max.apply(null, planWeeks.map(w=>w.load));
    var volPct = Math.round((wk.load / maxLoad) * 100);
    var phaseLabel = wk.phase.charAt(0).toUpperCase() + wk.phase.slice(1);
    var block = document.createElement('div');
    block.className = 'week-block phase-' + wk.phase;
    block.innerHTML = 
      '<div class="week-header">'
        + '<div class="wk-stripe"></div>'
        + '<span class="wk-num">WK ' + wk.num + '</span>'
        + '<span class="wk-phase">' + phaseLabel + '</span>'
        + '<span class="wk-load">' + wk.load + ' TSS</span>'
        + '<div class="wk-vol-bar"><div class="wk-vol-fill" style="width:' + volPct + '%"></div></div>'
        + '<div class="wk-actions">'
          + '<button class="wk-act" onclick="duplicateWeek(' + wi + ')">Duplicate</button>'
          + '<button class="wk-act" onclick="clearWeek(' + wi + ')">Clear</button>'
        + '</div>'
      + '</div>'
      + buildDayGrid(wk, wi);
    container.appendChild(block);
  });
}

function buildDayGrid(wk, wi) {
  var html = '<div class="week-days">';
  DAYS.forEach(function(d) { html += '<div class="day-head">' + d + '</div>'; });
  DAYS.forEach(function(d, di) {
    html += '<div class="day-cell" ondragover="cellDragOver(event)" ondrop="cellDrop(event,' + wi + ',' + di + ')" ondragleave="cellDragLeave(event)">';
    var woId = wk.days[di];
    if (woId && workoutLib[woId]) {
      var wo = workoutLib[woId];
      html += '<div class="placed-wo placed-' + wo.type + '" draggable="true" ondragstart="placedDragStart(event,' + wi + ',' + di + ')" ondragend="libDragEnd(event)">'
        + '<div class="placed-wo-stripe"></div>'
        + '<div class="placed-wo-body">'
          + '<div class="placed-wo-name">' + wo.name + '</div>'
          + '<div class="placed-wo-meta">' + wo.dur + '</div>'
        + '</div>'
        + '<div class="placed-wo-del" onclick="removeWo(' + wi + ',' + di + ')">✕</div>'
      + '</div>';
    } else {
      html += '<div class="empty-drop">—</div>';
    }
    html += '</div>';
  });
  html += '</div>';
  return html;
}

function addWeek() {
  planWeeks.push({num:planWeeks.length+1, phase:'build', load:0, days:[null,null,null,null,null,null,null]});
  buildWeeks();
}
function clearWeek(wi) { planWeeks[wi].days = [null,null,null,null,null,null,null]; buildWeeks(); }
function duplicateWeek(wi) {
  var copy = JSON.parse(JSON.stringify(planWeeks[wi]));
  copy.num = planWeeks.length + 1;
  planWeeks.splice(wi+1, 0, copy);
  // renumber
  planWeeks.forEach((w,i) => w.num = i+1);
  buildWeeks();
}
function removeWo(wi, di) { planWeeks[wi].days[di] = null; buildWeeks(); }

// Drag from library
function libDragStart(e) {
  dragData = {src:'lib', id:e.currentTarget.dataset.id, name:e.currentTarget.dataset.name, type:e.currentTarget.dataset.type};
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'copy';
}
function libDragEnd(e) {
  document.querySelectorAll('.wo-card').forEach(c=>c.classList.remove('dragging'));
  document.querySelectorAll('.placed-wo').forEach(c=>c.classList.remove('dragging'));
}
// Drag placed workout
function placedDragStart(e, wi, di) {
  var woId = planWeeks[wi].days[di];
  dragData = {src:'placed', wi:wi, di:di, id:woId};
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}
function cellDragOver(e) {
  e.preventDefault();
  e.currentTarget.classList.add('drop-target');
  e.dataTransfer.dropEffect = dragData?.src === 'placed' ? 'move' : 'copy';
}
function cellDragLeave(e) { e.currentTarget.classList.remove('drop-target'); }
function cellDrop(e, wi, di) {
  e.preventDefault();
  e.currentTarget.classList.remove('drop-target');
  if (!dragData) return;
  if (dragData.src === 'lib') {
    planWeeks[wi].days[di] = dragData.id;
  } else if (dragData.src === 'placed') {
    var prev = planWeeks[wi].days[di];
    planWeeks[wi].days[di] = dragData.id;
    planWeeks[dragData.wi].days[dragData.di] = prev;
  }
  buildWeeks();
  dragData = null;
}

/* ════════════════════════════════════
   BUILDER PANEL
════════════════════════════════════ */
var blockTypes = {warmup:{cls:'int-warmup',h:55},work:{cls:'int-work',h:88},rest:{cls:'int-rest',h:32},cool:{cls:'int-cool',h:48},hard:{cls:'int-hard',h:100}};

function openBuilder() { 
  document.getElementById('builder-overlay').classList.add('open');
  if (blocks.length === 0) {
    addBlock('warmup'); addBlock('work'); addBlock('work'); addBlock('work'); addBlock('cool');
  }
  renderBlocks();
}
function closeBuilder() { document.getElementById('builder-overlay').classList.remove('open'); }

function addBlock(type) {
  blocks.push({type:type, dur:type==='warmup'||type==='cool'?10:12});
  renderBlocks();
}
function removeSelectedBlock() {
  if (selectedBlock === null) return;
  blocks.splice(selectedBlock, 1);
  selectedBlock = null;
  document.getElementById('int-detail').classList.remove('show');
  renderBlocks();
}
function renderBlocks() {
  var track = document.getElementById('int-track');
  if (!track) return;
  track.innerHTML = '';
  var totalDur = blocks.reduce((s,b)=>s+b.dur,0);
  blocks.forEach(function(b, i) {
    var cfg = blockTypes[b.type] || blockTypes.work;
    var w = Math.max(12, Math.round((b.dur / Math.max(totalDur,1)) * 180));
    var el = document.createElement('div');
    el.className = 'int-block ' + cfg.cls + (selectedBlock===i?' selected':'');
    el.style.cssText = 'width:' + w + 'px;height:' + cfg.h + '%;';
    el.onclick = function() { selectBlock(i); };
    track.appendChild(el);
  });
  // Summary
  var sum = document.getElementById('int-summary');
  if (sum) {
    var types = {};
    blocks.forEach(b=>{ types[b.type]=(types[b.type]||0)+b.dur; });
    sum.innerHTML = '<strong>' + totalDur + ' min total</strong>';
    if (types.work) sum.innerHTML += ' · <strong>' + types.work + '</strong> work';
    if (types.rest) sum.innerHTML += ' · <strong>' + types.rest + '</strong> recovery';
    if (types.hard) sum.innerHTML += ' · <strong>' + types.hard + '</strong> hard';
  }
}
function selectBlock(i) {
  selectedBlock = i;
  var det = document.getElementById('int-detail');
  det.classList.add('show');
  var lbl = document.getElementById('int-det-lbl');
  if (lbl) lbl.textContent = blocks[i].type.charAt(0).toUpperCase()+blocks[i].type.slice(1)+' Block';
  var dur = document.getElementById('tgt-dur');
  if (dur) dur.value = blocks[i].dur;
  renderBlocks();
}
function selectSportOpt(el) {
  document.querySelectorAll('.sport-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
}
function toggleTag(el) {
  el.style.opacity = el.style.opacity === '0.4' ? '1' : '0.4';
}
function saveWorkout() {
  var name = document.getElementById('bp-name').value || 'New Workout';
  closeBuilder();
  blocks = [];
  selectedBlock = null;
  showToast('\'' + name + '\' saved to library');
}


/* ════════════════════════════════════
   INSIGHTS MODULE
════════════════════════════════════ */
var insCurrentDay = 'fri';
var insViewIdx = 0;
var insCmpMode = 'this';
var insScrubIdx = null;
var insExpandedCard = null;

// ── DATA ─────────────────────────────
(function(){
  window.swimData = Array.from({length:50},(_,i)=>({
    time:i*60, dist:i*48,
    pace:95+Math.sin(i*0.4)*4+(i>35?(i-35)*0.5:0)+(Math.random()-.5)*2,
    hr:138+Math.sin(i*0.3)*6+(i>30?(i-30)*0.7:0)+(Math.random()-.5)*3,
    sr:32-(i>38?(i-38)*0.25:0)+Math.sin(i*0.5)*1.2+(Math.random()-.5),
    isLap:i>0&&i%8===0
  }));
  window.runData = Array.from({length:55},(_,i)=>{
    var iv=((i>=15&&i<=20)||(i>=27&&i<=33)||(i>=40&&i<=46));
    return {time:i*60, pace:iv?360+(Math.random()-.5)*10:520+(Math.random()-.5)*15,
      gap:iv?358+(Math.random()-.5)*8:518+(Math.random()-.5)*12,
      hr:iv?168+(Math.random()-.5)*6:138+(Math.random()-.5)*8,
      cad:iv?184+(Math.random()-.5)*4:174+(Math.random()-.5)*4,
      elev:800+Math.sin(i*0.15)*120, isInterval:iv};
  });
  window.bikeData = Array.from({length:90},(_,i)=>({
    time:i*60,
    watts:195+Math.sin(i*0.2)*25+(i>70?-(i-70)*0.8:0)+(Math.random()-.5)*15,
    np:198+Math.sin(i*0.15)*15+(Math.random()-.5)*5,
    hr:148+Math.sin(i*0.1)*8+(i>60?(i-60)*0.3:0)+(Math.random()-.5)*4,
    cad:88+Math.sin(i*0.3)*5+(Math.random()-.5)*3,
    elev:1200+Math.sin(i*0.08)*400
  }));
})();

var insViews = {
  fri:[ {name:'Pace Story',panels:[{key:'pace',label:'Pace/100m',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/100m',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Effort Story',panels:[{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'},{key:'sr',label:'Stroke Rate',color:'#a78bfa',fmt:function(v){return Math.round(v*10)/10+''},unit:'spm'}]},
        {name:'Stroke Check',panels:[{key:'sr',label:'Stroke Rate',color:'#a78bfa',fmt:function(v){return Math.round(v*10)/10+''},unit:'spm'},{key:'pace',label:'Pace/100m',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/100m',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]}],
  mon:[ {name:'Effort Story',panels:[{key:'pace',label:'Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Efficiency',panels:[{key:'sr',label:'Stroke Rate',color:'#a78bfa',fmt:function(v){return Math.round(v*10)/10+''},unit:'spm'},{key:'pace',label:'Pace/100m',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/100m',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]}],
  tue:[ {name:'Effort Story',panels:[{key:'gap',label:'Grade-Adj Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Efficiency',panels:[{key:'cad',label:'Cadence',color:'#a78bfa',fmt:function(v){return Math.round(v)+''},unit:'spm'},{key:'pace',label:'Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Fuel & Form',panels:[{key:'hr',label:'HR Drift',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'},{key:'pace',label:'Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true}]}],
  thu:[ {name:'Effort Story',panels:[{key:'gap',label:'Grade-Adj Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Efficiency',panels:[{key:'cad',label:'Cadence',color:'#a78bfa',fmt:function(v){return Math.round(v)+''},unit:'spm'},{key:'pace',label:'Pace',color:'#60a5fa',fmt:function(v){var s=Math.round(v);return Math.floor(s/60)+':'+(s%60<10?'0':'')+s%60;},unit:'/mi',invert:true},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]}],
  wed:[ {name:'Power Story',panels:[{key:'watts',label:'Power',color:'#a78bfa',fmt:function(v){return Math.round(v)+''},unit:'W'},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'}]},
        {name:'Effort Story',panels:[{key:'np',label:'Norm. Power',color:'#a78bfa',fmt:function(v){return Math.round(v)+''},unit:'W'},{key:'hr',label:'Heart Rate',color:'#f87171',fmt:function(v){return Math.round(v)+''},unit:'bpm'},{key:'elev',label:'Elevation',color:'#34d399',fmt:function(v){return Math.round(v)+''},unit:'ft'}]},
        {name:'Pacing Check',panels:[{key:'watts',label:'Watts',color:'#a78bfa',fmt:function(v){return Math.round(v)+''},unit:'W'},{key:'cad',label:'Cadence',color:'#60a5fa',fmt:function(v){return Math.round(v)+''},unit:'rpm'}]}]
};
var dayLabels = {mon:'Monday Swim · 45 min',tue:'Tuesday Run · 55 min',wed:'Wednesday Bike · 90 min',thu:'Thursday Run · 30 min',fri:'Friday Swim · 50 min · 2,400m',sat:'Saturday Long Run · 1h 45m'};
var dayData = {mon:swimData,tue:runData,wed:bikeData,thu:runData,fri:swimData};

// ── SVG PATH HELPERS ──────────────────
function iMinMax(data, key, pad) {
  var vals = data.map(function(d){return d[key];}).filter(function(v){return !isNaN(v);});
  var mn = Math.min.apply(null,vals), mx = Math.max.apply(null,vals);
  var p = (mx-mn)*((pad||0.1)); return {min:mn-p,max:mx+p};
}
function iSvgPath(data, key, w, h, minY, maxY) {
  var pts = data.map(function(d,i){
    var x=(i/(data.length-1))*w;
    var v=Math.max(minY,Math.min(maxY,d[key]));
    var y=h-((v-minY)/(maxY-minY))*h;
    return {x:x,y:y};
  });
  var d='M '+pts[0].x.toFixed(1)+','+pts[0].y.toFixed(1);
  for(var i=1;i<pts.length;i++){
    var p0=pts[Math.max(0,i-1)],p1=pts[i],p2=pts[Math.min(pts.length-1,i+1)];
    var cpx=p0.x+(p1.x-p0.x)*0.5, cpy=p0.y+(p1.y-p0.y)*0.5;
    d+=' Q'+cpx.toFixed(1)+','+cpy.toFixed(1)+' '+p1.x.toFixed(1)+','+p1.y.toFixed(1);
  }
  return d;
}
function iSvgArea(data, key, w, h, minY, maxY) {
  var line=iSvgPath(data,key,w,h,minY,maxY);
  var last=data.length-1;
  return line+' L'+((last/(last))*w).toFixed(1)+','+h+' L0,'+h+' Z';
}

// ── RENDER WORKOUT CHART ──────────────
function renderWDC() {
  var day=insCurrentDay, data=dayData[day]||swimData;
  var views=insViews[day]||insViews['fri'];
  if(insViewIdx>=views.length) insViewIdx=0;
  var view=views[insViewIdx];

  // Update label
  var lbl=document.getElementById('wdc-label');
  if(lbl) lbl.textContent=dayLabels[day]||'Workout Detail';

  // View chips
  var vc=document.getElementById('view-chips');
  if(vc){
    vc.innerHTML='';
    views.forEach(function(v,i){
      var btn=document.createElement('button');
      btn.className='vchip'+(i===insViewIdx?' active':'');
      btn.textContent=v.name;
      btn.onclick=(function(idx){return function(){insViewIdx=idx;renderWDC();}})(i);
      vc.appendChild(btn);
    });
  }

  // Render panels
  var panels=document.getElementById('wdc-panels');
  if(!panels) return;
  panels.innerHTML='';
  var W=panels.offsetWidth||700;

  view.panels.forEach(function(panel,pi){
    var isFirst=pi===0;
    var H=isFirst?130:90;
    var mm=iMinMax(data,panel.key,0.08);
    var gradId='g'+panel.color.replace('#','')+'_'+pi;

    // Ghost data for compare
    var ghostData=null;
    if(insCmpMode!=='this'){
      var mult=insCmpMode==='best'?0.97:(insCmpMode==='last'?1.02:1.03);
      ghostData=data.map(function(d){var r={};Object.keys(d).forEach(function(k){r[k]=typeof d[k]==='number'?d[k]*mult:d[k];});return r;});
    }

    var svgNS='http://www.w3.org/2000/svg';
    var cpDiv=document.createElement('div');
    cpDiv.className='chart-panel';
    cpDiv.style.paddingTop=isFirst?'0':'8px';
    cpDiv.style.borderTop=isFirst?'none':'1px solid #1e1e1e';

    var header=document.createElement('div');
    header.className='cp-header';
    header.innerHTML='<div class="cp-metric"><div class="cp-dot" style="background:'+panel.color+'"></div><span style="color:#555">'+panel.label+'</span></div>'
      +'<div class="cp-scrub-val" id="sv-'+pi+'" style="color:'+panel.color+';display:none"></div>';
    cpDiv.appendChild(header);

    // SVG
    var svgEl=document.createElementNS(svgNS,'svg');
    svgEl.setAttribute('width','100%');
    svgEl.setAttribute('height',H);
    svgEl.setAttribute('viewBox','0 0 '+W+' '+H);
    svgEl.style.display='block';
    svgEl.style.overflow='visible';

    // Defs / gradient
    var defs=document.createElementNS(svgNS,'defs');
    var grad=document.createElementNS(svgNS,'linearGradient');
    grad.setAttribute('id',gradId);
    grad.setAttribute('x1','0');grad.setAttribute('y1','0');grad.setAttribute('x2','0');grad.setAttribute('y2','1');
    var s1=document.createElementNS(svgNS,'stop');s1.setAttribute('offset','0%');s1.setAttribute('stop-color',panel.color);s1.setAttribute('stop-opacity','0.28');
    var s2=document.createElementNS(svgNS,'stop');s2.setAttribute('offset','100%');s2.setAttribute('stop-color',panel.color);s2.setAttribute('stop-opacity','0.02');
    grad.appendChild(s1);grad.appendChild(s2);defs.appendChild(grad);svgEl.appendChild(defs);

    // Subtle horizontal grid
    [0.25,0.5,0.75].forEach(function(f){
      var line=document.createElementNS(svgNS,'line');
      line.setAttribute('x1','0');line.setAttribute('y1',(H*f).toFixed(1));
      line.setAttribute('x2',W);line.setAttribute('y2',(H*f).toFixed(1));
      line.setAttribute('stroke','#1e1e1e');line.setAttribute('stroke-width','1');
      svgEl.appendChild(line);
    });

    // Ghost line
    if(ghostData){
      var ghostPath=document.createElementNS(svgNS,'path');
      ghostPath.setAttribute('d',iSvgPath(ghostData,panel.key,W,H,mm.min,mm.max));
      ghostPath.setAttribute('stroke',panel.color);ghostPath.setAttribute('stroke-width','1');
      ghostPath.setAttribute('stroke-dasharray','5,4');ghostPath.setAttribute('fill','none');
      ghostPath.setAttribute('opacity','0.4');
      svgEl.appendChild(ghostPath);
    }

    // Area fill
    var areaPath=document.createElementNS(svgNS,'path');
    areaPath.setAttribute('d',iSvgArea(data,panel.key,W,H,mm.min,mm.max));
    areaPath.setAttribute('fill','url(#'+gradId+')');areaPath.setAttribute('stroke','none');
    svgEl.appendChild(areaPath);

    // Line
    var linePath=document.createElementNS(svgNS,'path');
    linePath.setAttribute('d',iSvgPath(data,panel.key,W,H,mm.min,mm.max));
    linePath.setAttribute('stroke',panel.color);linePath.setAttribute('stroke-width','1.5');
    linePath.setAttribute('fill','none');linePath.setAttribute('stroke-linejoin','round');
    svgEl.appendChild(linePath);

    // Lap markers
    data.forEach(function(d,i){
      if(d.isLap||d.isInterval){
        var x=(i/(data.length-1))*W;
        var tick=document.createElementNS(svgNS,'line');
        tick.setAttribute('x1',x.toFixed(1));tick.setAttribute('y1','0');
        tick.setAttribute('x2',x.toFixed(1));tick.setAttribute('y2',H);
        tick.setAttribute('stroke','#2a2a2a');tick.setAttribute('stroke-width','1');tick.setAttribute('stroke-dasharray','2,3');
        svgEl.appendChild(tick);
        if(isFirst&&d.isLap){
          var lapN=Math.round(d.dist/400)||'';
          var txt=document.createElementNS(svgNS,'text');
          txt.setAttribute('x',x.toFixed(1));txt.setAttribute('y',(H-4).toFixed(1));
          txt.setAttribute('fill','#333');txt.setAttribute('font-size','9');txt.setAttribute('text-anchor','middle');
          txt.setAttribute('font-family','DM Mono,monospace');txt.textContent=lapN?'L'+lapN:'';
          svgEl.appendChild(txt);
        }
      }
    });

    // Scrub line + dot (will be updated on hover)
    var scrubLine=document.createElementNS(svgNS,'line');
    scrubLine.setAttribute('x1','-1');scrubLine.setAttribute('y1','0');
    scrubLine.setAttribute('x2','-1');scrubLine.setAttribute('y2',H);
    scrubLine.setAttribute('stroke','rgba(255,255,255,0.3)');scrubLine.setAttribute('stroke-width','1');
    scrubLine.setAttribute('id','scrl-'+pi);
    svgEl.appendChild(scrubLine);

    var scrubDot=document.createElementNS(svgNS,'circle');
    scrubDot.setAttribute('r','4');scrubDot.setAttribute('fill',panel.color);
    scrubDot.setAttribute('id','scrd-'+pi);scrubDot.setAttribute('opacity','0');
    svgEl.appendChild(scrubDot);

    // Mouse overlay
    var overlay=document.createElementNS(svgNS,'rect');
    overlay.setAttribute('x','0');overlay.setAttribute('y','0');
    overlay.setAttribute('width',W);overlay.setAttribute('height',H);
    overlay.setAttribute('fill','transparent');overlay.style.cursor='crosshair';
    (function(panelObj,dataArr,svgW,svgH,mmObj){
      overlay.addEventListener('mousemove',function(e){
        var rect=svgEl.getBoundingClientRect();
        var pct=(e.clientX-rect.left)/rect.width;
        var idx=Math.max(0,Math.min(dataArr.length-1,Math.round(pct*(dataArr.length-1))));
        updateScrub(idx,dataArr,svgW,svgH,mmObj,view.panels);
      });
    })(panel,data,W,H,mm);
    svgEl.appendChild(overlay);

    cpDiv.appendChild(svgEl);
    panels.appendChild(cpDiv);
  });
}

function updateScrub(idx, data, W, H, mm, panels) {
  insScrubIdx=idx;
  var d=data[idx];
  var t=d.time; var mins=Math.floor(t/60); var secs=t%60;
  var timeStr=mins+':'+(secs<10?'0':'')+secs;

  var tt=document.getElementById('scrub-tt');
  var parts=['<span class="scrub-time">'+timeStr+'</span>'];

  panels.forEach(function(panel,pi){
    var raw=d[panel.key];
    if(raw===undefined) return;
    var fmt=panel.fmt?panel.fmt(raw):(Math.round(raw*10)/10)+'';
    parts.push('<span class="scrub-val" style="color:'+panel.color+'">'+panel.label+': <strong>'+fmt+' '+panel.unit+'</strong></span>');
    // Update scrub line + dot
    var x=(idx/(data.length-1))*W;
    var mm2=iMinMax(data,panel.key,0.08);
    var v=Math.max(mm2.min,Math.min(mm2.max,raw));
    var y=H-(pi===0?130:90)-((v-mm2.min)/(mm2.max-mm2.min))*(pi===0?130:90);
    // Just update x for scrub line
    var scrubLine=document.getElementById('scrl-'+pi);
    var scrubDot=document.getElementById('scrd-'+pi);
    var panelH=pi===0?130:90;
    var yPos=panelH-((v-mm2.min)/(mm2.max-mm2.min))*panelH;
    if(scrubLine){scrubLine.setAttribute('x1',x.toFixed(1));scrubLine.setAttribute('x2',x.toFixed(1));scrubLine.setAttribute('y1',0);scrubLine.setAttribute('y2',panelH);}
    if(scrubDot){scrubDot.setAttribute('cx',x.toFixed(1));scrubDot.setAttribute('cy',yPos.toFixed(1));scrubDot.setAttribute('opacity','1');}
    var sv=document.getElementById('sv-'+pi);
    if(sv){sv.textContent=fmt+' '+panel.unit;sv.style.display='block';}
  });
  if(tt) tt.innerHTML=parts.join(' <span style="color:#333">·</span> ');
}

function clearScrub() {
  insScrubIdx=null;
  var tt=document.getElementById('scrub-tt');
  if(tt) tt.innerHTML='Move cursor over chart to explore';
  for(var i=0;i<10;i++){
    var sl=document.getElementById('scrl-'+i);
    var sd=document.getElementById('scrd-'+i);
    var sv=document.getElementById('sv-'+i);
    if(sl)sl.setAttribute('x1','-1');
    if(sd)sd.setAttribute('opacity','0');
    if(sv)sv.style.display='none';
  }
}

function selectDay(day) {
  insCurrentDay=day;
  insViewIdx=0;
  document.querySelectorAll('.day-card').forEach(function(c){c.classList.remove('selected');});
  var el=document.getElementById('day-'+day);
  if(el) el.classList.add('selected');
  renderWDC();
}

function setCmp(btn, mode) {
  insCmpMode=mode;
  document.querySelectorAll('.cchip').forEach(function(c){c.classList.remove('active');});
  btn.classList.add('active');
  renderWDC();
}

// ── INSIGHT CARD CHARTS (SVG) ─────────
function renderInsightCharts() {
  renderSleepChart();
  renderLoadChart();
  renderAerobicChart();
}

function mkSvgEl(tag) { return document.createElementNS('http://www.w3.org/2000/svg',tag); }

function renderSleepChart() {
  var el=document.getElementById('sleep-chart');
  if(!el) return;
  var data=[{d:'Sat',t:7.5,a:7.2},{d:'Sun',t:7.5,a:6.8},{d:'Mon',t:7.5,a:5.9},{d:'Tue',t:7.5,a:6.4},{d:'Wed',t:7.5,a:7.1},{d:'Thu',t:7.5,a:6.2},{d:'Today',t:7.5,a:null}];
  var W=el.offsetWidth||380, H=80, n=data.length, bw=Math.floor(W/n)-8, gap=8;
  var maxV=8;
  var svg=mkSvgEl('svg');
  svg.setAttribute('width','100%');svg.setAttribute('height',H+24);svg.setAttribute('viewBox','0 0 '+W+' '+(H+24));
  data.forEach(function(d,i){
    var x=i*(bw+gap)+(gap/2);
    // Target bar
    var th=Math.round((d.t/maxV)*H);
    var tr=mkSvgEl('rect');tr.setAttribute('x',x);tr.setAttribute('y',H-th);tr.setAttribute('width',bw);tr.setAttribute('height',th);tr.setAttribute('fill','#222');tr.setAttribute('rx','3');
    svg.appendChild(tr);
    // Actual bar
    if(d.a!==null){
      var ah=Math.round((d.a/maxV)*H);
      var ar=mkSvgEl('rect');ar.setAttribute('x',x+2);ar.setAttribute('y',H-ah);ar.setAttribute('width',bw-4);ar.setAttribute('height',ah);ar.setAttribute('fill','#ef4444');ar.setAttribute('rx','2');
      svg.appendChild(ar);
    }
    var lbl=mkSvgEl('text');lbl.setAttribute('x',x+bw/2);lbl.setAttribute('y',H+14);lbl.setAttribute('fill','#555');lbl.setAttribute('font-size','9');lbl.setAttribute('text-anchor','middle');lbl.setAttribute('font-family','DM Mono,monospace');lbl.textContent=d.d;
    svg.appendChild(lbl);
  });
  el.innerHTML='';el.appendChild(svg);
}

function renderLoadChart() {
  var el=document.getElementById('load-chart');
  if(!el) return;
  var data=[{w:'4w ago',avg:298,cur:310},{w:'3w ago',avg:305,cur:325},{w:'2w ago',avg:308,cur:298},{w:'Last wk',avg:318,cur:340},{w:'This wk',avg:320,cur:408}];
  var W=el.offsetWidth||380, H=80, n=data.length, bw=Math.floor(W/n)-12;
  var maxV=450;
  var svg=mkSvgEl('svg');svg.setAttribute('width','100%');svg.setAttribute('height',H+24);svg.setAttribute('viewBox','0 0 '+W+' '+(H+24));
  // Reference line
  var ry=H-Math.round((320/maxV)*H);
  var rl=mkSvgEl('line');rl.setAttribute('x1','0');rl.setAttribute('y1',ry);rl.setAttribute('x2',W);rl.setAttribute('y2',ry);rl.setAttribute('stroke','#f59e0b');rl.setAttribute('stroke-width','1');rl.setAttribute('stroke-dasharray','4,3');rl.setAttribute('opacity','0.5');
  svg.appendChild(rl);
  data.forEach(function(d,i){
    var x=i*(bw+12)+6;
    var ah=Math.round((d.avg/maxV)*H);
    var ch=Math.round((d.cur/maxV)*H);
    var ar=mkSvgEl('rect');ar.setAttribute('x',x);ar.setAttribute('y',H-ah);ar.setAttribute('width',bw/2-1);ar.setAttribute('height',ah);ar.setAttribute('fill','#2a2a2a');ar.setAttribute('rx','2');
    svg.appendChild(ar);
    var cr=mkSvgEl('rect');cr.setAttribute('x',x+bw/2+1);cr.setAttribute('y',H-ch);cr.setAttribute('width',bw/2-2);cr.setAttribute('height',ch);cr.setAttribute('fill',i===4?'#f59e0b':'#555');cr.setAttribute('rx','2');
    svg.appendChild(cr);
    if(i===4){
      var lbadge=mkSvgEl('text');lbadge.setAttribute('x',x+bw/2+1+(bw/2-2)/2);lbadge.setAttribute('y',H-ch-4);lbadge.setAttribute('fill','#f59e0b');lbadge.setAttribute('font-size','8');lbadge.setAttribute('text-anchor','middle');lbadge.setAttribute('font-family','DM Mono,monospace');lbadge.textContent='+28%';
      svg.appendChild(lbadge);
    }
    var lbl=mkSvgEl('text');lbl.setAttribute('x',x+bw/2);lbl.setAttribute('y',H+14);lbl.setAttribute('fill','#555');lbl.setAttribute('font-size','9');lbl.setAttribute('text-anchor','middle');lbl.setAttribute('font-family','DM Mono,monospace');lbl.textContent=d.w;
    svg.appendChild(lbl);
  });
  el.innerHTML='';el.appendChild(svg);
}

function renderAerobicChart() {
  var el=document.getElementById('aerobic-chart');
  if(!el) return;
  var data=[{w:'6w',pace:548,hr:142},{w:'5w',pace:544,hr:141},{w:'4w',pace:541,hr:140},{w:'3w',pace:538,hr:142},{w:'2w',pace:534,hr:140},{w:'Last',pace:530,hr:141}];
  var W=el.offsetWidth||380, H=55;
  var paceMin=526,paceMax=552, hrMin=138,hrMax=145;
  var svg=mkSvgEl('svg');svg.setAttribute('width','100%');svg.setAttribute('height',H*2+16);svg.setAttribute('viewBox','0 0 '+W+' '+(H*2+16));

  // Pace panel (invert: lower=faster=better)
  ['pace','hr'].forEach(function(key,pi){
    var color=pi===0?'#34d399':'#f87171';
    var min=pi===0?paceMin:hrMin, max=pi===0?paceMax:hrMax;
    var pts=data.map(function(d,i){return {x:(i/(data.length-1))*W,y:pi*H+8+H-((d[key]-min)/(max-min))*H};});
    // Invert pace (lower is better)
    if(pi===0) pts=data.map(function(d,i){return {x:(i/(data.length-1))*W,y:pi*H+8+((d[key]-min)/(max-min))*H};});

    var gradId='ag'+pi;
    var defs=mkSvgEl('defs');
    var grad=mkSvgEl('linearGradient');grad.setAttribute('id',gradId);grad.setAttribute('x1','0');grad.setAttribute('y1','0');grad.setAttribute('x2','0');grad.setAttribute('y2','1');
    var s1=mkSvgEl('stop');s1.setAttribute('offset','0%');s1.setAttribute('stop-color',color);s1.setAttribute('stop-opacity','0.25');
    var s2=mkSvgEl('stop');s2.setAttribute('offset','100%');s2.setAttribute('stop-color',color);s2.setAttribute('stop-opacity','0.02');
    grad.appendChild(s1);grad.appendChild(s2);defs.appendChild(grad);svg.appendChild(defs);

    var areaD='M '+pts[0].x.toFixed(1)+','+pts[0].y.toFixed(1);
    pts.slice(1).forEach(function(p){areaD+=' L'+p.x.toFixed(1)+','+p.y.toFixed(1);});
    var baseY=(pi===0?0:H)+8+H;
    areaD+=' L'+W+','+baseY+' L0,'+baseY+' Z';
    var areaEl=mkSvgEl('path');areaEl.setAttribute('d',areaD);areaEl.setAttribute('fill','url(#'+gradId+')');areaEl.setAttribute('stroke','none');
    svg.appendChild(areaEl);

    var lineD='M '+pts[0].x.toFixed(1)+','+pts[0].y.toFixed(1);
    pts.slice(1).forEach(function(p){lineD+=' L'+p.x.toFixed(1)+','+p.y.toFixed(1);});
    var lineEl=mkSvgEl('path');lineEl.setAttribute('d',lineD);lineEl.setAttribute('stroke',color);lineEl.setAttribute('stroke-width','2');lineEl.setAttribute('fill','none');lineEl.setAttribute('stroke-linejoin','round');
    svg.appendChild(lineEl);

    // Labels
    data.forEach(function(d,i){
      var p=pts[i];
      var dot=mkSvgEl('circle');dot.setAttribute('cx',p.x.toFixed(1));dot.setAttribute('cy',p.y.toFixed(1));dot.setAttribute('r','3');dot.setAttribute('fill',color);dot.setAttribute('opacity','0.8');
      svg.appendChild(dot);
    });

    // Metric label
    var mlbl=mkSvgEl('text');mlbl.setAttribute('x','4');mlbl.setAttribute('y',(pi*H+17).toFixed(1));mlbl.setAttribute('fill',color);mlbl.setAttribute('font-size','9');mlbl.setAttribute('font-family','DM Mono,monospace');mlbl.setAttribute('letter-spacing','0.08em');
    mlbl.textContent=pi===0?'PACE':'HEART RATE';
    svg.appendChild(mlbl);
  });

  // Week labels
  data.forEach(function(d,i){
    var x=(i/(data.length-1))*W;
    var lbl=mkSvgEl('text');lbl.setAttribute('x',x.toFixed(1));lbl.setAttribute('y',(H*2+14).toFixed(1));lbl.setAttribute('fill','#555');lbl.setAttribute('font-size','9');lbl.setAttribute('text-anchor','middle');lbl.setAttribute('font-family','DM Mono,monospace');lbl.textContent=d.w;
    svg.appendChild(lbl);
  });

  el.innerHTML='';el.appendChild(svg);
}

function toggleCard(id) {
  var body=document.getElementById('ic-expand-'+id);
  if(!body) return;
  var isOpen=body.classList.contains('open');
  if(isOpen){
    body.classList.remove('open');
    var btns=body.closest('.insight-card').querySelectorAll('.ic-expand');
    btns.forEach(function(b){b.textContent='Show me why →';});
  } else {
    body.classList.add('open');
    var btns=body.closest('.insight-card').querySelectorAll('.ic-expand');
    btns.forEach(function(b){b.textContent='Show less';});
    setTimeout(renderInsightCharts,50);
  }
}

// ── RING ANIMATION ─────────────────────
function animateRings() {
  var C=2*Math.PI*54; // circumference for r=54
  // Body ring: 62/100
  setTimeout(function(){
    var r=document.getElementById('ring-body');
    if(r) r.style.strokeDashoffset=(C*(1-0.62)).toFixed(1);
  },100);
  // Consistency ring: 4/5
  setTimeout(function(){
    var r=document.getElementById('ring-cons');
    if(r) r.style.strokeDashoffset=(C*(1-0.8)).toFixed(1);
  },300);
  // Load bar
  setTimeout(function(){
    var b=document.getElementById('load-bar-fill');
    if(b){b.style.width='56%';}  // 28% of right half = 56% of right-half bar
  },200);
}

// ── SHOW/HIDE BASED ON MODE ────────────
function showInsightsForMode() {
  var ath=document.getElementById('insights-athlete');
  var coach=document.getElementById('insights-coach');
  if(!ath||!coach) return;
  if(currentMode==='coach'){
    ath.style.display='none'; coach.style.display='block';
  } else {
    ath.style.display='block'; coach.style.display='none';
    setTimeout(function(){
      animateRings();
      renderWDC();
    },50);
  }
}



/* ════════════════════════════════════
   PERFORMANCE SCREEN — CHARTS
════════════════════════════════════ */
var perfDay = 'fri';
var perfViewIdx = 0;
var perfCmpMode = 'this';

function perfAnimateRings() {
  var C = 2 * Math.PI * 54;
  setTimeout(function(){ var r=document.getElementById('perf-ring-body'); if(r) r.style.strokeDashoffset=(C*(1-0.62)).toFixed(1); }, 80);
  setTimeout(function(){ var r=document.getElementById('perf-ring-cons'); if(r) r.style.strokeDashoffset=(C*(1-0.80)).toFixed(1); }, 280);
  setTimeout(function(){ var b=document.getElementById('perf-load-bar'); if(b) b.style.width='56%'; }, 160);
}

function perfSelectDay(day) {
  perfDay = day;
  perfViewIdx = 0;
  document.querySelectorAll('#perf-week-strip .day-card').forEach(function(c){ c.classList.remove('selected'); });
  var el = document.getElementById('perf-day-' + day);
  if (el) el.classList.add('selected');
  perfRenderWDC();
}

function perfSetCmp(btn, mode) {
  perfCmpMode = mode;
  document.querySelectorAll('.compare-chips .cchip').forEach(function(c){ c.classList.remove('active'); });
  btn.classList.add('active');
  perfRenderWDC();
}

function perfRenderWDC() {
  var day = perfDay;
  var data = dayData[day] || swimData;
  var views = insViews[day] || insViews['fri'];
  if (perfViewIdx >= views.length) perfViewIdx = 0;
  var view = views[perfViewIdx];

  var lbl = document.getElementById('perf-wdc-label');
  if (lbl) lbl.textContent = dayLabels[day] || 'Workout Detail';

  // View chips
  var vc = document.getElementById('perf-view-chips');
  if (vc) {
    vc.innerHTML = '';
    views.forEach(function(v, i) {
      var btn = document.createElement('button');
      btn.className = 'vchip' + (i === perfViewIdx ? ' active' : '');
      btn.textContent = v.name;
      btn.onclick = (function(idx){ return function(){ perfViewIdx = idx; perfRenderWDC(); }; })(i);
      vc.appendChild(btn);
    });
  }

  var panels = document.getElementById('perf-wdc-panels');
  if (!panels) return;
  panels.innerHTML = '';
  var W = panels.offsetWidth || 700;

  view.panels.forEach(function(panel, pi) {
    var isFirst = pi === 0;
    var H = isFirst ? 130 : 90;
    var mm = iMinMax(data, panel.key, 0.08);
    var gradId = 'pg' + panel.color.replace('#','') + '_' + pi;

    var ghostData = null;
    if (perfCmpMode !== 'this') {
      var mult = perfCmpMode==='best'?0.97:(perfCmpMode==='last'?1.02:1.03);
      ghostData = data.map(function(d){ var r={}; Object.keys(d).forEach(function(k){ r[k]=typeof d[k]==='number'?d[k]*mult:d[k]; }); return r; });
    }

    var svgNS = 'http://www.w3.org/2000/svg';
    var cpDiv = document.createElement('div');
    cpDiv.className = 'chart-panel';
    cpDiv.style.paddingTop = isFirst ? '0' : '8px';
    cpDiv.style.borderTop = isFirst ? 'none' : '1px solid #1e1e1e';

    var header = document.createElement('div');
    header.className = 'cp-header';
    header.innerHTML = '<div class="cp-metric"><div class="cp-dot" style="background:'+panel.color+'"></div><span style="color:#555">'+panel.label+'</span></div>'
      + '<div class="cp-scrub-val" id="psv-'+pi+'" style="color:'+panel.color+';display:none"></div>';
    cpDiv.appendChild(header);

    var svgEl = document.createElementNS(svgNS,'svg');
    svgEl.setAttribute('width','100%'); svgEl.setAttribute('height',H);
    svgEl.setAttribute('viewBox','0 0 '+W+' '+H);
    svgEl.style.display='block'; svgEl.style.overflow='visible';

    var defs = document.createElementNS(svgNS,'defs');
    var grad = document.createElementNS(svgNS,'linearGradient');
    grad.setAttribute('id',gradId); grad.setAttribute('x1','0'); grad.setAttribute('y1','0'); grad.setAttribute('x2','0'); grad.setAttribute('y2','1');
    var s1=document.createElementNS(svgNS,'stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color',panel.color); s1.setAttribute('stop-opacity','0.28');
    var s2=document.createElementNS(svgNS,'stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color',panel.color); s2.setAttribute('stop-opacity','0.02');
    grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad); svgEl.appendChild(defs);

    [0.25,0.5,0.75].forEach(function(f){
      var line=document.createElementNS(svgNS,'line');
      line.setAttribute('x1','0'); line.setAttribute('y1',(H*f).toFixed(1));
      line.setAttribute('x2',W); line.setAttribute('y2',(H*f).toFixed(1));
      line.setAttribute('stroke','#1e1e1e'); line.setAttribute('stroke-width','1');
      svgEl.appendChild(line);
    });

    if (ghostData) {
      var gp = document.createElementNS(svgNS,'path');
      gp.setAttribute('d', iSvgPath(ghostData,panel.key,W,H,mm.min,mm.max));
      gp.setAttribute('stroke',panel.color); gp.setAttribute('stroke-width','1');
      gp.setAttribute('stroke-dasharray','5,4'); gp.setAttribute('fill','none'); gp.setAttribute('opacity','0.4');
      svgEl.appendChild(gp);
    }

    var areaPath = document.createElementNS(svgNS,'path');
    areaPath.setAttribute('d', iSvgArea(data,panel.key,W,H,mm.min,mm.max));
    areaPath.setAttribute('fill','url(#'+gradId+')'); areaPath.setAttribute('stroke','none');
    svgEl.appendChild(areaPath);

    var linePath = document.createElementNS(svgNS,'path');
    linePath.setAttribute('d', iSvgPath(data,panel.key,W,H,mm.min,mm.max));
    linePath.setAttribute('stroke',panel.color); linePath.setAttribute('stroke-width','1.5');
    linePath.setAttribute('fill','none'); linePath.setAttribute('stroke-linejoin','round');
    svgEl.appendChild(linePath);

    data.forEach(function(d,i){
      if (d.isLap || d.isInterval) {
        var x=(i/(data.length-1))*W;
        var tick=document.createElementNS(svgNS,'line');
        tick.setAttribute('x1',x.toFixed(1)); tick.setAttribute('y1','0');
        tick.setAttribute('x2',x.toFixed(1)); tick.setAttribute('y2',H);
        tick.setAttribute('stroke','#2a2a2a'); tick.setAttribute('stroke-width','1'); tick.setAttribute('stroke-dasharray','2,3');
        svgEl.appendChild(tick);
      }
    });

    var scrubLine = document.createElementNS(svgNS,'line');
    scrubLine.setAttribute('x1','-1'); scrubLine.setAttribute('y1','0');
    scrubLine.setAttribute('x2','-1'); scrubLine.setAttribute('y2',H);
    scrubLine.setAttribute('stroke','rgba(255,255,255,0.3)'); scrubLine.setAttribute('stroke-width','1');
    scrubLine.setAttribute('id','pscrl-'+pi);
    svgEl.appendChild(scrubLine);

    var scrubDot = document.createElementNS(svgNS,'circle');
    scrubDot.setAttribute('r','4'); scrubDot.setAttribute('fill',panel.color);
    scrubDot.setAttribute('id','pscrd-'+pi); scrubDot.setAttribute('opacity','0');
    svgEl.appendChild(scrubDot);

    var overlay = document.createElementNS(svgNS,'rect');
    overlay.setAttribute('x','0'); overlay.setAttribute('y','0');
    overlay.setAttribute('width',W); overlay.setAttribute('height',H);
    overlay.setAttribute('fill','transparent'); overlay.style.cursor='crosshair';
    (function(pnl, dataArr, svgW, svgH){
      overlay.addEventListener('mousemove', function(e){
        var rect=svgEl.getBoundingClientRect();
        var pct=(e.clientX-rect.left)/rect.width;
        var idx=Math.max(0,Math.min(dataArr.length-1,Math.round(pct*(dataArr.length-1))));
        perfUpdateScrub(idx, dataArr, svgW, view.panels);
      });
    })(panel, data, W, H);
    svgEl.appendChild(overlay);

    cpDiv.appendChild(svgEl);
    panels.appendChild(cpDiv);
  });
}

function perfUpdateScrub(idx, data, W, panels) {
  var d = data[idx];
  var t = d.time; var mins=Math.floor(t/60); var secs=t%60;
  var timeStr = mins+':'+(secs<10?'0':'')+secs;

  var tt = document.getElementById('perf-scrub-tt');
  var parts = ['<span class="scrub-time">'+timeStr+'</span>'];

  panels.forEach(function(panel, pi) {
    var raw = d[panel.key];
    if (raw === undefined) return;
    var fmt = panel.fmt ? panel.fmt(raw) : (Math.round(raw*10)/10)+'';
    parts.push('<span class="scrub-val" style="color:'+panel.color+'">'+panel.label+': <strong>'+fmt+' '+panel.unit+'</strong></span>');
    var H = pi===0 ? 130 : 90;
    var mm2 = iMinMax(data,panel.key,0.08);
    var v = Math.max(mm2.min,Math.min(mm2.max,raw));
    var yPos = H - ((v-mm2.min)/(mm2.max-mm2.min))*H;
    var x = (idx/(data.length-1))*W;
    var sl=document.getElementById('pscrl-'+pi);
    var sd=document.getElementById('pscrd-'+pi);
    if(sl){sl.setAttribute('x1',x.toFixed(1));sl.setAttribute('x2',x.toFixed(1));sl.setAttribute('y1',0);sl.setAttribute('y2',H);}
    if(sd){sd.setAttribute('cx',x.toFixed(1));sd.setAttribute('cy',yPos.toFixed(1));sd.setAttribute('opacity','1');}
    var sv=document.getElementById('psv-'+pi); if(sv){sv.textContent=fmt+' '+panel.unit; sv.style.display='block';}
  });
  if (tt) tt.innerHTML = parts.join(' <span style="color:#333">·</span> ');
}

function perfClearScrub() {
  var tt = document.getElementById('perf-scrub-tt');
  if (tt) tt.innerHTML = 'Move cursor over chart to explore';
  for (var i=0;i<10;i++){
    var sl=document.getElementById('pscrl-'+i); var sd=document.getElementById('pscrd-'+i); var sv=document.getElementById('psv-'+i);
    if(sl)sl.setAttribute('x1','-1'); if(sd)sd.setAttribute('opacity','0'); if(sv)sv.style.display='none';
  }
}

/* Intelligence Screen Chart toggle */
function perfToggleCard(id) {
  var body = document.getElementById('perf-ic-' + id);
  if (!body) return;
  var isOpen = body.classList.contains('open');
  body.classList.toggle('open');
  var card = body.closest('.insight-card');
  if (card) {
    card.querySelectorAll('.ic-expand').forEach(function(b){ b.textContent = isOpen ? 'Show me why →' : 'Show less'; });
  }
  if (!isOpen) {
    setTimeout(function(){
      renderIntelCharts(id);
    }, 60);
  }
}

function renderIntelCharts(id) {
  if (id === 'sleep') renderChartInEl(document.getElementById('intel-sleep-chart'), 'sleep');
  else if (id === 'load') renderChartInEl(document.getElementById('intel-load-chart'), 'load');
  else if (id === 'aerobic') renderChartInEl(document.getElementById('intel-aerobic-chart'), 'aerobic');
}

function renderChartInEl(el, type) {
  if (!el) return;
  var svgNS = 'http://www.w3.org/2000/svg';

  if (type === 'sleep') {
    var data=[{d:'Sat',t:7.5,a:7.2},{d:'Sun',t:7.5,a:6.8},{d:'Mon',t:7.5,a:5.9},{d:'Tue',t:7.5,a:6.4},{d:'Wed',t:7.5,a:7.1},{d:'Thu',t:7.5,a:6.2},{d:'Today',t:7.5,a:null}];
    var W=el.offsetWidth||360, H=72, n=data.length, bw=Math.floor(W/n)-8;
    var svg=document.createElementNS(svgNS,'svg'); svg.setAttribute('width','100%'); svg.setAttribute('height',H+20); svg.setAttribute('viewBox','0 0 '+W+' '+(H+20));
    data.forEach(function(d,i){
      var x=i*(bw+8)+4;
      var th=Math.round((d.t/8)*H);
      var tr=document.createElementNS(svgNS,'rect'); tr.setAttribute('x',x); tr.setAttribute('y',H-th); tr.setAttribute('width',bw); tr.setAttribute('height',th); tr.setAttribute('fill','#222'); tr.setAttribute('rx','3'); svg.appendChild(tr);
      if(d.a!==null){var ah=Math.round((d.a/8)*H); var ar=document.createElementNS(svgNS,'rect'); ar.setAttribute('x',x+2); ar.setAttribute('y',H-ah); ar.setAttribute('width',bw-4); ar.setAttribute('height',ah); ar.setAttribute('fill','#ef4444'); ar.setAttribute('rx','2'); svg.appendChild(ar);}
      var lbl=document.createElementNS(svgNS,'text'); lbl.setAttribute('x',x+bw/2); lbl.setAttribute('y',H+13); lbl.setAttribute('fill','#555'); lbl.setAttribute('font-size','9'); lbl.setAttribute('text-anchor','middle'); lbl.setAttribute('font-family','DM Mono,monospace'); lbl.textContent=d.d; svg.appendChild(lbl);
    });
    el.innerHTML=''; el.appendChild(svg);

  } else if (type === 'load') {
    var data=[{w:'4w ago',avg:298,cur:310},{w:'3w ago',avg:305,cur:325},{w:'2w ago',avg:308,cur:298},{w:'Last wk',avg:318,cur:340},{w:'This wk',avg:320,cur:408}];
    var W=el.offsetWidth||360, H=72, bw=Math.floor(W/data.length)-12;
    var svg=document.createElementNS(svgNS,'svg'); svg.setAttribute('width','100%'); svg.setAttribute('height',H+20); svg.setAttribute('viewBox','0 0 '+W+' '+(H+20));
    var rl=document.createElementNS(svgNS,'line'); rl.setAttribute('x1','0'); rl.setAttribute('y1',H-Math.round((320/450)*H)); rl.setAttribute('x2',W); rl.setAttribute('y2',H-Math.round((320/450)*H)); rl.setAttribute('stroke','#f59e0b'); rl.setAttribute('stroke-width','1'); rl.setAttribute('stroke-dasharray','4,3'); rl.setAttribute('opacity','0.5'); svg.appendChild(rl);
    data.forEach(function(d,i){
      var x=i*(bw+12)+6;
      var ah=Math.round((d.avg/450)*H); var ch=Math.round((d.cur/450)*H);
      var ar=document.createElementNS(svgNS,'rect'); ar.setAttribute('x',x); ar.setAttribute('y',H-ah); ar.setAttribute('width',bw/2-1); ar.setAttribute('height',ah); ar.setAttribute('fill','#2a2a2a'); ar.setAttribute('rx','2'); svg.appendChild(ar);
      var cr=document.createElementNS(svgNS,'rect'); cr.setAttribute('x',x+bw/2+1); cr.setAttribute('y',H-ch); cr.setAttribute('width',bw/2-2); cr.setAttribute('height',ch); cr.setAttribute('fill',i===4?'#f59e0b':'#555'); cr.setAttribute('rx','2'); svg.appendChild(cr);
      if(i===4){var badge=document.createElementNS(svgNS,'text'); badge.setAttribute('x',x+bw/2+1+(bw/2-2)/2); badge.setAttribute('y',H-ch-4); badge.setAttribute('fill','#f59e0b'); badge.setAttribute('font-size','8'); badge.setAttribute('text-anchor','middle'); badge.setAttribute('font-family','DM Mono,monospace'); badge.textContent='+28%'; svg.appendChild(badge);}
      var lbl=document.createElementNS(svgNS,'text'); lbl.setAttribute('x',x+bw/2); lbl.setAttribute('y',H+13); lbl.setAttribute('fill','#555'); lbl.setAttribute('font-size','9'); lbl.setAttribute('text-anchor','middle'); lbl.setAttribute('font-family','DM Mono,monospace'); lbl.textContent=d.w; svg.appendChild(lbl);
    });
    el.innerHTML=''; el.appendChild(svg);

  } else if (type === 'aerobic') {
    var data=[{w:'6w',pace:548,hr:142},{w:'5w',pace:544,hr:141},{w:'4w',pace:541,hr:140},{w:'3w',pace:538,hr:142},{w:'2w',pace:534,hr:140},{w:'Last',pace:530,hr:141}];
    var W=el.offsetWidth||360, H=48;
    var svg=document.createElementNS(svgNS,'svg'); svg.setAttribute('width','100%'); svg.setAttribute('height',H*2+16); svg.setAttribute('viewBox','0 0 '+W+' '+(H*2+16));
    ['pace','hr'].forEach(function(key,pi){
      var color=pi===0?'#34d399':'#f87171';
      var min=pi===0?526:138, max=pi===0?552:145;
      var pts=data.map(function(d,i){ var x=(i/(data.length-1))*W; var frac=(d[key]-min)/(max-min); var y=pi===0?(pi*H+6+frac*H):(pi*H+6+H-frac*H); return {x:x,y:y}; });
      var gradId='aig'+pi; var defs=document.createElementNS(svgNS,'defs'); var grad=document.createElementNS(svgNS,'linearGradient'); grad.setAttribute('id',gradId); grad.setAttribute('x1','0'); grad.setAttribute('y1','0'); grad.setAttribute('x2','0'); grad.setAttribute('y2','1');
      var s1=document.createElementNS(svgNS,'stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color',color); s1.setAttribute('stop-opacity','0.25');
      var s2=document.createElementNS(svgNS,'stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color',color); s2.setAttribute('stop-opacity','0.02');
      grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad); svg.appendChild(defs);
      var lineD='M '+pts[0].x.toFixed(1)+','+pts[0].y.toFixed(1); pts.slice(1).forEach(function(p){lineD+=' L'+p.x.toFixed(1)+','+p.y.toFixed(1);});
      var lineEl=document.createElementNS(svgNS,'path'); lineEl.setAttribute('d',lineD); lineEl.setAttribute('stroke',color); lineEl.setAttribute('stroke-width','2'); lineEl.setAttribute('fill','none'); lineEl.setAttribute('stroke-linejoin','round'); svg.appendChild(lineEl);
      pts.forEach(function(p){ var dot=document.createElementNS(svgNS,'circle'); dot.setAttribute('cx',p.x.toFixed(1)); dot.setAttribute('cy',p.y.toFixed(1)); dot.setAttribute('r','3'); dot.setAttribute('fill',color); dot.setAttribute('opacity','0.8'); svg.appendChild(dot); });
      var mlbl=document.createElementNS(svgNS,'text'); mlbl.setAttribute('x','4'); mlbl.setAttribute('y',(pi*H+15).toFixed(1)); mlbl.setAttribute('fill',color); mlbl.setAttribute('font-size','9'); mlbl.setAttribute('font-family','DM Mono,monospace'); mlbl.textContent=pi===0?'PACE (improving →)':'HEART RATE (stable →)'; svg.appendChild(mlbl);
    });
    data.forEach(function(d,i){ var x=(i/(data.length-1))*W; var lbl=document.createElementNS(svgNS,'text'); lbl.setAttribute('x',x.toFixed(1)); lbl.setAttribute('y',(H*2+13).toFixed(1)); lbl.setAttribute('fill','#555'); lbl.setAttribute('font-size','9'); lbl.setAttribute('text-anchor','middle'); lbl.setAttribute('font-family','DM Mono,monospace'); lbl.textContent=d.w; svg.appendChild(lbl); });
    el.innerHTML=''; el.appendChild(svg);
  }
}



/* ════════════════════════════════════
   COACH CHARTS (insights-charts screen)
════════════════════════════════════ */
var coachDay = 'fri';
var coachViewIdx = 0;
var coachCmpMode = 'this';
var coachSelectedAth = 'Marcus Reid';

var coachAthleteData = {
  'Marcus Reid': {
    avi: 'MR', bg: 'var(--g1)', color: 'var(--g)',
    status: 'Week 8 of 20 · Ironman 70.3 · Readiness: 82',
    readiness: 82, fitness: 72, fatigue: 61,
    days: {mon:'🏊',tue:'🏃',wed:'🚴',thu:'🏃',fri:'🏊'},
    data: {mon:'swim',tue:'run',wed:'bike',thu:'run',fri:'swim'}
  },
  'Sarah Chen': {
    avi: 'SC', bg: 'var(--r1)', color: 'var(--r)',
    status: 'Week 6 of 20 · Boston Marathon Prep · Readiness: 38 ⚠',
    readiness: 38, fitness: 65, fatigue: 87,
    days: {mon:'🏃',tue:'🏃',wed:'🏊',thu:'🏃',fri:'🏊'},
    data: {mon:'run',tue:'run',wed:'swim',thu:'run',fri:'swim'}
  },
  'Derek Osei': {
    avi: 'DO', bg: 'var(--a1)', color: 'var(--a)',
    status: 'Week 2 of 12 · Olympic Tri · Readiness: 54',
    readiness: 54, fitness: 48, fatigue: 52,
    days: {mon:null,tue:'🏃',wed:'🚴',thu:null,fri:'🏃'},
    data: {mon:null,tue:'run',wed:'bike',thu:null,fri:'run'}
  },
  'Aisha Lawson': {
    avi: 'AL', bg: 'var(--b1)', color: 'var(--b)',
    status: 'Week 5 of 18 · NYC Marathon · Readiness: 79',
    readiness: 79, fitness: 68, fatigue: 58,
    days: {mon:'🏃',tue:'🚴',wed:'🏃',thu:'🏊',fri:'🏃'},
    data: {mon:'run',tue:'bike',wed:'run',thu:'swim',fri:'run'}
  }
};

function coachSelectAth(btn, name, defaultDay, defaultSport) {
  coachSelectedAth = name;
  coachDay = defaultDay || 'fri';
  coachViewIdx = 0;

  // Update filter buttons
  document.querySelectorAll('#coach-ath-filters .lib-filter').forEach(function(b){ b.classList.remove('active'); });
  if (btn) btn.classList.add('active');

  var ath = coachAthleteData[name];
  if (!ath) return;

  // Update status strip
  var avi = document.getElementById('coach-ath-avi');
  if (avi) { avi.textContent = ath.avi; avi.style.background = ath.bg; avi.style.color = ath.color; }
  var nameEl = document.getElementById('coach-ath-name-lbl');
  if (nameEl) nameEl.textContent = name;
  var statEl = document.getElementById('coach-ath-status-txt');
  if (statEl) statEl.textContent = ath.status;

  // Update week strip
  var days = ['mon','tue','wed','thu','fri','sat','sun'];
  days.forEach(function(d) {
    var el = document.getElementById('coachday-' + d);
    if (!el) return;
    el.classList.remove('selected','today');
    if (d === coachDay) el.classList.add('selected');
    var dot = el.querySelector('.day-dot');
    var sport = el.querySelector('.day-sport');
    var durEl = el.querySelector('.day-dur');
    if (!dot) return;
    var emoji = ath.days ? ath.days[d] : null;
    if (emoji) {
      var sportType = ath.data ? ath.data[d] : 'swim';
      var colors = {swim:'#60a5fa',run:'#f87171',bike:'#a78bfa'};
      dot.className = 'day-dot done';
      dot.style.cssText = 'background:'+colors[sportType]+';color:#fff;font-size:11px';
      dot.textContent = emoji;
      if (sport) sport.textContent = sportType.charAt(0).toUpperCase()+sportType.slice(1);
      if (durEl) durEl.textContent = sportType==='bike'?'90m mod':sportType==='swim'?'50m easy':'45m easy';
    } else {
      dot.className = 'day-dot rest-dot';
      dot.style.cssText = '';
      dot.textContent = '';
      if (sport) sport.textContent = 'Rest';
      if (durEl) durEl.textContent = '';
    }
  });

  // Update insights label
  var lbl = document.getElementById('coach-insights-lbl');
  if (lbl) lbl.textContent = name + ' — Insights';

  coachRenderWDC();
}

function coachSelectDay(day) {
  coachDay = day;
  coachViewIdx = 0;
  document.querySelectorAll('#coach-week-strip .day-card').forEach(function(c){ c.classList.remove('selected'); });
  var el = document.getElementById('coachday-' + day);
  if (el) el.classList.add('selected');
  coachRenderWDC();
}

function coachSetCmp(btn, mode) {
  coachCmpMode = mode;
  var strip = btn.closest('.compare-chips');
  if (strip) strip.querySelectorAll('.cchip').forEach(function(c){ c.classList.remove('active'); });
  btn.classList.add('active');
  coachRenderWDC();
}

function coachRenderWDC() {
  var data = dayData[coachDay] || swimData;
  var views = insViews[coachDay] || insViews['fri'];
  if (coachViewIdx >= views.length) coachViewIdx = 0;
  var view = views[coachViewIdx];

  // Label
  var lbl = document.getElementById('coach-wdc-label');
  if (lbl) lbl.textContent = (dayLabels[coachDay] || 'Workout') + ' — ' + coachSelectedAth;

  // View chips
  var vc = document.getElementById('coach-view-chips');
  if (vc) {
    vc.innerHTML = '';
    views.forEach(function(v, i) {
      var b = document.createElement('button');
      b.className = 'vchip' + (i === coachViewIdx ? ' active' : '');
      b.textContent = v.name;
      b.onclick = (function(idx){ return function(){ coachViewIdx = idx; coachRenderWDC(); }; })(i);
      vc.appendChild(b);
    });
  }

  // Panels — reuse same SVG render logic from perfRenderWDC
  var panels = document.getElementById('coach-wdc-panels');
  if (!panels) return;
  panels.innerHTML = '';
  var W = panels.offsetWidth || 700;

  view.panels.forEach(function(panel, pi) {
    var isFirst = pi === 0;
    var H = isFirst ? 130 : 90;
    var mm = iMinMax(data, panel.key, 0.08);
    var gradId = 'cg' + panel.color.replace('#','') + '_' + pi;

    var ghostData = null;
    if (coachCmpMode !== 'this') {
      var mult = coachCmpMode==='best'?0.97:(coachCmpMode==='last'?1.02:1.03);
      ghostData = data.map(function(d){ var r={}; Object.keys(d).forEach(function(k){ r[k]=typeof d[k]==='number'?d[k]*mult:d[k]; }); return r; });
    }

    var svgNS = 'http://www.w3.org/2000/svg';
    var cpDiv = document.createElement('div');
    cpDiv.className = 'chart-panel';
    cpDiv.style.paddingTop = isFirst ? '0' : '8px';
    cpDiv.style.borderTop = isFirst ? 'none' : '1px solid #1e1e1e';

    var header = document.createElement('div');
    header.className = 'cp-header';
    header.innerHTML = '<div class="cp-metric"><div class="cp-dot" style="background:'+panel.color+'"></div><span style="color:#555">'+panel.label+'</span></div>'
      + '<div class="cp-scrub-val" id="csv-'+pi+'" style="color:'+panel.color+';display:none"></div>';
    cpDiv.appendChild(header);

    var svgEl = document.createElementNS(svgNS,'svg');
    svgEl.setAttribute('width','100%'); svgEl.setAttribute('height',H);
    svgEl.setAttribute('viewBox','0 0 '+W+' '+H);
    svgEl.style.cssText = 'display:block;overflow:visible';

    // Gradient
    var defs = document.createElementNS(svgNS,'defs');
    var grad = document.createElementNS(svgNS,'linearGradient');
    grad.setAttribute('id',gradId); grad.setAttribute('x1','0'); grad.setAttribute('y1','0'); grad.setAttribute('x2','0'); grad.setAttribute('y2','1');
    var s1=document.createElementNS(svgNS,'stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color',panel.color); s1.setAttribute('stop-opacity','0.28');
    var s2=document.createElementNS(svgNS,'stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color',panel.color); s2.setAttribute('stop-opacity','0.02');
    grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad); svgEl.appendChild(defs);

    // Grid
    [0.25,0.5,0.75].forEach(function(f){
      var line=document.createElementNS(svgNS,'line');
      line.setAttribute('x1','0'); line.setAttribute('y1',(H*f).toFixed(1));
      line.setAttribute('x2',W); line.setAttribute('y2',(H*f).toFixed(1));
      line.setAttribute('stroke','#1e1e1e'); line.setAttribute('stroke-width','1');
      svgEl.appendChild(line);
    });

    if (ghostData) {
      var gp = document.createElementNS(svgNS,'path');
      gp.setAttribute('d', iSvgPath(ghostData,panel.key,W,H,mm.min,mm.max));
      gp.setAttribute('stroke',panel.color); gp.setAttribute('stroke-width','1');
      gp.setAttribute('stroke-dasharray','5,4'); gp.setAttribute('fill','none'); gp.setAttribute('opacity','0.4');
      svgEl.appendChild(gp);
    }

    var areaPath = document.createElementNS(svgNS,'path');
    areaPath.setAttribute('d', iSvgArea(data,panel.key,W,H,mm.min,mm.max));
    areaPath.setAttribute('fill','url(#'+gradId+')'); areaPath.setAttribute('stroke','none');
    svgEl.appendChild(areaPath);

    var linePath = document.createElementNS(svgNS,'path');
    linePath.setAttribute('d', iSvgPath(data,panel.key,W,H,mm.min,mm.max));
    linePath.setAttribute('stroke',panel.color); linePath.setAttribute('stroke-width','1.5');
    linePath.setAttribute('fill','none'); linePath.setAttribute('stroke-linejoin','round');
    svgEl.appendChild(linePath);

    // Lap markers
    data.forEach(function(d,i){
      if (d.isLap || d.isInterval) {
        var x=(i/(data.length-1))*W;
        var tick=document.createElementNS(svgNS,'line');
        tick.setAttribute('x1',x.toFixed(1)); tick.setAttribute('y1','0');
        tick.setAttribute('x2',x.toFixed(1)); tick.setAttribute('y2',H);
        tick.setAttribute('stroke','#2a2a2a'); tick.setAttribute('stroke-width','1'); tick.setAttribute('stroke-dasharray','2,3');
        svgEl.appendChild(tick);
      }
    });

    // Scrub line + dot
    var scrubLine = document.createElementNS(svgNS,'line');
    scrubLine.setAttribute('x1','-1'); scrubLine.setAttribute('y1','0');
    scrubLine.setAttribute('x2','-1'); scrubLine.setAttribute('y2',H);
    scrubLine.setAttribute('stroke','rgba(255,255,255,0.3)'); scrubLine.setAttribute('stroke-width','1');
    scrubLine.setAttribute('id','cscrl-'+pi); svgEl.appendChild(scrubLine);

    var scrubDot = document.createElementNS(svgNS,'circle');
    scrubDot.setAttribute('r','4'); scrubDot.setAttribute('fill',panel.color);
    scrubDot.setAttribute('id','cscrd-'+pi); scrubDot.setAttribute('opacity','0'); svgEl.appendChild(scrubDot);

    // Mouse overlay
    var overlay = document.createElementNS(svgNS,'rect');
    overlay.setAttribute('x','0'); overlay.setAttribute('y','0');
    overlay.setAttribute('width',W); overlay.setAttribute('height',H);
    overlay.setAttribute('fill','transparent'); overlay.style.cursor='crosshair';
    (function(dataArr, svgW){ 
      overlay.addEventListener('mousemove', function(e){
        var rect=svgEl.getBoundingClientRect();
        var pct=(e.clientX-rect.left)/rect.width;
        var idx=Math.max(0,Math.min(dataArr.length-1,Math.round(pct*(dataArr.length-1))));
        coachUpdateScrub(idx, dataArr, svgW, view.panels);
      });
    })(data, W);
    svgEl.appendChild(overlay);

    cpDiv.appendChild(svgEl);
    panels.appendChild(cpDiv);
  });
}

function coachUpdateScrub(idx, data, W, panels) {
  var d = data[idx];
  var t = d.time; var mins=Math.floor(t/60); var secs=t%60;
  var tt = document.getElementById('coach-scrub-tt');
  var parts = ['<span class="scrub-time">'+mins+':'+(secs<10?'0':'')+secs+'</span>'];
  panels.forEach(function(panel, pi) {
    var raw = d[panel.key]; if (raw===undefined) return;
    var fmt = panel.fmt ? panel.fmt(raw) : (Math.round(raw*10)/10)+'';
    parts.push('<span class="scrub-val" style="color:'+panel.color+'">'+panel.label+': <strong>'+fmt+' '+panel.unit+'</strong></span>');
    var H = pi===0?130:90;
    var mm2 = iMinMax(data,panel.key,0.08);
    var v = Math.max(mm2.min,Math.min(mm2.max,raw));
    var yPos = H-((v-mm2.min)/(mm2.max-mm2.min))*H;
    var x = (idx/(data.length-1))*W;
    var sl=document.getElementById('cscrl-'+pi); var sd=document.getElementById('cscrd-'+pi);
    if(sl){sl.setAttribute('x1',x.toFixed(1));sl.setAttribute('x2',x.toFixed(1));sl.setAttribute('y1',0);sl.setAttribute('y2',H);}
    if(sd){sd.setAttribute('cx',x.toFixed(1));sd.setAttribute('cy',yPos.toFixed(1));sd.setAttribute('opacity','1');}
    var sv=document.getElementById('csv-'+pi); if(sv){sv.textContent=fmt+' '+panel.unit;sv.style.display='block';}
  });
  if(tt) tt.innerHTML = parts.join(' <span style="color:#333">·</span> ');
}

function coachClearScrub() {
  var tt = document.getElementById('coach-scrub-tt');
  if (tt) tt.innerHTML = 'Move cursor over chart to explore';
  for(var i=0;i<10;i++){
    var sl=document.getElementById('cscrl-'+i); var sd=document.getElementById('cscrd-'+i); var sv=document.getElementById('csv-'+i);
    if(sl)sl.setAttribute('x1','-1'); if(sd)sd.setAttribute('opacity','0'); if(sv)sv.style.display='none';
  }
}

function coachToggleCard(btn, id) {
  var body = document.getElementById('coach-ic-' + id);
  if (!body) return;
  var isOpen = body.classList.contains('open');
  body.classList.toggle('open');
  btn.textContent = isOpen ? 'Show me why →' : 'Show less';
  if (!isOpen) {
    setTimeout(function(){
      renderChartInEl(document.getElementById('coach-load-chart'), 'load');
      renderChartInEl(document.getElementById('coach-aerobic-chart'), 'aerobic');
    }, 60);
  }
}


/* ════════════════════════════════════
   INIT
════════════════════════════════════ */
// Close modal on overlay click
document.getElementById('key-modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
document.getElementById('builder-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeBuilder();
});
</script>



<!-- ══ COACH: MY PROFILE ══ -->
<div class="screen" id="screen-my-profile">
  <div class="ph"><div class="ph-row"><div><div class="ph-t">Coach Profile</div><div class="ph-s">Your Cady Core profile — visible to athletes in Discover.</div></div><div style="display:flex;gap:8px"><div class="cady-badge"><span class="cady-badge-icon">✦</span> Cady Core</div><button class="btn btn-gold" style="font-size:12px">Save Changes</button></div></div></div>

  <div style="background:var(--gold1);border:1px solid var(--gold2);border-radius:var(--rad);padding:14px 18px;margin-bottom:18px;display:flex;align-items:center;gap:14px">
    <div style="font-size:20px">✦</div>
    <div style="flex:1"><div style="font-weight:700;color:var(--gold);font-size:13px;margin-bottom:2px">Profile is Live</div><div style="font-size:12px;color:var(--t2)">Athletes can discover and enroll in your programs through the Discover tab. Last updated Feb 18.</div></div>
    <button class="btn btn-ghost" style="font-size:12px;flex-shrink:0" onclick="go('discover')">Preview as athlete →</button>
  </div>

  <div class="g2" style="margin-bottom:18px">
    <div class="card card-p">
      <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:12px">Identity</div>
      <div class="profile-form">
        <div class="pf-field"><div class="pf-label">Full Name</div><input class="pf-input" value="Jordan Taylor"></div>
        <div class="pf-field"><div class="pf-label">Specialty</div><input class="pf-input" value="Triathlon · Ironman Specialist"></div>
        <div class="pf-field"><div class="pf-label">Years Coaching</div><input class="pf-input" value="12"></div>
        <div class="pf-field"><div class="pf-label">Certifications</div><input class="pf-input" value="USAT Level 2, USAC, TrainingPeaks Certified"></div>
        <div class="pf-field full"><div class="pf-label">Bio</div><textarea class="pf-ta" rows="4">I coach working professionals who want to compete seriously without burning out. My methodology is rooted in aerobic base development, progressive overload, and intelligent recovery.</textarea></div>
      </div>
    </div>
    <div class="card card-p">
      <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:12px">Programs Available</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px">
        <div style="background:var(--sur3);border:1px solid var(--bd);border-radius:var(--rad-s);padding:9px 12px;display:flex;align-items:center;justify-content:space-between"><div><div style="font-size:12px;font-weight:700">20-Wk Ironman 70.3</div><div style="font-size:11px;color:var(--t4);font-family:'DM Mono',monospace">47 enrolled · $149/mo</div></div><button class="btn btn-ghost" style="font-size:11px;padding:4px 10px">Edit</button></div>
        <div style="background:var(--sur3);border:1px solid var(--bd);border-radius:var(--rad-s);padding:9px 12px;display:flex;align-items:center;justify-content:space-between"><div><div style="font-size:12px;font-weight:700">12-Wk Olympic Tri</div><div style="font-size:11px;color:var(--t4);font-family:'DM Mono',monospace">23 enrolled · $99/mo</div></div><button class="btn btn-ghost" style="font-size:11px;padding:4px 10px">Edit</button></div>
      </div>
      <button class="btn btn-ghost" style="font-size:12px;width:100%;justify-content:center" onclick="go('library')">+ Add Program from Library</button>

      <div style="margin-top:18px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--t4);margin-bottom:10px">Profile Stats</div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <div style="display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--t2)">Profile views (30d)</span><span class="mono" style="font-weight:600">847</span></div>
        <div style="display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--t2)">Enrollment rate</span><span class="mono up" style="font-weight:600">12%</span></div>
        <div style="display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--t2)">Athlete completion rate</span><span class="mono up" style="font-weight:600">91%</span></div>
        <div style="display:flex;justify-content:space-between;font-size:13px"><span style="color:var(--t2)">Cady Core rank</span><span class="mono" style="font-weight:600">#3 Triathlon</span></div>
      </div>
    </div>
  </div>
</div>

<!-- BUILDER OVERLAY -->
<div class="builder-overlay" id="builder-overlay">
  <div class="builder-panel">
    <div class="bp-header">
      <div class="bp-title">New Workout</div>
      <button class="bp-close" onclick="closeBuilder()">✕</button>
    </div>
    <div class="bp-body">
      <div class="bp-section">
        <div class="bp-label">Workout Name</div>
        <input class="bp-input" id="bp-name" placeholder="e.g. 3×12 Threshold Bike" style="font-weight:700;font-size:14px">
      </div>
      <div class="bp-section">
        <div class="bp-label">Sport</div>
        <div class="sport-select" id="sport-select">
          <div class="sport-opt selected" onclick="selectSportOpt(this)"><div class="sport-opt-icon">🏃</div><div class="sport-opt-lbl">Run</div></div>
          <div class="sport-opt" onclick="selectSportOpt(this)"><div class="sport-opt-icon">🚴</div><div class="sport-opt-lbl">Bike</div></div>
          <div class="sport-opt" onclick="selectSportOpt(this)"><div class="sport-opt-icon">🏊</div><div class="sport-opt-lbl">Swim</div></div>
          <div class="sport-opt" onclick="selectSportOpt(this)"><div class="sport-opt-icon">💪</div><div class="sport-opt-lbl">Strength</div></div>
        </div>
      </div>
      <div class="bp-section">
        <div class="bp-row">
          <div><div class="bp-label">Total Duration</div><input class="bp-input" placeholder="60 min" value="60"></div>
          <div><div class="bp-label">Primary Zone</div>
            <select class="bp-input"><option>Zone 1 — Recovery</option><option>Zone 2 — Aerobic</option><option selected>Zone 3 — Tempo</option><option>Zone 4 — Threshold</option><option>Zone 5 — VO2</option></select>
          </div>
        </div>
      </div>
      <div class="bp-section">
        <div class="bp-label" style="display:flex;justify-content:space-between"><span>Interval Structure</span><span style="font-size:9px;color:var(--t4);font-weight:400;text-transform:none;letter-spacing:0">Click block to edit</span></div>
        <div class="interval-canvas">
          <div class="interval-track" id="int-track"></div>
          <div class="int-add-bar">
            <button class="int-add-btn" onclick="addBlock('warmup')">+ Warmup</button>
            <button class="int-add-btn" onclick="addBlock('work')">+ Work</button>
            <button class="int-add-btn" onclick="addBlock('rest')">+ Rest</button>
            <button class="int-add-btn" onclick="addBlock('hard')">+ Hard</button>
            <button class="int-add-btn" onclick="addBlock('cool')">+ Cooldown</button>
          </div>
          <div class="int-detail" id="int-detail">
            <div class="bp-label" id="int-det-lbl">Warmup</div>
            <div class="target-grid">
              <div class="target-box"><div class="tgt-lbl">Power</div><input class="tgt-input" id="tgt-power" placeholder="—" value="55-75%"></div>
              <div class="target-box"><div class="tgt-lbl">HR Zone</div><input class="tgt-input" id="tgt-hr" placeholder="—" value="Z1-Z2"></div>
              <div class="target-box"><div class="tgt-lbl">Pace</div><input class="tgt-input" id="tgt-pace" placeholder="—" value="Easy"></div>
            </div>
            <div style="margin-top:7px;display:flex;align-items:center;gap:8px">
              <div><div class="bp-label" style="margin-bottom:4px">Duration (min)</div><input class="bp-input" id="tgt-dur" value="10" style="width:68px"></div>
              <button class="int-add-btn" style="color:var(--r);border-color:var(--r2);margin-top:18px" onclick="removeSelectedBlock()">Remove</button>
            </div>
          </div>
          <div class="int-summary" id="int-summary"></div>
        </div>
      </div>
      <div class="bp-section">
        <div class="bp-label">Coach Notes</div>
        <textarea class="bp-input" rows="2" placeholder="Key instructions or context for this workout…" style="resize:none;line-height:1.6"></textarea>
      </div>
      <div class="bp-section">
        <div class="bp-label">Tags</div>
        <div style="display:flex;gap:4px;flex-wrap:wrap">
          <span class="wo-tag tag-threshold" style="padding:3px 9px;cursor:pointer;border-radius:20px;font-size:10px" onclick="toggleTag(this)">threshold ✓</span>
          <span class="wo-tag tag-z2" style="padding:3px 9px;cursor:pointer;border-radius:20px;font-size:10px;opacity:.4" onclick="toggleTag(this)">z2</span>
          <span class="wo-tag tag-vo2" style="padding:3px 9px;cursor:pointer;border-radius:20px;font-size:10px;opacity:.4" onclick="toggleTag(this)">vo2</span>
          <span class="wo-tag tag-long" style="padding:3px 9px;cursor:pointer;border-radius:20px;font-size:10px;opacity:.4" onclick="toggleTag(this)">long</span>
          <span class="wo-tag tag-race" style="padding:3px 9px;cursor:pointer;border-radius:20px;font-size:10px;opacity:.4" onclick="toggleTag(this)">race-pace</span>
        </div>
      </div>
    </div>
    <div class="bp-footer">
      <button class="btn btn-ghost" style="font-size:12px" onclick="closeBuilder()">Cancel</button>
      <button class="btn btn-b" style="font-size:12px" onclick="saveWorkout()">Save to Library →</button>
    </div>
  </div>
</div>
</body>
</html>
